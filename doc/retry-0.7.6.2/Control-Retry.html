<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Control.Retry</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Control.Retry.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">retry-0.7.6.2: Retry combinators for monadic actions that may fail</p></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>Ozgun Ataman &lt;ozgun.ataman@soostone.com&gt;</td></tr><tr><th>License</th><td>BSD3</td></tr><tr><th>Maintainer</th><td>Ozgun Ataman</td></tr><tr><th>Stability</th><td>provisional</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Control.Retry</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Types and Operations</a><ul><li><a href="#g:2">Lenses for <code>RetryStatus</code></a></li></ul></li><li><a href="#g:3">Applying Retry Policies</a></li><li><a href="#g:4">Retry Policies</a></li><li><a href="#g:5">Policy Transformers</a></li><li><a href="#g:6">Development Helpers</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module exposes combinators that can wrap arbitrary monadic
 actions. They run the action and potentially retry running it with
 some configurable delay for a configurable number of times.</p><p>The express purpose of this library is to make it easier to work
 with IO and especially network IO actions that often experience
 temporary failure that warrant retrying of the original action. For
 example, a database query may time out for a while, in which case
 we should delay a bit and retry the query.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">newtype</span> <a href="#t:RetryPolicyM">RetryPolicyM</a> m = <a href="#v:RetryPolicyM">RetryPolicyM</a> {<ul class="subs"><li><a href="#v:getRetryPolicyM">getRetryPolicyM</a> :: <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m (<a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a>)</li></ul>}</li><li class="src short"><span class="keyword">type</span> <a href="#t:RetryPolicy">RetryPolicy</a> = <span class="keyword">forall</span> m. <a href="../base-4.10.1.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m</li><li class="src short"><a href="#v:retryPolicy">retryPolicy</a> :: (<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; <a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a>) -&gt; <a href="Control-Retry.html#t:RetryPolicy">RetryPolicy</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:RetryStatus">RetryStatus</a> = <a href="#v:RetryStatus">RetryStatus</a> {<ul class="subs"><li><a href="#v:rsIterNumber">rsIterNumber</a> :: !<a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a></li><li><a href="#v:rsCumulativeDelay">rsCumulativeDelay</a> :: !<a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a></li><li><a href="#v:rsPreviousDelay">rsPreviousDelay</a> :: !(<a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a>)</li></ul>}</li><li class="src short"><a href="#v:defaultRetryStatus">defaultRetryStatus</a> :: <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a></li><li class="src short"><a href="#v:applyPolicy">applyPolicy</a> :: <a href="../base-4.10.1.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m (<a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a>)</li><li class="src short"><a href="#v:applyAndDelay">applyAndDelay</a> :: <a href="../base-4.10.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m =&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m (<a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a>)</li><li class="src short"><a href="#v:rsIterNumberL">rsIterNumberL</a> :: Lens' <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a></li><li class="src short"><a href="#v:rsCumulativeDelayL">rsCumulativeDelayL</a> :: Lens' <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a></li><li class="src short"><a href="#v:rsPreviousDelayL">rsPreviousDelayL</a> :: Lens' <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> (<a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a>)</li><li class="src short"><a href="#v:retrying">retrying</a> :: <a href="../base-4.10.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m =&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; (<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; b -&gt; m <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a>) -&gt; (<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m b) -&gt; m b</li><li class="src short"><a href="#v:recovering">recovering</a> :: (<a href="../base-4.10.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m, <a href="../exceptions-0.8.3/Control-Monad-Catch.html#t:MonadMask">MonadMask</a> m) =&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; [<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; <a href="../exceptions-0.8.3/Control-Monad-Catch.html#t:Handler">Handler</a> m <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a>] -&gt; (<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m a) -&gt; m a</li><li class="src short"><a href="#v:stepping">stepping</a> :: (<a href="../base-4.10.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m, <a href="../exceptions-0.8.3/Control-Monad-Catch.html#t:MonadMask">MonadMask</a> m) =&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; [<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; <a href="../exceptions-0.8.3/Control-Monad-Catch.html#t:Handler">Handler</a> m <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a>] -&gt; (<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m ()) -&gt; (<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m a) -&gt; <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m (<a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> a)</li><li class="src short"><a href="#v:recoverAll">recoverAll</a> :: (<a href="../base-4.10.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m, <a href="../exceptions-0.8.3/Control-Monad-Catch.html#t:MonadMask">MonadMask</a> m) =&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; (<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m a) -&gt; m a</li><li class="src short"><a href="#v:skipAsyncExceptions">skipAsyncExceptions</a> :: <a href="../base-4.10.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m =&gt; [<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; <a href="../exceptions-0.8.3/Control-Monad-Catch.html#t:Handler">Handler</a> m <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a>]</li><li class="src short"><a href="#v:logRetries">logRetries</a> :: (<a href="../base-4.10.1.0/Control-Monad.html#t:Monad">Monad</a> m, <a href="../base-4.10.1.0/Control-Exception-Base.html#t:Exception">Exception</a> e) =&gt; (e -&gt; m <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a>) -&gt; (<a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; e -&gt; <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m ()) -&gt; <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; <a href="../exceptions-0.8.3/Control-Monad-Catch.html#t:Handler">Handler</a> m <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:defaultLogMsg">defaultLogMsg</a> :: <a href="../base-4.10.1.0/Control-Exception-Base.html#t:Exception">Exception</a> e =&gt; <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; e -&gt; <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; <a href="../base-4.10.1.0/Data-String.html#t:String">String</a></li><li class="src short"><a href="#v:constantDelay">constantDelay</a> :: <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Control-Retry.html#t:RetryPolicy">RetryPolicy</a></li><li class="src short"><a href="#v:exponentialBackoff">exponentialBackoff</a> :: <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Control-Retry.html#t:RetryPolicy">RetryPolicy</a></li><li class="src short"><a href="#v:fullJitterBackoff">fullJitterBackoff</a> :: <a href="../base-4.10.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m =&gt; <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m</li><li class="src short"><a href="#v:fibonacciBackoff">fibonacciBackoff</a> :: <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Control-Retry.html#t:RetryPolicy">RetryPolicy</a></li><li class="src short"><a href="#v:limitRetries">limitRetries</a> :: <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Control-Retry.html#t:RetryPolicy">RetryPolicy</a></li><li class="src short"><a href="#v:limitRetriesByDelay">limitRetriesByDelay</a> :: <a href="../base-4.10.1.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m</li><li class="src short"><a href="#v:limitRetriesByCumulativeDelay">limitRetriesByCumulativeDelay</a> :: <a href="../base-4.10.1.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m</li><li class="src short"><a href="#v:capDelay">capDelay</a> :: <a href="../base-4.10.1.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m</li><li class="src short"><a href="#v:simulatePolicy">simulatePolicy</a> :: <a href="../base-4.10.1.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; m [(<a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a>, <a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a>)]</li><li class="src short"><a href="#v:simulatePolicyPP">simulatePolicyPP</a> :: <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> <a href="../base-4.10.1.0/System-IO.html#t:IO">IO</a> -&gt; <a href="../base-4.10.1.0/System-IO.html#t:IO">IO</a> ()</li></ul></div><div id="interface"><h1 id="g:1">Types and Operations</h1><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:RetryPolicyM" class="def">RetryPolicyM</a> m <a href="src/Control.Retry.html#RetryPolicyM" class="link">Source</a> <a href="#t:RetryPolicyM" class="selflink">#</a></p><div class="doc"><p>A <code><a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a></code> is a function that takes an <code><a href="Control-Retry.html#t:RetryStatus">RetryStatus</a></code> and
 possibly returns a delay in microseconds.  Iteration numbers start
 at zero and increase by one on each retry.  A *Nothing* return value from
 the function implies we have reached the retry limit.</p><p>Please note that <code><a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a></code> is a <code><a href="../base-4.10.1.0/Data-Monoid.html#t:Monoid">Monoid</a></code>. You can collapse
 multiple strategies into one using <code><a href="../base-4.10.1.0/Data-Monoid.html#v:mappend">mappend</a></code> or <code><a href="../base-4.10.1.0/Data-Semigroup.html#v:-60--62-">&lt;&gt;</a></code>. The semantics
 of this combination are as follows:</p><ol><li>If either policy returns <code><a href="../base-4.10.1.0/Data-Maybe.html#v:Nothing">Nothing</a></code>, the combined policy returns
 <code><a href="../base-4.10.1.0/Data-Maybe.html#v:Nothing">Nothing</a></code>. This can be used to <code>inhibit</code> after a number of retries,
 for example.</li><li>If both policies return a delay, the larger delay will be used.
 This is quite natural when combining multiple policies to achieve a
 certain effect.</li></ol><p>Example:</p><p>One can easily define an exponential backoff policy with a limited
 number of retries:</p><pre>&gt; limitedBackoff = exponentialBackoff 50 &lt;&gt; limitRetries 5</pre><p>Naturally, <code><a href="../base-4.10.1.0/Data-Monoid.html#v:mempty">mempty</a></code> will retry immediately (delay 0) for an
 unlimited number of retries, forming the identity for the <code><a href="../base-4.10.1.0/Data-Monoid.html#t:Monoid">Monoid</a></code>.</p><p>The default under <code><a href="../data-default-class-0.1.2.0/Data-Default-Class.html#v:def">def</a></code> implements a constant 50ms delay, up to 5 times:</p><pre>&gt; def = constantDelay 50000 &lt;&gt; limitRetries 5</pre><p>For anything more complex, just define your own <code><a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a></code>:</p><pre>&gt; myPolicy = retryPolicy $ \ rs -&gt; if rsIterNumber n &gt; 10 then Just 1000 else Just 10000</pre><p>Since 0.7.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:RetryPolicyM" class="def">RetryPolicyM</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:getRetryPolicyM" class="def">getRetryPolicyM</a> :: <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m (<a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a>)</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div><div class="subs instances"><p id="control.i:RetryPolicyM" class="caption collapser" onclick="toggleSection('i:RetryPolicyM')">Instances</p><div id="section.i:RetryPolicyM" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:RetryPolicyM:Semigroup:1" class="instance expander" onclick="toggleSection('i:id:RetryPolicyM:Semigroup:1')"></span> <a href="../base-4.10.1.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="../base-4.10.1.0/Data-Semigroup.html#t:Semigroup">Semigroup</a> (<a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m)</span> <a href="src/Control.Retry.html#line-159" class="link">Source</a> <a href="#t:RetryPolicyM" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:RetryPolicyM:Semigroup:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-60--62-">(&lt;&gt;)</a> :: <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m <a href="#v:-60--62-" class="selflink">#</a></p><p class="src"><a href="#v:sconcat">sconcat</a> :: <a href="../base-4.10.1.0/Data-List-NonEmpty.html#t:NonEmpty">NonEmpty</a> (<a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m) -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m <a href="#v:sconcat" class="selflink">#</a></p><p class="src"><a href="#v:stimes">stimes</a> :: <a href="../base-4.10.1.0/Prelude.html#t:Integral">Integral</a> b =&gt; b -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m <a href="#v:stimes" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:RetryPolicyM:Monoid:2" class="instance expander" onclick="toggleSection('i:id:RetryPolicyM:Monoid:2')"></span> <a href="../base-4.10.1.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="../base-4.10.1.0/Data-Monoid.html#t:Monoid">Monoid</a> (<a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m)</span> <a href="src/Control.Retry.html#line-166" class="link">Source</a> <a href="#t:RetryPolicyM" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:RetryPolicyM:Monoid:2" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:mempty">mempty</a> :: <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m <a href="#v:mempty" class="selflink">#</a></p><p class="src"><a href="#v:mappend">mappend</a> :: <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m <a href="#v:mappend" class="selflink">#</a></p><p class="src"><a href="#v:mconcat">mconcat</a> :: [<a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m] -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m <a href="#v:mconcat" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:RetryPolicyM:Default:3" class="instance expander" onclick="toggleSection('i:id:RetryPolicyM:Default:3')"></span> <a href="../base-4.10.1.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="../data-default-class-0.1.2.0/Data-Default-Class.html#t:Default">Default</a> (<a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m)</span> <a href="src/Control.Retry.html#line-151" class="link">Source</a> <a href="#t:RetryPolicyM" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:RetryPolicyM:Default:3" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:def">def</a> :: <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m <a href="#v:def" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:RetryPolicy" class="def">RetryPolicy</a> = <span class="keyword">forall</span> m. <a href="../base-4.10.1.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m <a href="src/Control.Retry.html#RetryPolicy" class="link">Source</a> <a href="#t:RetryPolicy" class="selflink">#</a></p><div class="doc"><p>Simplified <code><a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a></code> without any use of the monadic context in
 determining policy. Mostly maintains backwards compatitibility with
 type signatures pre-0.7.</p></div></div><div class="top"><p class="src"><a id="v:retryPolicy" class="def">retryPolicy</a> :: (<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; <a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a>) -&gt; <a href="Control-Retry.html#t:RetryPolicy">RetryPolicy</a> <a href="src/Control.Retry.html#retryPolicy" class="link">Source</a> <a href="#v:retryPolicy" class="selflink">#</a></p><div class="doc"><p>Helper for making simplified policies that don't use the monadic
 context.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:RetryStatus" class="def">RetryStatus</a> <a href="src/Control.Retry.html#RetryStatus" class="link">Source</a> <a href="#t:RetryStatus" class="selflink">#</a></p><div class="doc"><p>Datatype with stats about retries made thus far. The constructor
 is deliberately not exported to make additional fields easier to
 add in a backward-compatible manner. To read or modify fields in
 RetryStatus, use the accessors or lenses below. Note that if you
 don't want to use lenses, the exported field names can be used for
 updates:</p><pre>&gt; retryStatus { rsIterNumber = newIterNumber }
&gt; retryStatus &amp; rsIterNumberL .~ newIterNumber</pre></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:RetryStatus" class="def">RetryStatus</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:rsIterNumber" class="def">rsIterNumber</a> :: !<a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a></dfn><div class="doc"><p>Iteration number, where 0 is the first try</p></div></li><li><dfn class="src"><a id="v:rsCumulativeDelay" class="def">rsCumulativeDelay</a> :: !<a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a></dfn><div class="doc"><p>Delay incurred so far from retries in microseconds</p></div></li><li><dfn class="src"><a id="v:rsPreviousDelay" class="def">rsPreviousDelay</a> :: !(<a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a>)</dfn><div class="doc"><p>Latest attempt's delay. Will always be Nothing on first run.</p></div></li></ul></div></td></tr></table></div><div class="subs instances"><p id="control.i:RetryStatus" class="caption collapser" onclick="toggleSection('i:RetryStatus')">Instances</p><div id="section.i:RetryStatus" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:RetryStatus:Eq:1" class="instance expander" onclick="toggleSection('i:id:RetryStatus:Eq:1')"></span> <a href="../base-4.10.1.0/Data-Eq.html#t:Eq">Eq</a> <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a></span> <a href="src/Control.Retry.html#line-193" class="link">Source</a> <a href="#t:RetryStatus" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:RetryStatus:Eq:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:RetryStatus:Read:2" class="instance expander" onclick="toggleSection('i:id:RetryStatus:Read:2')"></span> <a href="../base-4.10.1.0/Text-Read.html#t:Read">Read</a> <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a></span> <a href="src/Control.Retry.html#line-193" class="link">Source</a> <a href="#t:RetryStatus" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:RetryStatus:Read:2" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:readsPrec">readsPrec</a> :: <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.1.0/Text-ParserCombinators-ReadP.html#t:ReadS">ReadS</a> <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> <a href="#v:readsPrec" class="selflink">#</a></p><p class="src"><a href="#v:readList">readList</a> :: <a href="../base-4.10.1.0/Text-ParserCombinators-ReadP.html#t:ReadS">ReadS</a> [<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a>] <a href="#v:readList" class="selflink">#</a></p><p class="src"><a href="#v:readPrec">readPrec</a> :: <a href="../base-4.10.1.0/Text-ParserCombinators-ReadPrec.html#t:ReadPrec">ReadPrec</a> <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> <a href="#v:readPrec" class="selflink">#</a></p><p class="src"><a href="#v:readListPrec">readListPrec</a> :: <a href="../base-4.10.1.0/Text-ParserCombinators-ReadPrec.html#t:ReadPrec">ReadPrec</a> [<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a>] <a href="#v:readListPrec" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:RetryStatus:Show:3" class="instance expander" onclick="toggleSection('i:id:RetryStatus:Show:3')"></span> <a href="../base-4.10.1.0/Text-Show.html#t:Show">Show</a> <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a></span> <a href="src/Control.Retry.html#line-193" class="link">Source</a> <a href="#t:RetryStatus" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:RetryStatus:Show:3" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; <a href="../base-4.10.1.0/Text-Show.html#t:ShowS">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; <a href="../base-4.10.1.0/Data-String.html#t:String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a>] -&gt; <a href="../base-4.10.1.0/Text-Show.html#t:ShowS">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:RetryStatus:Generic:4" class="instance expander" onclick="toggleSection('i:id:RetryStatus:Generic:4')"></span> <a href="../base-4.10.1.0/GHC-Generics.html#t:Generic">Generic</a> <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a></span> <a href="src/Control.Retry.html#line-193" class="link">Source</a> <a href="#t:RetryStatus" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:RetryStatus:Generic:4" class="inst-details hide"><div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="../base-4.10.1.0/GHC-Generics.html#t:Rep">Rep</a> <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> :: <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> -&gt; <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> <a href="#t:Rep" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:from">from</a> :: <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; <a href="../base-4.10.1.0/GHC-Generics.html#t:Rep">Rep</a> <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> x <a href="#v:from" class="selflink">#</a></p><p class="src"><a href="#v:to">to</a> :: <a href="../base-4.10.1.0/GHC-Generics.html#t:Rep">Rep</a> <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> x -&gt; <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> <a href="#v:to" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:RetryStatus:Rep:5" class="instance expander" onclick="toggleSection('i:id:RetryStatus:Rep:5')"></span> <span class="keyword">type</span> <a href="../base-4.10.1.0/GHC-Generics.html#t:Rep">Rep</a> <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a></span> <a href="src/Control.Retry.html#line-1" class="link">Source</a> <a href="#t:RetryStatus" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:RetryStatus:Rep:5" class="inst-details hide"><div class="src"><span class="keyword">type</span> <a href="../base-4.10.1.0/GHC-Generics.html#t:Rep">Rep</a> <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> = <a href="../base-4.10.1.0/GHC-Generics.html#t:D1">D1</a> <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> (<a href="../base-4.10.1.0/GHC-Generics.html#v:MetaData">MetaData</a> &quot;RetryStatus&quot; &quot;Control.Retry&quot; &quot;retry-0.7.6.2-DmvPlcrsNk172eKSCRSV5h&quot; <a href="../base-4.10.1.0/Data-Bool.html#v:False">False</a>) (<a href="../base-4.10.1.0/GHC-Generics.html#t:C1">C1</a> <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> (<a href="../base-4.10.1.0/GHC-Generics.html#v:MetaCons">MetaCons</a> &quot;RetryStatus&quot; <a href="../base-4.10.1.0/GHC-Generics.html#v:PrefixI">PrefixI</a> <a href="../base-4.10.1.0/Data-Bool.html#v:True">True</a>) (<a href="../base-4.10.1.0/GHC-Generics.html#t::-42-:">(:*:)</a> <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> (<a href="../base-4.10.1.0/GHC-Generics.html#t:S1">S1</a> <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> (<a href="../base-4.10.1.0/GHC-Generics.html#v:MetaSel">MetaSel</a> (<a href="../base-4.10.1.0/Data-Maybe.html#v:Just">Just</a> <a href="../base-4.10.1.0/GHC-TypeLits.html#t:Symbol">Symbol</a> &quot;rsIterNumber&quot;) <a href="../base-4.10.1.0/GHC-Generics.html#v:NoSourceUnpackedness">NoSourceUnpackedness</a> <a href="../base-4.10.1.0/GHC-Generics.html#v:SourceStrict">SourceStrict</a> <a href="../base-4.10.1.0/GHC-Generics.html#v:DecidedStrict">DecidedStrict</a>) (<a href="../base-4.10.1.0/GHC-Generics.html#t:Rec0">Rec0</a> <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a>)) (<a href="../base-4.10.1.0/GHC-Generics.html#t::-42-:">(:*:)</a> <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> (<a href="../base-4.10.1.0/GHC-Generics.html#t:S1">S1</a> <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> (<a href="../base-4.10.1.0/GHC-Generics.html#v:MetaSel">MetaSel</a> (<a href="../base-4.10.1.0/Data-Maybe.html#v:Just">Just</a> <a href="../base-4.10.1.0/GHC-TypeLits.html#t:Symbol">Symbol</a> &quot;rsCumulativeDelay&quot;) <a href="../base-4.10.1.0/GHC-Generics.html#v:NoSourceUnpackedness">NoSourceUnpackedness</a> <a href="../base-4.10.1.0/GHC-Generics.html#v:SourceStrict">SourceStrict</a> <a href="../base-4.10.1.0/GHC-Generics.html#v:DecidedStrict">DecidedStrict</a>) (<a href="../base-4.10.1.0/GHC-Generics.html#t:Rec0">Rec0</a> <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a>)) (<a href="../base-4.10.1.0/GHC-Generics.html#t:S1">S1</a> <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> (<a href="../base-4.10.1.0/GHC-Generics.html#v:MetaSel">MetaSel</a> (<a href="../base-4.10.1.0/Data-Maybe.html#v:Just">Just</a> <a href="../base-4.10.1.0/GHC-TypeLits.html#t:Symbol">Symbol</a> &quot;rsPreviousDelay&quot;) <a href="../base-4.10.1.0/GHC-Generics.html#v:NoSourceUnpackedness">NoSourceUnpackedness</a> <a href="../base-4.10.1.0/GHC-Generics.html#v:SourceStrict">SourceStrict</a> <a href="../base-4.10.1.0/GHC-Generics.html#v:DecidedStrict">DecidedStrict</a>) (<a href="../base-4.10.1.0/GHC-Generics.html#t:Rec0">Rec0</a> <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> (<a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a>))))))</div></div></td></tr></table></div></div></div><div class="top"><p class="src"><a id="v:defaultRetryStatus" class="def">defaultRetryStatus</a> :: <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> <a href="src/Control.Retry.html#defaultRetryStatus" class="link">Source</a> <a href="#v:defaultRetryStatus" class="selflink">#</a></p><div class="doc"><p>Initial, default retry status. Exported mostly to allow user code
 to test their handlers and retry policies. Use fields or lenses to update.</p></div></div><div class="top"><p class="src"><a id="v:applyPolicy" class="def">applyPolicy</a> :: <a href="../base-4.10.1.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m (<a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a>) <a href="src/Control.Retry.html#applyPolicy" class="link">Source</a> <a href="#v:applyPolicy" class="selflink">#</a></p><div class="doc"><p>Apply policy on status to see what the decision would be.
 <code><a href="../base-4.10.1.0/Data-Maybe.html#v:Nothing">Nothing</a></code> implies no retry, <code><a href="../base-4.10.1.0/Data-Maybe.html#v:Just">Just</a></code> returns updated status.</p></div></div><div class="top"><p class="src"><a id="v:applyAndDelay" class="def">applyAndDelay</a> :: <a href="../base-4.10.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m =&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m (<a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a>) <a href="src/Control.Retry.html#applyAndDelay" class="link">Source</a> <a href="#v:applyAndDelay" class="selflink">#</a></p><div class="doc"><p>Apply policy and delay by its amount if it results in a retry.
 Return updated status.</p></div></div><h2 id="g:2">Lenses for <code><a href="Control-Retry.html#t:RetryStatus">RetryStatus</a></code></h2><div class="top"><p class="src"><a id="v:rsIterNumberL" class="def">rsIterNumberL</a> :: Lens' <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a> <a href="src/Control.Retry.html#rsIterNumberL" class="link">Source</a> <a href="#v:rsIterNumberL" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:rsCumulativeDelayL" class="def">rsCumulativeDelayL</a> :: Lens' <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a> <a href="src/Control.Retry.html#rsCumulativeDelayL" class="link">Source</a> <a href="#v:rsCumulativeDelayL" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:rsPreviousDelayL" class="def">rsPreviousDelayL</a> :: Lens' <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> (<a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a>) <a href="src/Control.Retry.html#rsPreviousDelayL" class="link">Source</a> <a href="#v:rsPreviousDelayL" class="selflink">#</a></p></div><h1 id="g:3">Applying Retry Policies</h1><div class="top"><p class="src"><a id="v:retrying" class="def">retrying</a> <a href="src/Control.Retry.html#retrying" class="link">Source</a> <a href="#v:retrying" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.10.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; (<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; b -&gt; m <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a>)</td><td class="doc"><p>An action to check whether the result should be retried.
 If True, we delay and retry the operation.</p></td></tr><tr><td class="src">-&gt; (<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m b)</td><td class="doc"><p>Action to run</p></td></tr><tr><td class="src">-&gt; m b</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Retry combinator for actions that don't raise exceptions, but
 signal in their type the outcome has failed. Examples are the
 <code><a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a></code>, <code><a href="../base-4.10.1.0/Data-Either.html#t:Either">Either</a></code> and <code>EitherT</code> monads.</p><p>Let's write a function that always fails and watch this combinator
 retry it 5 additional times following the initial run:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import Data.Maybe
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let f _ = putStrLn &quot;Running action&quot; &gt;&gt; return Nothing
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>retrying def (const $ return . isNothing) f
</code></strong>Running action
Running action
Running action
Running action
Running action
Running action
Nothing
</pre><p>Note how the latest failing result is returned after all retries
 have been exhausted.</p></div></div><div class="top"><p class="src"><a id="v:recovering" class="def">recovering</a> <a href="src/Control.Retry.html#recovering" class="link">Source</a> <a href="#v:recovering" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="../base-4.10.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m, <a href="../exceptions-0.8.3/Control-Monad-Catch.html#t:MonadMask">MonadMask</a> m)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m</td><td class="doc"><p>Just use <code><a href="../data-default-class-0.1.2.0/Data-Default-Class.html#v:def">def</a></code> for default settings</p></td></tr><tr><td class="src">-&gt; [<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; <a href="../exceptions-0.8.3/Control-Monad-Catch.html#t:Handler">Handler</a> m <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a>]</td><td class="doc"><p>Should a given exception be retried? Action will be
 retried if this returns True *and* the policy allows it.
 This action will be consulted first even if the policy
 later blocks it.</p></td></tr><tr><td class="src">-&gt; (<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m a)</td><td class="doc"><p>Action to perform</p></td></tr><tr><td class="src">-&gt; m a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Run an action and recover from a raised exception by potentially
 retrying the action a number of times. Note that if you're going to
 use a handler for <code><a href="../base-4.10.1.0/Control-Exception-Base.html#t:SomeException">SomeException</a></code>, you should add explicit cases
 *earlier* in the list of handlers to reject <code><a href="../base-4.10.1.0/Control-Exception-Base.html#t:AsyncException">AsyncException</a></code> and
 <code><a href="../base-4.10.1.0/Control-Exception-Base.html#t:SomeAsyncException">SomeAsyncException</a></code>, as catching these can cause thread and
 program hangs. <code><a href="Control-Retry.html#v:recoverAll">recoverAll</a></code> already does this for you so if you
 just plan on catching <code><a href="../base-4.10.1.0/Control-Exception-Base.html#t:SomeException">SomeException</a></code>, you may as well ues
 <code><a href="Control-Retry.html#v:recoverAll">recoverAll</a></code></p></div></div><div class="top"><p class="src"><a id="v:stepping" class="def">stepping</a> <a href="src/Control.Retry.html#stepping" class="link">Source</a> <a href="#v:stepping" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="../base-4.10.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m, <a href="../exceptions-0.8.3/Control-Monad-Catch.html#t:MonadMask">MonadMask</a> m)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m</td><td class="doc"><p>Just use <code><a href="../data-default-class-0.1.2.0/Data-Default-Class.html#v:def">def</a></code> for default settings</p></td></tr><tr><td class="src">-&gt; [<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; <a href="../exceptions-0.8.3/Control-Monad-Catch.html#t:Handler">Handler</a> m <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a>]</td><td class="doc"><p>Should a given exception be retried? Action will be
 retried if this returns True *and* the policy allows it.
 This action will be consulted first even if the policy
 later blocks it.</p></td></tr><tr><td class="src">-&gt; (<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m ())</td><td class="doc"><p>Action to run with updated status upon failure.</p></td></tr><tr><td class="src">-&gt; (<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m a)</td><td class="doc"><p>Main action to perform with current status.</p></td></tr><tr><td class="src">-&gt; <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a></td><td class="doc"><p>Current status of this step</p></td></tr><tr><td class="src">-&gt; m (<a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> a)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>A version of <code><a href="Control-Retry.html#v:recovering">recovering</a></code> that tries to run the action only a
 single time. The control will return immediately upon both success
 and failure. Useful for implementing retry logic in distributed
 queues and similar external-interfacing systems.</p></div></div><div class="top"><p class="src"><a id="v:recoverAll" class="def">recoverAll</a> :: (<a href="../base-4.10.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m, <a href="../exceptions-0.8.3/Control-Monad-Catch.html#t:MonadMask">MonadMask</a> m) =&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; (<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m a) -&gt; m a <a href="src/Control.Retry.html#recoverAll" class="link">Source</a> <a href="#v:recoverAll" class="selflink">#</a></p><div class="doc"><p>Retry ALL exceptions that may be raised. To be used with caution;
 this matches the exception on <code><a href="../base-4.10.1.0/Control-Exception-Base.html#t:SomeException">SomeException</a></code>. Note that this
 handler explicitly does not handle <code><a href="../base-4.10.1.0/Control-Exception-Base.html#t:AsyncException">AsyncException</a></code> nor
 <code><a href="../base-4.10.1.0/Control-Exception-Base.html#t:SomeAsyncException">SomeAsyncException</a></code> (for versions of base &gt;= 4.7). It is not a
 good idea to catch async exceptions as it can result in hanging
 threads and programs. Note that if you just throw an exception to
 this thread that does not descend from SomeException, recoverAll
 will catch it.</p><p>See how the action below is run once and retried 5 more times
 before finally failing for good:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let f _ = putStrLn &quot;Running action&quot; &gt;&gt; error &quot;this is an error&quot;
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>recoverAll def f
</code></strong>Running action
Running action
Running action
Running action
Running action
Running action
*** Exception: this is an error
</pre></div></div><div class="top"><p class="src"><a id="v:skipAsyncExceptions" class="def">skipAsyncExceptions</a> :: <a href="../base-4.10.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m =&gt; [<a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; <a href="../exceptions-0.8.3/Control-Monad-Catch.html#t:Handler">Handler</a> m <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a>] <a href="src/Control.Retry.html#skipAsyncExceptions" class="link">Source</a> <a href="#v:skipAsyncExceptions" class="selflink">#</a></p><div class="doc"><p>List of pre-made handlers that will skip retries on
 <code><a href="../base-4.10.1.0/Control-Exception-Base.html#t:AsyncException">AsyncException</a></code> and <code><a href="../base-4.10.1.0/Control-Exception-Base.html#t:SomeAsyncException">SomeAsyncException</a></code>. Append your handlers to
 this list as a convenient way to make sure you're not catching
 async exceptions like user interrupt.</p></div></div><div class="top"><p class="src"><a id="v:logRetries" class="def">logRetries</a> <a href="src/Control.Retry.html#logRetries" class="link">Source</a> <a href="#v:logRetries" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="../base-4.10.1.0/Control-Monad.html#t:Monad">Monad</a> m, <a href="../base-4.10.1.0/Control-Exception-Base.html#t:Exception">Exception</a> e)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; (e -&gt; m <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a>)</td><td class="doc"><p>Test for whether action is to be retried</p></td></tr><tr><td class="src">-&gt; (<a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; e -&gt; <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; m ())</td><td class="doc"><p>How to report the generated warning message. Boolean is
 whether it's being retried or crashed.</p></td></tr><tr><td class="src">-&gt; <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a></td><td class="doc"><p>Retry number</p></td></tr><tr><td class="src">-&gt; <a href="../exceptions-0.8.3/Control-Monad-Catch.html#t:Handler">Handler</a> m <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Helper function for constructing handler functions of the form required
 by <code><a href="Control-Retry.html#v:recovering">recovering</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:defaultLogMsg" class="def">defaultLogMsg</a> :: <a href="../base-4.10.1.0/Control-Exception-Base.html#t:Exception">Exception</a> e =&gt; <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; e -&gt; <a href="Control-Retry.html#t:RetryStatus">RetryStatus</a> -&gt; <a href="../base-4.10.1.0/Data-String.html#t:String">String</a> <a href="src/Control.Retry.html#defaultLogMsg" class="link">Source</a> <a href="#v:defaultLogMsg" class="selflink">#</a></p><div class="doc"><p>For use with <code><a href="Control-Retry.html#v:logRetries">logRetries</a></code>.</p></div></div><h1 id="g:4">Retry Policies</h1><div class="top"><p class="src"><a id="v:constantDelay" class="def">constantDelay</a> <a href="src/Control.Retry.html#constantDelay" class="link">Source</a> <a href="#v:constantDelay" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>Base delay in microseconds</p></td></tr><tr><td class="src">-&gt; <a href="Control-Retry.html#t:RetryPolicy">RetryPolicy</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Implement a constant delay with unlimited retries.</p></div></div><div class="top"><p class="src"><a id="v:exponentialBackoff" class="def">exponentialBackoff</a> <a href="src/Control.Retry.html#exponentialBackoff" class="link">Source</a> <a href="#v:exponentialBackoff" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>Base delay in microseconds</p></td></tr><tr><td class="src">-&gt; <a href="Control-Retry.html#t:RetryPolicy">RetryPolicy</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Grow delay exponentially each iteration.  Each delay will
 increase by a factor of two.</p></div></div><div class="top"><p class="src"><a id="v:fullJitterBackoff" class="def">fullJitterBackoff</a> <a href="src/Control.Retry.html#fullJitterBackoff" class="link">Source</a> <a href="#v:fullJitterBackoff" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.10.1.0/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>Base delay in microseconds</p></td></tr><tr><td class="src">-&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>FullJitter exponential backoff as explained in AWS Architecture
 Blog article.</p><pre>http://www.awsarchitectureblog.com/2015/03/backoff.html</pre><p>temp = min(cap, base * 2 ** attempt)</p><p>sleep = temp / 2 + random_between(0, temp / 2)</p></div></div><div class="top"><p class="src"><a id="v:fibonacciBackoff" class="def">fibonacciBackoff</a> <a href="src/Control.Retry.html#fibonacciBackoff" class="link">Source</a> <a href="#v:fibonacciBackoff" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>Base delay in microseconds</p></td></tr><tr><td class="src">-&gt; <a href="Control-Retry.html#t:RetryPolicy">RetryPolicy</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Implement Fibonacci backoff.</p></div></div><div class="top"><p class="src"><a id="v:limitRetries" class="def">limitRetries</a> <a href="src/Control.Retry.html#limitRetries" class="link">Source</a> <a href="#v:limitRetries" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>Maximum number of retries.</p></td></tr><tr><td class="src">-&gt; <a href="Control-Retry.html#t:RetryPolicy">RetryPolicy</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Retry immediately, but only up to <code>n</code> times.</p></div></div><h1 id="g:5">Policy Transformers</h1><div class="top"><p class="src"><a id="v:limitRetriesByDelay" class="def">limitRetriesByDelay</a> <a href="src/Control.Retry.html#limitRetriesByDelay" class="link">Source</a> <a href="#v:limitRetriesByDelay" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.10.1.0/Control-Monad.html#t:Monad">Monad</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>Time-delay limit in microseconds.</p></td></tr><tr><td class="src">-&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Add an upperbound to a policy such that once the given time-delay
 amount *per try* has been reached or exceeded, the policy will stop
 retrying and fail. If you need to stop retrying once *cumulative*
 delay reaches a time-delay amount, use
 <code><a href="Control-Retry.html#v:limitRetriesByCumulativeDelay">limitRetriesByCumulativeDelay</a></code></p></div></div><div class="top"><p class="src"><a id="v:limitRetriesByCumulativeDelay" class="def">limitRetriesByCumulativeDelay</a> <a href="src/Control.Retry.html#limitRetriesByCumulativeDelay" class="link">Source</a> <a href="#v:limitRetriesByCumulativeDelay" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.10.1.0/Control-Monad.html#t:Monad">Monad</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>Time-delay limit in microseconds.</p></td></tr><tr><td class="src">-&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Add an upperbound to a policy such that once the cumulative delay
 over all retries has reached or exceeded the given limit, the
 policy will stop retrying and fail.</p></div></div><div class="top"><p class="src"><a id="v:capDelay" class="def">capDelay</a> <a href="src/Control.Retry.html#capDelay" class="link">Source</a> <a href="#v:capDelay" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.10.1.0/Control-Monad.html#t:Monad">Monad</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>A maximum delay in microseconds</p></td></tr><tr><td class="src">-&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Set a time-upperbound for any delays that may be directed by the
 given policy.  This function does not terminate the retrying.  The policy
 `capDelay maxDelay (exponentialBackoff n)` will never stop retrying.  It
 will reach a state where it retries forever with a delay of <code>maxDelay</code>
 between each one.  To get termination you need to use one of the
 <code><a href="Control-Retry.html#v:limitRetries">limitRetries</a></code> function variants.</p></div></div><h1 id="g:6">Development Helpers</h1><div class="top"><p class="src"><a id="v:simulatePolicy" class="def">simulatePolicy</a> :: <a href="../base-4.10.1.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> m -&gt; m [(<a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a>, <a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a>)] <a href="src/Control.Retry.html#simulatePolicy" class="link">Source</a> <a href="#v:simulatePolicy" class="selflink">#</a></p><div class="doc"><p>Run given policy up to N iterations and gather results. In the
 pair, the <code>Int</code> is the iteration number and the <code>Maybe Int</code> is the
 delay in microseconds.</p></div></div><div class="top"><p class="src"><a id="v:simulatePolicyPP" class="def">simulatePolicyPP</a> :: <a href="../base-4.10.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Control-Retry.html#t:RetryPolicyM">RetryPolicyM</a> <a href="../base-4.10.1.0/System-IO.html#t:IO">IO</a> -&gt; <a href="../base-4.10.1.0/System-IO.html#t:IO">IO</a> () <a href="src/Control.Retry.html#simulatePolicyPP" class="link">Source</a> <a href="#v:simulatePolicyPP" class="selflink">#</a></p><div class="doc"><p>Run given policy up to N iterations and pretty print results on
 the console.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.18.1</p></div></body></html>