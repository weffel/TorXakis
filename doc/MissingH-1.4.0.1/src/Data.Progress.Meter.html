<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
Copyright (c) 2006-2011 John Goerzen &lt;jgoerzen@complete.org&gt;

All rights reserved.

For license and copyright information, see the file LICENSE
-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-comment">{- |
   Module     : Data.Progress.Meter
   Copyright  : Copyright (C) 2006-2011 John Goerzen
   License    : BSD3

   Maintainer : John Goerzen &lt;jgoerzen@complete.org&gt;
   Stability  : provisional
   Portability: portable

Tool for maintaining a status bar, supporting multiple simultaneous tasks,
as a layer atop &quot;Data.Progress.Tracker&quot;.

Written by John Goerzen, jgoerzen\@complete.org -}</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Progress</span><span class="hs-operator">.</span><span class="hs-identifier">Meter</span><span> </span><span class="hs-special">(</span><span class="hs-comment">-- * Types</span><span>
</span><a name="line-24"></a><span>                               </span><a href="Data.Progress.Meter.html#ProgressMeter"><span class="hs-identifier hs-type">ProgressMeter</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>                               </span><span class="hs-comment">-- * Creation and Configuration</span><span>
</span><a name="line-26"></a><span>                               </span><a href="Data.Progress.Meter.html#simpleNewMeter"><span class="hs-identifier hs-var">simpleNewMeter</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>                               </span><a href="Data.Progress.Meter.html#newMeter"><span class="hs-identifier hs-var">newMeter</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>                               </span><a href="Data.Progress.Meter.html#setComponents"><span class="hs-identifier hs-var">setComponents</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>                               </span><a href="Data.Progress.Meter.html#addComponent"><span class="hs-identifier hs-var">addComponent</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>                               </span><a href="Data.Progress.Meter.html#removeComponent"><span class="hs-identifier hs-var">removeComponent</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>                               </span><a href="Data.Progress.Meter.html#setWidth"><span class="hs-identifier hs-var">setWidth</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span>                               </span><span class="hs-comment">-- * Rendering and Output</span><span>
</span><a name="line-34"></a><span>                               </span><a href="Data.Progress.Meter.html#renderMeter"><span class="hs-identifier hs-var">renderMeter</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>                               </span><a href="Data.Progress.Meter.html#displayMeter"><span class="hs-identifier hs-var">displayMeter</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>                               </span><a href="Data.Progress.Meter.html#clearMeter"><span class="hs-identifier hs-var">clearMeter</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>                               </span><a href="Data.Progress.Meter.html#writeMeterString"><span class="hs-identifier hs-var">writeMeterString</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>                               </span><a href="Data.Progress.Meter.html#autoDisplayMeter"><span class="hs-identifier hs-var">autoDisplayMeter</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>                               </span><a href="Data.Progress.Meter.html#killAutoDisplayMeter"><span class="hs-identifier hs-var">killAutoDisplayMeter</span></a><span>
</span><a name="line-40"></a><span>                               </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Progress.Tracker.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Progress</span><span class="hs-operator">.</span><span class="hs-identifier">Tracker</span></a><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Concurrent</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">when</span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="Data.String.Utils.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">String</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span></a><span> </span><span class="hs-special">(</span><a href="Data.List.Utils.html#join"><span class="hs-identifier hs-var">join</span></a><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><a href="System.Time.Utils.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Time</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span></a><span> </span><span class="hs-special">(</span><a href="System.Time.Utils.html#renderSecs"><span class="hs-identifier hs-var">renderSecs</span></a><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Quantity.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Quantity</span></a><span> </span><span class="hs-special">(</span><a href="Data.Quantity.html#renderNums"><span class="hs-identifier hs-var">renderNums</span></a><span class="hs-special">,</span><span> </span><a href="Data.Quantity.html#binaryOpts"><span class="hs-identifier hs-var">binaryOpts</span></a><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">filterM</span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-comment">{- | The main data type for the progress meter. -}</span><span>
</span><a name="line-52"></a><span class="hs-keyword">data</span><span> </span><a name="ProgressMeterR"><a href="Data.Progress.Meter.html#ProgressMeterR"><span class="hs-identifier">ProgressMeterR</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-53"></a><span>    </span><a name="ProgressMeterR"><a href="Data.Progress.Meter.html#ProgressMeterR"><span class="hs-identifier">ProgressMeterR</span></a></a><span> </span><span class="hs-special">{</span><a name="masterP"><a href="Data.Progress.Meter.html#masterP"><span class="hs-identifier">masterP</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Progress.Tracker.html#Progress"><span class="hs-identifier hs-type">Progress</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ The master 'Progress' object for overall status</span><span>
</span><a name="line-54"></a><span>                    </span><a name="components"><a href="Data.Progress.Meter.html#components"><span class="hs-identifier">components</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Data.Progress.Tracker.html#Progress"><span class="hs-identifier hs-type">Progress</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Individual component statuses</span><span>
</span><a name="line-55"></a><span>                    </span><a name="width"><a href="Data.Progress.Meter.html#width"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Width of the meter</span><span>
</span><a name="line-56"></a><span>                    </span><a name="unit"><a href="Data.Progress.Meter.html#unit"><span class="hs-identifier">unit</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Units of display</span><span>
</span><a name="line-57"></a><span>                    </span><a name="renderer"><a href="Data.Progress.Meter.html#renderer"><span class="hs-identifier">renderer</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Function to render numbers</span><span>
</span><a name="line-58"></a><span>                    </span><a name="autoDisplayers"><a href="Data.Progress.Meter.html#autoDisplayers"><span class="hs-identifier">autoDisplayers</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ThreadId</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Auto-updating display</span><span>
</span><a name="line-59"></a><span>                   </span><span class="hs-special">}</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-keyword">type</span><span> </span><a name="ProgressMeter"><a href="Data.Progress.Meter.html#ProgressMeter"><span class="hs-identifier">ProgressMeter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">MVar</span><span> </span><a href="Data.Progress.Meter.html#ProgressMeterR"><span class="hs-identifier hs-type">ProgressMeterR</span></a><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-comment">{- | Set up a new status bar using defaults:

* The given tracker

* Width 80

* Data.Quantity.renderNums binaryOpts 1

* Unit inticator @&quot;B&quot;@

-}</span><span>
</span><a name="line-74"></a><span class="hs-identifier">simpleNewMeter</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Progress.Tracker.html#Progress"><span class="hs-identifier hs-type">Progress</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Data.Progress.Meter.html#ProgressMeter"><span class="hs-identifier hs-type">ProgressMeter</span></a><span>
</span><a name="line-75"></a><a name="simpleNewMeter"><a href="Data.Progress.Meter.html#simpleNewMeter"><span class="hs-identifier">simpleNewMeter</span></a></a><span> </span><a name="local-6989586621679099846"><a href="#local-6989586621679099846"><span class="hs-identifier">pt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Progress.Meter.html#newMeter"><span class="hs-identifier hs-var">newMeter</span></a><span> </span><a href="#local-6989586621679099846"><span class="hs-identifier hs-var">pt</span></a><span> </span><span class="hs-string">&quot;B&quot;</span><span> </span><span class="hs-number">80</span><span> </span><span class="hs-special">(</span><a href="Data.Quantity.html#renderNums"><span class="hs-identifier hs-var">renderNums</span></a><span> </span><a href="Data.Quantity.html#binaryOpts"><span class="hs-identifier hs-var">binaryOpts</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span class="hs-comment">{- | Set up a new status bar. -}</span><span>
</span><a name="line-78"></a><span class="hs-identifier">newMeter</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Progress.Tracker.html#Progress"><span class="hs-identifier hs-type">Progress</span></a><span>           </span><span class="hs-comment">-- ^ The top-level 'Progress'</span><span>
</span><a name="line-79"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>              </span><span class="hs-comment">-- ^ Unit indicator string</span><span>
</span><a name="line-80"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>                </span><span class="hs-comment">-- ^ Width of the terminal -- usually 80</span><span>
</span><a name="line-81"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-comment">-- ^ A function to render sizes</span><span>
</span><a name="line-82"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Data.Progress.Meter.html#ProgressMeter"><span class="hs-identifier hs-type">ProgressMeter</span></a><span>
</span><a name="line-83"></a><a name="newMeter"><a href="Data.Progress.Meter.html#newMeter"><span class="hs-identifier">newMeter</span></a></a><span> </span><a name="local-6989586621679099847"><a href="#local-6989586621679099847"><span class="hs-identifier">tracker</span></a></a><span> </span><a name="local-6989586621679099848"><a href="#local-6989586621679099848"><span class="hs-identifier">u</span></a></a><span> </span><a name="local-6989586621679099849"><a href="#local-6989586621679099849"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621679099850"><a href="#local-6989586621679099850"><span class="hs-identifier">rfunc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-84"></a><span>    </span><span class="hs-identifier hs-var">newMVar</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Progress.Meter.html#ProgressMeterR"><span class="hs-identifier hs-var">ProgressMeterR</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">masterP</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679099847"><span class="hs-identifier hs-var">tracker</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">components</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-85"></a><span>                         </span><span class="hs-identifier">width</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679099849"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">renderer</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679099850"><span class="hs-identifier hs-var">rfunc</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">autoDisplayers</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-86"></a><span>                         </span><span class="hs-identifier">unit</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679099848"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">}</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-comment">{- | Adjust the list of components of this 'ProgressMeter'. -}</span><span>
</span><a name="line-89"></a><span class="hs-identifier">setComponents</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Progress.Meter.html#ProgressMeter"><span class="hs-identifier hs-type">ProgressMeter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Data.Progress.Tracker.html#Progress"><span class="hs-identifier hs-type">Progress</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-90"></a><a name="setComponents"><a href="Data.Progress.Meter.html#setComponents"><span class="hs-identifier">setComponents</span></a></a><span> </span><a name="local-6989586621679099851"><a href="#local-6989586621679099851"><span class="hs-identifier">meter</span></a></a><span> </span><a name="local-6989586621679099852"><a href="#local-6989586621679099852"><span class="hs-identifier">componentlist</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">modifyMVar_</span><span> </span><a href="#local-6989586621679099851"><span class="hs-identifier hs-var">meter</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679099853"><a href="#local-6989586621679099853"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679099853"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">components</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679099852"><span class="hs-identifier hs-var">componentlist</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-comment">{- | Add a new component to the list of components. -}</span><span>
</span><a name="line-93"></a><span class="hs-identifier">addComponent</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Progress.Meter.html#ProgressMeter"><span class="hs-identifier hs-type">ProgressMeter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Progress.Tracker.html#Progress"><span class="hs-identifier hs-type">Progress</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><a name="addComponent"><a href="Data.Progress.Meter.html#addComponent"><span class="hs-identifier">addComponent</span></a></a><span> </span><a name="local-6989586621679099854"><a href="#local-6989586621679099854"><span class="hs-identifier">meter</span></a></a><span> </span><a name="local-6989586621679099855"><a href="#local-6989586621679099855"><span class="hs-identifier">component</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-95"></a><span>    </span><span class="hs-identifier hs-var">modifyMVar_</span><span> </span><a href="#local-6989586621679099854"><span class="hs-identifier hs-var">meter</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679099856"><a href="#local-6989586621679099856"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679099856"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">components</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679099855"><span class="hs-identifier hs-var">component</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">components</span><span> </span><a href="#local-6989586621679099856"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span class="hs-comment">{- | Remove a component by name. -}</span><span>
</span><a name="line-98"></a><span class="hs-identifier">removeComponent</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Progress.Meter.html#ProgressMeter"><span class="hs-identifier hs-type">ProgressMeter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-99"></a><a name="removeComponent"><a href="Data.Progress.Meter.html#removeComponent"><span class="hs-identifier">removeComponent</span></a></a><span> </span><a name="local-6989586621679099857"><a href="#local-6989586621679099857"><span class="hs-identifier">meter</span></a></a><span> </span><a name="local-6989586621679099858"><a href="#local-6989586621679099858"><span class="hs-identifier">componentname</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">modifyMVar_</span><span> </span><a href="#local-6989586621679099857"><span class="hs-identifier hs-var">meter</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679099859"><a href="#local-6989586621679099859"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-100"></a><span>   </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679099862"><a href="#local-6989586621679099862"><span class="hs-identifier">newc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">filterM</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679099860"><a href="#local-6989586621679099860"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Progress.Tracker.html#withStatus"><span class="hs-identifier hs-var">withStatus</span></a><span> </span><a href="#local-6989586621679099860"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679099861"><a href="#local-6989586621679099861"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">trackerName</span><span> </span><a href="#local-6989586621679099861"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679099858"><span class="hs-identifier hs-var">componentname</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>              </span><span class="hs-special">(</span><span class="hs-identifier">components</span><span> </span><a href="#local-6989586621679099859"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-102"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679099859"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">components</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679099862"><span class="hs-identifier hs-var">newc</span></a><span class="hs-special">}</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-comment">{- | Adjusts the width of this 'ProgressMeter'. -}</span><span>
</span><a name="line-105"></a><span class="hs-identifier">setWidth</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Progress.Meter.html#ProgressMeter"><span class="hs-identifier hs-type">ProgressMeter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-106"></a><a name="setWidth"><a href="Data.Progress.Meter.html#setWidth"><span class="hs-identifier">setWidth</span></a></a><span> </span><a name="local-6989586621679099863"><a href="#local-6989586621679099863"><span class="hs-identifier">meter</span></a></a><span> </span><a name="local-6989586621679099864"><a href="#local-6989586621679099864"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">modifyMVar_</span><span> </span><a href="#local-6989586621679099863"><span class="hs-identifier hs-var">meter</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679099865"><a href="#local-6989586621679099865"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679099865"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">width</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679099864"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-comment">{- | Like renderMeter, but prints it to the screen instead of returning it.

This function will output CR, then the meter.

Pass stdout as the handle for regular display to the screen. -}</span><span>
</span><a name="line-113"></a><span class="hs-identifier">displayMeter</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Progress.Meter.html#ProgressMeter"><span class="hs-identifier hs-type">ProgressMeter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-114"></a><a name="displayMeter"><a href="Data.Progress.Meter.html#displayMeter"><span class="hs-identifier">displayMeter</span></a></a><span> </span><a name="local-6989586621679099866"><a href="#local-6989586621679099866"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679099867"><a href="#local-6989586621679099867"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withMVar</span><span> </span><a href="#local-6989586621679099867"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679099868"><a href="#local-6989586621679099868"><span class="hs-identifier">meter</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-115"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679099869"><a href="#local-6989586621679099869"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Progress.Meter.html#renderMeterR"><span class="hs-identifier hs-var">renderMeterR</span></a><span> </span><a href="#local-6989586621679099868"><span class="hs-identifier hs-var">meter</span></a><span>
</span><a name="line-116"></a><span>       </span><span class="hs-identifier hs-var">hPutStr</span><span> </span><a href="#local-6989586621679099866"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;\r&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679099869"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>       </span><span class="hs-identifier hs-var">hFlush</span><span> </span><a href="#local-6989586621679099866"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-118"></a><span>       </span><span class="hs-comment">-- By placing this whole thing under withMVar, we can effectively</span><span>
</span><a name="line-119"></a><span>       </span><span class="hs-comment">-- lock the IO and prevent IO from stomping on each other.</span><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-comment">{- | Clears the meter -- outputs CR, spaces equal to the width - 1,
then another CR.

Pass stdout as the handle for regular display to the screen. -}</span><span>
</span><a name="line-125"></a><span class="hs-identifier">clearMeter</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Progress.Meter.html#ProgressMeter"><span class="hs-identifier hs-type">ProgressMeter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-126"></a><a name="clearMeter"><a href="Data.Progress.Meter.html#clearMeter"><span class="hs-identifier">clearMeter</span></a></a><span> </span><a name="local-6989586621679099870"><a href="#local-6989586621679099870"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679099871"><a href="#local-6989586621679099871"><span class="hs-identifier">pm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withMVar</span><span> </span><a href="#local-6989586621679099871"><span class="hs-identifier hs-var">pm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679099872"><a href="#local-6989586621679099872"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-127"></a><span>                     </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">hPutStr</span><span> </span><a href="#local-6989586621679099870"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">(</span><a href="Data.Progress.Meter.html#clearmeterstr"><span class="hs-identifier hs-var">clearmeterstr</span></a><span> </span><a href="#local-6989586621679099872"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-128"></a><span>                        </span><span class="hs-identifier hs-var">hFlush</span><span> </span><a href="#local-6989586621679099870"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span class="hs-comment">{- | Clears the meter, writes the given string, then restores the meter.
The string is assumed to contain a trailing newline.

Pass stdout as the handle for regular display to the screen. -}</span><span>
</span><a name="line-134"></a><span class="hs-identifier">writeMeterString</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Progress.Meter.html#ProgressMeter"><span class="hs-identifier hs-type">ProgressMeter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-135"></a><a name="writeMeterString"><a href="Data.Progress.Meter.html#writeMeterString"><span class="hs-identifier">writeMeterString</span></a></a><span> </span><a name="local-6989586621679099873"><a href="#local-6989586621679099873"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679099874"><a href="#local-6989586621679099874"><span class="hs-identifier">pm</span></a></a><span> </span><a name="local-6989586621679099875"><a href="#local-6989586621679099875"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withMVar</span><span> </span><a href="#local-6989586621679099874"><span class="hs-identifier hs-var">pm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679099876"><a href="#local-6989586621679099876"><span class="hs-identifier">meter</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-136"></a><span>                            </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679099877"><a href="#local-6989586621679099877"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Progress.Meter.html#renderMeterR"><span class="hs-identifier hs-var">renderMeterR</span></a><span> </span><a href="#local-6989586621679099876"><span class="hs-identifier hs-var">meter</span></a><span>
</span><a name="line-137"></a><span>                               </span><span class="hs-identifier hs-var">hPutStr</span><span> </span><a href="#local-6989586621679099873"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">(</span><a href="Data.Progress.Meter.html#clearmeterstr"><span class="hs-identifier hs-var">clearmeterstr</span></a><span> </span><a href="#local-6989586621679099876"><span class="hs-identifier hs-var">meter</span></a><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>                               </span><span class="hs-identifier hs-var">hPutStr</span><span> </span><a href="#local-6989586621679099873"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679099875"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-139"></a><span>                               </span><span class="hs-identifier hs-var">hPutStr</span><span> </span><a href="#local-6989586621679099873"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679099877"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-140"></a><span>                               </span><span class="hs-identifier hs-var">hFlush</span><span> </span><a href="#local-6989586621679099873"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-identifier">clearmeterstr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Progress.Meter.html#ProgressMeterR"><span class="hs-identifier hs-type">ProgressMeterR</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-143"></a><a name="clearmeterstr"><a href="Data.Progress.Meter.html#clearmeterstr"><span class="hs-identifier">clearmeterstr</span></a></a><span> </span><a name="local-6989586621679099878"><a href="#local-6989586621679099878"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;\r&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">width</span><span> </span><a href="#local-6989586621679099878"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-char">' '</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\r&quot;</span><span>
</span><a name="line-144"></a><span>
</span><a name="line-145"></a><span class="hs-comment">{- | Starts a thread that updates the meter every n seconds by calling
the specified function.  Note: @displayMeter stdout@
is an ideal function here.

Save this threadID and use it later to call 'stopAutoDisplayMeter'.
-}</span><span>
</span><a name="line-151"></a><span class="hs-identifier">autoDisplayMeter</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Progress.Meter.html#ProgressMeter"><span class="hs-identifier hs-type">ProgressMeter</span></a><span> </span><span class="hs-comment">-- ^ The meter to display</span><span>
</span><a name="line-152"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>         </span><span class="hs-comment">-- ^ Update interval in seconds</span><span>
</span><a name="line-153"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Progress.Meter.html#ProgressMeter"><span class="hs-identifier hs-type">ProgressMeter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Function to display it</span><span>
</span><a name="line-154"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">ThreadId</span><span> </span><span class="hs-comment">-- ^ Resulting thread id</span><span>
</span><a name="line-155"></a><a name="autoDisplayMeter"><a href="Data.Progress.Meter.html#autoDisplayMeter"><span class="hs-identifier">autoDisplayMeter</span></a></a><span> </span><a name="local-6989586621679099879"><a href="#local-6989586621679099879"><span class="hs-identifier">pm</span></a></a><span> </span><a name="local-6989586621679099880"><a href="#local-6989586621679099880"><span class="hs-identifier">delay</span></a></a><span> </span><a name="local-6989586621679099881"><a href="#local-6989586621679099881"><span class="hs-identifier">displayfunc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-156"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679099926"><a href="#local-6989586621679099926"><span class="hs-identifier">thread</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">forkIO</span><span> </span><a href="#local-6989586621679099882"><span class="hs-identifier hs-var">workerthread</span></a><span>
</span><a name="line-157"></a><span>       </span><span class="hs-identifier hs-var">modifyMVar_</span><span> </span><a href="#local-6989586621679099879"><span class="hs-identifier hs-var">pm</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679099927"><a href="#local-6989586621679099927"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679099927"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">autoDisplayers</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679099926"><span class="hs-identifier hs-var">thread</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">autoDisplayers</span><span> </span><a href="#local-6989586621679099927"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-158"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679099926"><span class="hs-identifier hs-var">thread</span></a><span>
</span><a name="line-159"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679099882"><a href="#local-6989586621679099882"><span class="hs-identifier">workerthread</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679099885"><a href="#local-6989586621679099885"><span class="hs-identifier">tid</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">myThreadId</span><span>
</span><a name="line-160"></a><span>                            </span><span class="hs-comment">-- Help fix a race condition so that the above</span><span>
</span><a name="line-161"></a><span>                            </span><span class="hs-comment">-- modifyMVar can run before a check ever does</span><span>
</span><a name="line-162"></a><span>                            </span><span class="hs-identifier hs-var">yield</span><span>
</span><a name="line-163"></a><span>                            </span><a href="#local-6989586621679099883"><span class="hs-identifier hs-var">loop</span></a><span> </span><a href="#local-6989586621679099885"><span class="hs-identifier hs-var">tid</span></a><span>
</span><a name="line-164"></a><span>          </span><a name="local-6989586621679099883"><a href="#local-6989586621679099883"><span class="hs-identifier">loop</span></a></a><span> </span><a name="local-6989586621679099886"><a href="#local-6989586621679099886"><span class="hs-identifier">tid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="#local-6989586621679099881"><span class="hs-identifier hs-var">displayfunc</span></a><span> </span><a href="#local-6989586621679099879"><span class="hs-identifier hs-var">pm</span></a><span>
</span><a name="line-165"></a><span>                        </span><span class="hs-identifier hs-var">threadDelay</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679099880"><span class="hs-identifier hs-var">delay</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">1000000</span><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span>                        </span><a name="local-6989586621679099923"><a href="#local-6989586621679099923"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679099884"><span class="hs-identifier hs-var">doIContinue</span></a><span> </span><a href="#local-6989586621679099886"><span class="hs-identifier hs-var">tid</span></a><span>
</span><a name="line-167"></a><span>                        </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621679099923"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679099883"><span class="hs-identifier hs-var">loop</span></a><span> </span><a href="#local-6989586621679099886"><span class="hs-identifier hs-var">tid</span></a><span class="hs-special">)</span><span>
</span><a name="line-168"></a><span>          </span><a name="local-6989586621679099884"><a href="#local-6989586621679099884"><span class="hs-identifier">doIContinue</span></a></a><span> </span><a name="local-6989586621679099924"><a href="#local-6989586621679099924"><span class="hs-identifier">tid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withMVar</span><span> </span><a href="#local-6989586621679099879"><span class="hs-identifier hs-var">pm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679099925"><a href="#local-6989586621679099925"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-169"></a><span>                               </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679099924"><span class="hs-identifier hs-var">tid</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">autoDisplayers</span><span> </span><a href="#local-6989586621679099925"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-170"></a><span>                                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-171"></a><span>                                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-comment">{- | Stops the specified meter from displaying.

You should probably call 'clearMeter' after a call to this. -}</span><span>
</span><a name="line-176"></a><span class="hs-identifier">killAutoDisplayMeter</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Progress.Meter.html#ProgressMeter"><span class="hs-identifier hs-type">ProgressMeter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ThreadId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-177"></a><a name="killAutoDisplayMeter"><a href="Data.Progress.Meter.html#killAutoDisplayMeter"><span class="hs-identifier">killAutoDisplayMeter</span></a></a><span> </span><a name="local-6989586621679099928"><a href="#local-6989586621679099928"><span class="hs-identifier">pm</span></a></a><span> </span><a name="local-6989586621679099929"><a href="#local-6989586621679099929"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-178"></a><span>    </span><span class="hs-identifier hs-var">modifyMVar_</span><span> </span><a href="#local-6989586621679099928"><span class="hs-identifier hs-var">pm</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679099930"><a href="#local-6989586621679099930"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679099930"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">autoDisplayers</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679099929"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">autoDisplayers</span><span> </span><a href="#local-6989586621679099930"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span class="hs-comment">{- | Render the current status. -}</span><span>
</span><a name="line-181"></a><span class="hs-identifier">renderMeter</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Progress.Meter.html#ProgressMeter"><span class="hs-identifier hs-type">ProgressMeter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-182"></a><a name="renderMeter"><a href="Data.Progress.Meter.html#renderMeter"><span class="hs-identifier">renderMeter</span></a></a><span> </span><a name="local-6989586621679099931"><a href="#local-6989586621679099931"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withMVar</span><span> </span><a href="#local-6989586621679099931"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.Progress.Meter.html#renderMeterR"><span class="hs-identifier hs-var">renderMeterR</span></a><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span class="hs-identifier">renderMeterR</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Progress.Meter.html#ProgressMeterR"><span class="hs-identifier hs-type">ProgressMeterR</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-185"></a><a name="renderMeterR"><a href="Data.Progress.Meter.html#renderMeterR"><span class="hs-identifier">renderMeterR</span></a></a><span> </span><a name="local-6989586621679099932"><a href="#local-6989586621679099932"><span class="hs-identifier">meter</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-186"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679099951"><a href="#local-6989586621679099951"><span class="hs-identifier">overallpct</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679099934"><span class="hs-identifier hs-var">renderpct</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">masterP</span><span> </span><a href="#local-6989586621679099932"><span class="hs-identifier hs-var">meter</span></a><span>
</span><a name="line-187"></a><span>       </span><a name="local-6989586621679099952"><a href="#local-6989586621679099952"><span class="hs-identifier">compnnts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679099936"><span class="hs-identifier hs-var">rendercomponent</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">renderer</span><span> </span><a href="#local-6989586621679099932"><span class="hs-identifier hs-var">meter</span></a><span class="hs-special">)</span><span>
</span><a name="line-188"></a><span>                     </span><span class="hs-special">(</span><span class="hs-identifier">components</span><span> </span><a href="#local-6989586621679099932"><span class="hs-identifier hs-var">meter</span></a><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679099953"><a href="#local-6989586621679099953"><span class="hs-identifier">componentstr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Data.List.Utils.html#join"><span class="hs-identifier hs-var">join</span></a><span> </span><span class="hs-string">&quot; &quot;</span><span> </span><a href="#local-6989586621679099952"><span class="hs-identifier hs-var">compnnts</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-190"></a><span>                            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-191"></a><span>                            </span><a name="local-6989586621679099954"><a href="#local-6989586621679099954"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679099954"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span>
</span><a name="line-192"></a><span>       </span><a name="local-6989586621679099955"><a href="#local-6989586621679099955"><span class="hs-identifier">rightpart</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679099937"><span class="hs-identifier hs-var">renderoverall</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">renderer</span><span> </span><a href="#local-6989586621679099932"><span class="hs-identifier hs-var">meter</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">masterP</span><span> </span><a href="#local-6989586621679099932"><span class="hs-identifier hs-var">meter</span></a><span class="hs-special">)</span><span>
</span><a name="line-193"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679099956"><a href="#local-6989586621679099956"><span class="hs-identifier">leftpart</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679099951"><span class="hs-identifier hs-var">overallpct</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679099953"><span class="hs-identifier hs-var">componentstr</span></a><span>
</span><a name="line-194"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679099957"><a href="#local-6989586621679099957"><span class="hs-identifier">padwidth</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">width</span><span> </span><a href="#local-6989586621679099932"><span class="hs-identifier hs-var">meter</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679099956"><span class="hs-identifier hs-var">leftpart</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679099955"><span class="hs-identifier hs-var">rightpart</span></a><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>       </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679099957"><span class="hs-identifier hs-var">padwidth</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-196"></a><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">width</span><span> </span><a href="#local-6989586621679099932"><span class="hs-identifier hs-var">meter</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679099956"><span class="hs-identifier hs-var">leftpart</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679099955"><span class="hs-identifier hs-var">rightpart</span></a><span>
</span><a name="line-197"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679099956"><span class="hs-identifier hs-var">leftpart</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621679099957"><span class="hs-identifier hs-var">padwidth</span></a><span> </span><span class="hs-char">' '</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679099955"><span class="hs-identifier hs-var">rightpart</span></a><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-200"></a><span>      </span><a name="local-6989586621679099933"><a href="#local-6989586621679099933"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unit</span><span> </span><a href="#local-6989586621679099932"><span class="hs-identifier hs-var">meter</span></a><span>
</span><a name="line-201"></a><span>      </span><a name="local-6989586621679099934"><a href="#local-6989586621679099934"><span class="hs-identifier">renderpct</span></a></a><span> </span><a name="local-6989586621679099939"><a href="#local-6989586621679099939"><span class="hs-identifier">pt</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-202"></a><span>              </span><a href="Data.Progress.Tracker.html#withStatus"><span class="hs-identifier hs-var">withStatus</span></a><span> </span><a href="#local-6989586621679099939"><span class="hs-identifier hs-var">pt</span></a><span> </span><a href="#local-6989586621679099935"><span class="hs-identifier hs-var">renderpctpts</span></a><span>
</span><a name="line-203"></a><span>      </span><a name="local-6989586621679099935"><a href="#local-6989586621679099935"><span class="hs-identifier">renderpctpts</span></a></a><span> </span><a name="local-6989586621679099940"><a href="#local-6989586621679099940"><span class="hs-identifier">pts</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-204"></a><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">totalUnits</span><span> </span><a href="#local-6989586621679099940"><span class="hs-identifier hs-var">pts</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-205"></a><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-string">&quot;0%&quot;</span><span>
</span><a name="line-206"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">completedUnits</span><span> </span><a href="#local-6989586621679099940"><span class="hs-identifier hs-var">pts</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">100</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">totalUnits</span><span> </span><a href="#local-6989586621679099940"><span class="hs-identifier hs-var">pts</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;%&quot;</span><span>
</span><a name="line-207"></a><span>      </span><span class="hs-identifier">rendercomponent</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Progress.Tracker.html#Progress"><span class="hs-identifier hs-type">Progress</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-208"></a><span>      </span><a name="local-6989586621679099936"><a href="#local-6989586621679099936"><span class="hs-identifier">rendercomponent</span></a></a><span> </span><a name="local-6989586621679099941"><a href="#local-6989586621679099941"><span class="hs-identifier">rfunc</span></a></a><span> </span><a name="local-6989586621679099942"><a href="#local-6989586621679099942"><span class="hs-identifier">pt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Progress.Tracker.html#withStatus"><span class="hs-identifier hs-var">withStatus</span></a><span> </span><a href="#local-6989586621679099942"><span class="hs-identifier hs-var">pt</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679099943"><a href="#local-6989586621679099943"><span class="hs-identifier">pts</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-209"></a><span>              </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679099944"><a href="#local-6989586621679099944"><span class="hs-identifier">pct</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679099935"><span class="hs-identifier hs-var">renderpctpts</span></a><span> </span><a href="#local-6989586621679099943"><span class="hs-identifier hs-var">pts</span></a><span>
</span><a name="line-210"></a><span>                 </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679099945"><a href="#local-6989586621679099945"><span class="hs-identifier">renders</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679099941"><span class="hs-identifier hs-var">rfunc</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier">totalUnits</span><span> </span><a href="#local-6989586621679099943"><span class="hs-identifier hs-var">pts</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">completedUnits</span><span> </span><a href="#local-6989586621679099943"><span class="hs-identifier hs-var">pts</span></a><span class="hs-special">]</span><span>
</span><a name="line-211"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;[&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">trackerName</span><span> </span><a href="#local-6989586621679099943"><span class="hs-identifier hs-var">pts</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-212"></a><span>                     </span><span class="hs-special">(</span><a href="#local-6989586621679099945"><span class="hs-identifier hs-var">renders</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679099933"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;/&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-213"></a><span>                     </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679099945"><span class="hs-identifier hs-var">renders</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679099933"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679099944"><span class="hs-identifier hs-var">pct</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;]&quot;</span><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span>      </span><span class="hs-identifier">renderoverall</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Progress.Tracker.html#ProgressStatuses"><span class="hs-identifier hs-type">ProgressStatuses</span></a><span> </span><a href="#local-6989586621679099938"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Char</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Char</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679099938"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Char</span><span class="hs-special">]</span><span>
</span><a name="line-216"></a><span>      </span><a name="local-6989586621679099937"><a href="#local-6989586621679099937"><span class="hs-identifier">renderoverall</span></a></a><span> </span><a name="local-6989586621679099946"><a href="#local-6989586621679099946"><span class="hs-identifier">rfunc</span></a></a><span> </span><a name="local-6989586621679099947"><a href="#local-6989586621679099947"><span class="hs-identifier">pt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Progress.Tracker.html#withStatus"><span class="hs-identifier hs-var">withStatus</span></a><span> </span><a href="#local-6989586621679099947"><span class="hs-identifier hs-var">pt</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679099948"><a href="#local-6989586621679099948"><span class="hs-identifier">pts</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-217"></a><span>                                         </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679099949"><a href="#local-6989586621679099949"><span class="hs-identifier">etr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Progress.Tracker.html#getETR"><span class="hs-identifier hs-var">getETR</span></a><span> </span><a href="#local-6989586621679099948"><span class="hs-identifier hs-var">pts</span></a><span>
</span><a name="line-218"></a><span>                                            </span><a name="local-6989586621679099950"><a href="#local-6989586621679099950"><span class="hs-identifier">speed</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Progress.Tracker.html#getSpeed"><span class="hs-identifier hs-var">getSpeed</span></a><span> </span><a href="#local-6989586621679099948"><span class="hs-identifier hs-var">pts</span></a><span>
</span><a name="line-219"></a><span>                                            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679099946"><span class="hs-identifier hs-var">rfunc</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">floor</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679099950"><span class="hs-identifier hs-var">speed</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Double</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679099933"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-220"></a><span>                                                       </span><span class="hs-string">&quot;/s &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="System.Time.Utils.html#renderSecs"><span class="hs-identifier hs-var">renderSecs</span></a><span> </span><a href="#local-6989586621679099949"><span class="hs-identifier hs-var">etr</span></a><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a></pre></body></html>