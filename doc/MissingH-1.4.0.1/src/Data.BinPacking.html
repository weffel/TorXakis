<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE Safe #-}</span><span>
</span><a name="line-2"></a><span class="hs-comment">{-
Copyright (c) 2008-2011 John Goerzen &lt;jgoerzen@complete.org&gt;

All rights reserved.

For license and copyright information, see the file LICENSE
-}</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-comment">{- |
   Module     : Data.BinPacking
   Copyright  : Copyright (C) 2008-2011 John Goerzen
   License    : BSD3

   Maintainer : John Goerzen &lt;jgoerzen@complete.org&gt; 
   Stability  : provisional
   Portability: portable

Tools for packing into bins

Written by John Goerzen, jgoerzen\@complete.org

This module is designed to solve this type of problem: Given a bunch of
objects of varying sizes, what is the best possible way to pack them into
fixed-size bins?  This can be used, for instance, by the datapacker program
to pack files onto CDs or DVDs; by manufacturing environments to pack
physical items into physicl bins; etc.

A description of bin packing algorithms can be found at
&lt;http://en.wikipedia.org/wiki/Bin_packing_problem&gt;.
-}</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">BinPacking</span><span> </span><span class="hs-special">(</span><a href="Data.BinPacking.html#BinPacker"><span class="hs-identifier hs-type">BinPacker</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>                        </span><a href="Data.BinPacking.html#BinPackerError"><span class="hs-identifier hs-type">BinPackerError</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>                        </span><a href="Data.BinPacking.html#packByOrder"><span class="hs-identifier hs-var">packByOrder</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>                        </span><a href="Data.BinPacking.html#packLargeFirst"><span class="hs-identifier hs-var">packLargeFirst</span></a><span>
</span><a name="line-37"></a><span>                       </span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-keyword">where</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Error</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-comment">{- | Potential errors returned as Left values by 'BinPacker' functions. 
Calling 'show' on this value will produce a nice error message suitable for
display. -}</span><span>
</span><a name="line-46"></a><span class="hs-keyword">data</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679103991"><span class="hs-identifier hs-type">size</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679103991"><span class="hs-identifier hs-type">size</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679103991"><span class="hs-identifier hs-type">size</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679103992"><span class="hs-identifier hs-type">obj</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="BinPackerError"><a href="Data.BinPacking.html#BinPackerError"><span class="hs-identifier">BinPackerError</span></a></a><span> </span><a name="local-6989586621679103991"><a href="#local-6989586621679103991"><span class="hs-identifier">size</span></a></a><span> </span><a name="local-6989586621679103992"><a href="#local-6989586621679103992"><span class="hs-identifier">obj</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-47"></a><span>    </span><a name="BPTooFewBins"><a href="Data.BinPacking.html#BPTooFewBins"><span class="hs-identifier">BPTooFewBins</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679103991"><span class="hs-identifier hs-type">size</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679103992"><span class="hs-identifier hs-type">obj</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>                </span><span class="hs-comment">-- ^ Ran out of bins; attached value is the list of objects that do not fit</span><span>
</span><a name="line-48"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="BPSizeTooLarge"><a href="Data.BinPacking.html#BPSizeTooLarge"><span class="hs-identifier">BPSizeTooLarge</span></a></a><span> </span><a href="#local-6989586621679103991"><span class="hs-identifier hs-type">size</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679103991"><span class="hs-identifier hs-type">size</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679103992"><span class="hs-identifier hs-type">obj</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ Bin size1 exceeded by at least the given object and size</span><span>
</span><a name="line-49"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="BPOther"><a href="Data.BinPacking.html#BPOther"><span class="hs-identifier">BPOther</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span>                    </span><span class="hs-comment">-- ^ Other error</span><span>
</span><a name="line-50"></a><span>      </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Read</span><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679104027"><span class="hs-identifier hs-type">size</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679104027"><span class="hs-identifier hs-type">size</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679104027"><span class="hs-identifier hs-type">size</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679104028"><span class="hs-identifier hs-type">obj</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><span class="hs-special">(</span><a href="Data.BinPacking.html#BinPackerError"><span class="hs-identifier hs-type">BinPackerError</span></a><span> </span><a href="#local-6989586621679104027"><span class="hs-identifier hs-type">size</span></a><span> </span><a href="#local-6989586621679104028"><span class="hs-identifier hs-type">obj</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-53"></a><span>    </span><a name="local-8214565720323784721"><span class="hs-identifier">show</span></a><span> </span><span class="hs-special">(</span><a href="Data.BinPacking.html#BPTooFewBins"><span class="hs-identifier hs-var">BPTooFewBins</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Too few bins&quot;</span><span>
</span><a name="line-54"></a><span>    </span><span class="hs-identifier">show</span><span> </span><span class="hs-special">(</span><a href="Data.BinPacking.html#BPSizeTooLarge"><span class="hs-identifier hs-var">BPSizeTooLarge</span></a><span> </span><a name="local-6989586621679104029"><a href="#local-6989586621679104029"><span class="hs-identifier">binsize</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679104030"><a href="#local-6989586621679104030"><span class="hs-identifier">objsize</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679104031"><a href="#local-6989586621679104031"><span class="hs-identifier">obj</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-55"></a><span>        </span><span class="hs-string">&quot;Size &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679104030"><span class="hs-identifier hs-var">objsize</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; greater than bin size &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679104029"><span class="hs-identifier hs-var">binsize</span></a><span>
</span><a name="line-56"></a><span>        </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; at &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679104031"><span class="hs-identifier hs-var">obj</span></a><span>
</span><a name="line-57"></a><span>    </span><span class="hs-identifier">show</span><span> </span><span class="hs-special">(</span><a href="Data.BinPacking.html#BPOther"><span class="hs-identifier hs-var">BPOther</span></a><span> </span><a name="local-6989586621679104032"><a href="#local-6989586621679104032"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679104032"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-comment">{- | Let us use this as part of the Either monad -}</span><span>
</span><a name="line-60"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679104025"><span class="hs-identifier hs-type">size</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679104025"><span class="hs-identifier hs-type">size</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679104025"><span class="hs-identifier hs-type">size</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679104026"><span class="hs-identifier hs-type">obj</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Error</span><span> </span><span class="hs-special">(</span><a href="Data.BinPacking.html#BinPackerError"><span class="hs-identifier hs-type">BinPackerError</span></a><span> </span><a href="#local-6989586621679104025"><span class="hs-identifier hs-type">size</span></a><span> </span><a href="#local-6989586621679104026"><span class="hs-identifier hs-type">obj</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-61"></a><span>    </span><a name="local-8214565720323794307"><span class="hs-identifier">strMsg</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.BinPacking.html#BPOther"><span class="hs-identifier hs-var">BPOther</span></a><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-comment">{- | The primary type for bin-packing functions.

These functions take a list of size of bins.  If every bin is the same size,
you can pass @repeat binSize@ to pass an infinite list of bins if the
same size.  Any surplus bins will simply be ignored. 

&gt; [size] is the sizes of bins
&gt; [(size, obj)] is the sizes and objects
&gt; result is Either error or results
-}</span><span>
</span><a name="line-73"></a><span class="hs-keyword">type</span><span> </span><a name="BinPacker"><a href="Data.BinPacking.html#BinPacker"><span class="hs-identifier">BinPacker</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679103989"><a href="#local-6989586621679103989"><span class="hs-identifier">size</span></a></a><span> </span><a name="local-6989586621679103990"><a href="#local-6989586621679103990"><span class="hs-identifier">obj</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621679103989"><span class="hs-identifier hs-type">size</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679103989"><span class="hs-identifier hs-type">size</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679103989"><span class="hs-identifier hs-type">size</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679103990"><span class="hs-identifier hs-type">obj</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span>
</span><a name="line-74"></a><span>                  </span><span class="hs-special">[</span><a href="#local-6989586621679103989"><span class="hs-identifier hs-type">size</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- The sizes of bins</span><span>
</span><a name="line-75"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679103989"><span class="hs-identifier hs-type">size</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679103990"><span class="hs-identifier hs-type">obj</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- The sizes and objects</span><span>
</span><a name="line-76"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">(</span><a href="Data.BinPacking.html#BinPackerError"><span class="hs-identifier hs-type">BinPackerError</span></a><span> </span><a href="#local-6989586621679103989"><span class="hs-identifier hs-type">size</span></a><span> </span><a href="#local-6989586621679103990"><span class="hs-identifier hs-type">obj</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679103989"><span class="hs-identifier hs-type">size</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679103990"><span class="hs-identifier hs-type">obj</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Either error or results</span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-comment">{- | Pack objects into bins, preserving order.  Objects will be taken from the
input list one by one, and added to each bin until the bin is full.  Work will
then proceed on the next bin.  No attempt is made to optimize allocations to
bins.  This is the simplest and most naive bin-packing algorithm, but
may not make very good use of bin space. -}</span><span>
</span><a name="line-84"></a><span class="hs-identifier">packByOrder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.BinPacking.html#BinPacker"><span class="hs-identifier hs-type">BinPacker</span></a><span>
</span><a name="line-85"></a><a name="packByOrder"><a href="Data.BinPacking.html#packByOrder"><span class="hs-identifier">packByOrder</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                     </span><span class="hs-comment">-- Ran out of sizes</span><span>
</span><a name="line-86"></a><span class="hs-identifier">packByOrder</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679103993"><a href="#local-6989586621679103993"><span class="hs-identifier">remainder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="Data.BinPacking.html#BPTooFewBins"><span class="hs-identifier hs-var">BPTooFewBins</span></a><span> </span><a href="#local-6989586621679103993"><span class="hs-identifier hs-var">remainder</span></a><span class="hs-special">)</span><span>
</span><a name="line-87"></a><span class="hs-identifier">packByOrder</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679103994"><a href="#local-6989586621679103994"><span class="hs-identifier">thisbinsize</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679103995"><a href="#local-6989586621679103995"><span class="hs-identifier">otherbins</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679103996"><a href="#local-6989586621679103996"><span class="hs-identifier">sizes</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-88"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679103997"><a href="#local-6989586621679103997"><span class="hs-identifier">fillBin</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-89"></a><span>        </span><span class="hs-identifier">fillBin</span><span> </span><a name="local-6989586621679103998"><a href="#local-6989586621679103998"><span class="hs-identifier">accumsize</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679103999"><a href="#local-6989586621679103999"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679104000"><a href="#local-6989586621679104000"><span class="hs-identifier">o</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679104001"><a href="#local-6989586621679104001"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span>
</span><a name="line-90"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679103999"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679103994"><span class="hs-identifier hs-var">thisbinsize</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.BinPacking.html#BPSizeTooLarge"><span class="hs-identifier hs-var">BPSizeTooLarge</span></a><span> </span><a href="#local-6989586621679103994"><span class="hs-identifier hs-var">thisbinsize</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679103999"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679104000"><span class="hs-identifier hs-var">o</span></a><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679103999"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679103998"><span class="hs-identifier hs-var">accumsize</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679103994"><span class="hs-identifier hs-var">thisbinsize</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-92"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679104002"><a href="#local-6989586621679104002"><span class="hs-identifier">next</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679103997"><span class="hs-identifier hs-var">fillBin</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679103998"><span class="hs-identifier hs-var">accumsize</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679103999"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679104001"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-93"></a><span>                             </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679103999"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679104000"><span class="hs-identifier hs-var">o</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679104002"><span class="hs-identifier hs-var">next</span></a><span>
</span><a name="line-94"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679104003"><a href="#local-6989586621679104003"><span class="hs-identifier">thisset</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679103997"><span class="hs-identifier hs-var">fillBin</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679103996"><span class="hs-identifier hs-var">sizes</span></a><span>
</span><a name="line-95"></a><span>              </span><a name="local-6989586621679104004"><a href="#local-6989586621679104004"><span class="hs-identifier">next</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.BinPacking.html#packByOrder"><span class="hs-identifier hs-var">packByOrder</span></a><span> </span><a href="#local-6989586621679103995"><span class="hs-identifier hs-var">otherbins</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679104003"><span class="hs-identifier hs-var">thisset</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679103996"><span class="hs-identifier hs-var">sizes</span></a><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span>              </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679104003"><span class="hs-identifier hs-var">thisset</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679104004"><span class="hs-identifier hs-var">next</span></a><span class="hs-special">)</span><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-comment">{- | Pack objects into bins.  For each bin, start with the largest objects,
and keep packing the largest object from the remainder until no object can
be found to put in the bin.  This is substantially more efficient than
'packByOrder', but requires sorting the input. -}</span><span>
</span><a name="line-102"></a><span class="hs-identifier">packLargeFirst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.BinPacking.html#BinPacker"><span class="hs-identifier hs-type">BinPacker</span></a><span>
</span><a name="line-103"></a><a name="packLargeFirst"><a href="Data.BinPacking.html#packLargeFirst"><span class="hs-identifier">packLargeFirst</span></a></a><span> </span><a name="local-6989586621679104005"><a href="#local-6989586621679104005"><span class="hs-identifier">bins</span></a></a><span> </span><a name="local-6989586621679104006"><a href="#local-6989586621679104006"><span class="hs-identifier">sizes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.BinPacking.html#packLargeFirst%27"><span class="hs-identifier hs-var">packLargeFirst'</span></a><span> </span><a href="#local-6989586621679104005"><span class="hs-identifier hs-var">bins</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sortBy</span><span> </span><a href="#local-6989586621679104007"><span class="hs-identifier hs-var">fstSort</span></a><span> </span><a href="#local-6989586621679104006"><span class="hs-identifier hs-var">sizes</span></a><span class="hs-special">)</span><span>
</span><a name="line-104"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679104007"><a href="#local-6989586621679104007"><span class="hs-identifier">fstSort</span></a></a><span> </span><a name="local-6989586621679104008"><a href="#local-6989586621679104008"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679104009"><a href="#local-6989586621679104009"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">compare</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679104008"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679104009"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-identifier">packLargeFirst'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.BinPacking.html#BinPacker"><span class="hs-identifier hs-type">BinPacker</span></a><span>
</span><a name="line-107"></a><a name="packLargeFirst%27"><a href="Data.BinPacking.html#packLargeFirst%27"><span class="hs-identifier">packLargeFirst'</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                     </span><span class="hs-comment">-- Ran out of sizes</span><span>
</span><a name="line-108"></a><span class="hs-identifier">packLargeFirst'</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679104010"><a href="#local-6989586621679104010"><span class="hs-identifier">remainder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="Data.BinPacking.html#BPTooFewBins"><span class="hs-identifier hs-var">BPTooFewBins</span></a><span> </span><a href="#local-6989586621679104010"><span class="hs-identifier hs-var">remainder</span></a><span class="hs-special">)</span><span>
</span><a name="line-109"></a><span class="hs-identifier">packLargeFirst'</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679104011"><a href="#local-6989586621679104011"><span class="hs-identifier">thisbinsize</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679104012"><a href="#local-6989586621679104012"><span class="hs-identifier">otherbins</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679104013"><a href="#local-6989586621679104013"><span class="hs-identifier">sizes</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-110"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679104014"><a href="#local-6989586621679104014"><span class="hs-identifier">fillBin</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-111"></a><span>        </span><span class="hs-identifier">fillBin</span><span> </span><a name="local-6989586621679104015"><a href="#local-6989586621679104015"><span class="hs-identifier">accumsize</span></a></a><span> </span><a name="local-6989586621679104016"><a href="#local-6989586621679104016"><span class="hs-identifier">sizelist</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-112"></a><span>            </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">break</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679104017"><a href="#local-6989586621679104017"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679104017"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679104015"><span class="hs-identifier hs-var">accumsize</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621679104011"><span class="hs-identifier hs-var">thisbinsize</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679104016"><span class="hs-identifier hs-var">sizelist</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-113"></a><span>              </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-114"></a><span>                  </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679104015"><span class="hs-identifier hs-var">accumsize</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-115"></a><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.BinPacking.html#BPSizeTooLarge"><span class="hs-identifier hs-var">BPSizeTooLarge</span></a><span> </span><a href="#local-6989586621679104011"><span class="hs-identifier hs-var">thisbinsize</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679104016"><span class="hs-identifier hs-var">sizelist</span></a><span class="hs-special">)</span><span>
</span><a name="line-116"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-117"></a><span>              </span><span class="hs-special">(</span><a name="local-6989586621679104018"><a href="#local-6989586621679104018"><span class="hs-identifier">nonmatches</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679104019"><a href="#local-6989586621679104019"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679104020"><a href="#local-6989586621679104020"><span class="hs-identifier">o</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679104021"><a href="#local-6989586621679104021"><span class="hs-identifier">matchxs</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-118"></a><span>                  </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679104022"><a href="#local-6989586621679104022"><span class="hs-identifier">next</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679104014"><span class="hs-identifier hs-var">fillBin</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679104015"><span class="hs-identifier hs-var">accumsize</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679104019"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679104018"><span class="hs-identifier hs-var">nonmatches</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679104021"><span class="hs-identifier hs-var">matchxs</span></a><span class="hs-special">)</span><span>
</span><a name="line-119"></a><span>                     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679104019"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679104020"><span class="hs-identifier hs-var">o</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679104022"><span class="hs-identifier hs-var">next</span></a><span>
</span><a name="line-120"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679104023"><a href="#local-6989586621679104023"><span class="hs-identifier">thisset</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679104014"><span class="hs-identifier hs-var">fillBin</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679104013"><span class="hs-identifier hs-var">sizes</span></a><span>
</span><a name="line-121"></a><span>              </span><a name="local-6989586621679104024"><a href="#local-6989586621679104024"><span class="hs-identifier">next</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.BinPacking.html#packLargeFirst%27"><span class="hs-identifier hs-var">packLargeFirst'</span></a><span> </span><a href="#local-6989586621679104012"><span class="hs-identifier hs-var">otherbins</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679104023"><span class="hs-identifier hs-var">thisset</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679104013"><span class="hs-identifier hs-var">sizes</span></a><span class="hs-special">)</span><span>
</span><a name="line-122"></a><span>              </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679104023"><span class="hs-identifier hs-var">thisset</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679104024"><span class="hs-identifier hs-var">next</span></a><span class="hs-special">)</span><span>
</span><a name="line-123"></a></pre></body></html>