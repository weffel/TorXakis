<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE Safe #-}</span><span>
</span><a name="line-2"></a><span class="hs-comment">{- 
Copyright (c) 2005-2011 John Goerzen &lt;jgoerzen@complete.org&gt;

All rights reserved.

For license and copyright information, see the file LICENSE
-}</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-comment">{- |
   Module     : MissingH.getOpt
   Copyright  : Copyright (C) 2005-2011 John Goerzen
   License    : BSD3

   Maintainer : John Goerzen &lt;jgoerzen@complete.org&gt;
   Stability  : provisional
   Portability: portable

Written by John Goerzen, jgoerzen\@complete.org

Utilities for command-line parsing, including wrappers around
the standard System.Console.GetOpt module.
-}</span><span>
</span><a name="line-24"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Console</span><span class="hs-operator">.</span><span class="hs-identifier">GetOpt</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span><span> </span><span class="hs-special">(</span><a href="System.Console.GetOpt.Utils.html#parseCmdLine"><span class="hs-identifier hs-var">parseCmdLine</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>                        </span><a href="System.Console.GetOpt.Utils.html#validateCmdLine"><span class="hs-identifier hs-var">validateCmdLine</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>                        </span><a href="System.Console.GetOpt.Utils.html#StdOption"><span class="hs-identifier hs-type">StdOption</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>                        </span><a href="System.Console.GetOpt.Utils.html#stdRequired"><span class="hs-identifier hs-var">stdRequired</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>                        </span><a href="System.Console.GetOpt.Utils.html#stdOptional"><span class="hs-identifier hs-var">stdOptional</span></a><span>
</span><a name="line-29"></a><span>                       </span><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span class="hs-keyword">where</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Console</span><span class="hs-operator">.</span><span class="hs-identifier">GetOpt</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Environment</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-comment">{- | Simple command line parser -- a basic wrapper around the system's
default getOpt.  See the System.Console.GetOpt manual for a description of the
first two parameters.

The third parameter is a usage information header.

The return value consists of the list of parsed flags and a list of
non-option arguments. -}</span><span>
</span><a name="line-42"></a><span class="hs-identifier">parseCmdLine</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ArgOrder</span><span> </span><a href="#local-6989586621679078959"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">OptDescr</span><span> </span><a href="#local-6989586621679078959"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621679078959"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-43"></a><a name="parseCmdLine"><a href="System.Console.GetOpt.Utils.html#parseCmdLine"><span class="hs-identifier">parseCmdLine</span></a></a><span> </span><a name="local-6989586621679078960"><a href="#local-6989586621679078960"><span class="hs-identifier">order</span></a></a><span> </span><a name="local-6989586621679078961"><a href="#local-6989586621679078961"><span class="hs-identifier">options</span></a></a><span> </span><a name="local-6989586621679078962"><a href="#local-6989586621679078962"><span class="hs-identifier">header</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-44"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679078963"><a href="#local-6989586621679078963"><span class="hs-identifier">argv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getArgs</span><span>
</span><a name="line-45"></a><span>       </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">getOpt</span><span> </span><a href="#local-6989586621679078960"><span class="hs-identifier hs-var">order</span></a><span> </span><a href="#local-6989586621679078961"><span class="hs-identifier hs-var">options</span></a><span> </span><a href="#local-6989586621679078963"><span class="hs-identifier hs-var">argv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-46"></a><span>         </span><span class="hs-special">(</span><a name="local-6989586621679078964"><a href="#local-6989586621679078964"><span class="hs-identifier">o</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679078965"><a href="#local-6989586621679078965"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679078964"><span class="hs-identifier hs-var">o</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679078965"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span>         </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679078966"><a href="#local-6989586621679078966"><span class="hs-identifier">errors</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">ioError</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">userError</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621679078966"><span class="hs-identifier hs-var">errors</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span>
</span><a name="line-48"></a><span>                                               </span><span class="hs-identifier hs-var">usageInfo</span><span> </span><a href="#local-6989586621679078962"><span class="hs-identifier hs-var">header</span></a><span> </span><a href="#local-6989586621679078961"><span class="hs-identifier hs-var">options</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-comment">{- | Similar to 'parseCmdLine', but takes an additional function that validates
the post-parse command-line arguments.  This is useful, for example, in
situations where there are two arguments that are mutually-exclusive and only
one may legitimately be given at a time.

The return value of the function indicates whether or not it detected an
error condition.  If it returns Nothing, there is no error.  If it returns
Just String, there was an error, described by the String.
-}</span><span>
</span><a name="line-59"></a><span class="hs-identifier">validateCmdLine</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ArgOrder</span><span> </span><a href="#local-6989586621679078958"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">OptDescr</span><span> </span><a href="#local-6989586621679078958"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-60"></a><span>                   </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621679078958"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621679078958"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><a name="validateCmdLine"><a href="System.Console.GetOpt.Utils.html#validateCmdLine"><span class="hs-identifier">validateCmdLine</span></a></a><span> </span><a name="local-6989586621679078967"><a href="#local-6989586621679078967"><span class="hs-identifier">order</span></a></a><span> </span><a name="local-6989586621679078968"><a href="#local-6989586621679078968"><span class="hs-identifier">options</span></a></a><span> </span><a name="local-6989586621679078969"><a href="#local-6989586621679078969"><span class="hs-identifier">header</span></a></a><span> </span><a name="local-6989586621679078970"><a href="#local-6989586621679078970"><span class="hs-identifier">func</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-62"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679078971"><a href="#local-6989586621679078971"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Console.GetOpt.Utils.html#parseCmdLine"><span class="hs-identifier hs-var">parseCmdLine</span></a><span> </span><a href="#local-6989586621679078967"><span class="hs-identifier hs-var">order</span></a><span> </span><a href="#local-6989586621679078968"><span class="hs-identifier hs-var">options</span></a><span> </span><a href="#local-6989586621679078969"><span class="hs-identifier hs-var">header</span></a><span>
</span><a name="line-63"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679078970"><span class="hs-identifier hs-var">func</span></a><span> </span><a href="#local-6989586621679078971"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-64"></a><span>         </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679078971"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-65"></a><span>         </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679078972"><a href="#local-6989586621679078972"><span class="hs-identifier">errormsg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">ioError</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">userError</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679078972"><span class="hs-identifier hs-var">errormsg</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-66"></a><span>                                              </span><span class="hs-identifier hs-var">usageInfo</span><span> </span><a href="#local-6989586621679078969"><span class="hs-identifier hs-var">header</span></a><span> </span><a href="#local-6989586621679078968"><span class="hs-identifier hs-var">options</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-comment">{- | A type to standardize some common uses of GetOpt.

The first component of the tuple is the long name of the option.

The second component is empty if there is no arg, or has the arg otherwise. -}</span><span>
</span><a name="line-73"></a><span class="hs-keyword">type</span><span> </span><a name="StdOption"><a href="System.Console.GetOpt.Utils.html#StdOption"><span class="hs-identifier">StdOption</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span class="hs-comment">{- | Handle a required argument. -}</span><span>
</span><a name="line-76"></a><span class="hs-identifier">stdRequired</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>           </span><span class="hs-comment">-- ^ Name of arg</span><span>
</span><a name="line-77"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.GetOpt.Utils.html#StdOption"><span class="hs-identifier hs-type">StdOption</span></a><span>
</span><a name="line-78"></a><a name="stdRequired"><a href="System.Console.GetOpt.Utils.html#stdRequired"><span class="hs-identifier">stdRequired</span></a></a><span> </span><a name="local-6989586621679078973"><a href="#local-6989586621679078973"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679078974"><a href="#local-6989586621679078974"><span class="hs-identifier">value</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679078973"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679078974"><span class="hs-identifier hs-var">value</span></a><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-comment">{- | Handle an optional argument. -}</span><span>
</span><a name="line-81"></a><span class="hs-identifier">stdOptional</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>           </span><span class="hs-comment">-- ^ Name of arg</span><span>
</span><a name="line-82"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.GetOpt.Utils.html#StdOption"><span class="hs-identifier hs-type">StdOption</span></a><span>
</span><a name="line-83"></a><a name="stdOptional"><a href="System.Console.GetOpt.Utils.html#stdOptional"><span class="hs-identifier">stdOptional</span></a></a><span> </span><a name="local-6989586621679078975"><a href="#local-6989586621679078975"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679078975"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-84"></a><span class="hs-identifier">stdOptional</span><span> </span><a name="local-6989586621679078976"><a href="#local-6989586621679078976"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679078977"><a href="#local-6989586621679078977"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679078976"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679078977"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-85"></a></pre></body></html>