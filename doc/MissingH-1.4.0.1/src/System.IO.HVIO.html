<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE Safe #-}</span><span>
</span><a name="line-2"></a><span class="hs-comment">{- arch-tag: HVIO main file
Copyright (c) 2004-2011 John Goerzen &lt;jgoerzen@complete.org&gt;

All rights reserved.

For license and copyright information, see the file LICENSE
-}</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-comment">{- |
   Module     : System.IO.HVIO
   Copyright  : Copyright (C) 2004-2011 John Goerzen
   License    : BSD3

   Maintainer : John Goerzen &lt;jgoerzen@complete.org&gt;
   Stability  : provisional
   Portability: portable

Haskell Virtual I\/O -- a system to increase the flexibility of input and
output in Haskell

Copyright (c) 2004-2005 John Goerzen, jgoerzen\@complete.org

HVIO provides the following general features:

 * The ability to use a single set of functions on various different
   types of objects, including standard Handles, in-memory buffers,
   compressed files, network data streams, etc.

 * The ability to transparently add filters to the I\/O process.
   These filters could include things such as character set conversions,
   compression or decompression of a data stream, and more.

 * The ability to define new objects that have the properties
   of I\/O objects and can be used interchangably with them.

 * Specification compatibility with, and complete support for,
   existing I\/O on Handles.

 * Provide easier unit testing capabilities for I\/O actions

HVIO defines several basic type classes that you can use.  You will mostly
be interested in 'HVIO'.

It's trivial to adapt old code to work with HVIO.  For instance, consider
this example of old and new code:

&gt;printMsg :: Handle -&gt; String -&gt; IO ()
&gt;printMsg h msg = hPutStr h (&quot;msg: &quot; ++ msg)

And now, the new way:

&gt;printMsg :: HVIO h =&gt; h -&gt; String -&gt; IO ()
&gt;printMsg h msg = vPutStr h (&quot;msg: &quot; ++ msg)

There are several points to note about this conversion:

 * The new method can still accept a Handle in exactly the same way as
   the old method.  Changing your functions to use HVIO will require no
   changes from functions that call them with Handles.

 * Most \&quot;h\&quot; functions have equivolent \&quot;v\&quot; functions that operate
   on HVIO classes instead of the more specific Handle.  The \&quot;v\&quot; functions
   behave identically to the \&quot;h\&quot; functions whenever possible.

 * There is no equivolent of \&quot;openFile\&quot; in any HVIO class.  You must
   create your Handle (or other HVIO object) using normal means.
   This is because the creation is so different that it cannot be standardized.

In addition to Handle, there are several pre-defined classes for your use.
'StreamReader' is a particularly interesting one.  At creation time, you pass
it a String.  Its contents are read lazily whenever a read call is made.  It
can be used, therefore, to implement filters (simply initialize it with the
result from, say, a map over hGetContents from another HVIO object), codecs,
and simple I\/O testing.  Because it is lazy, it need not hold the entire
string in memory.  You can create a 'StreamReader' with a call to
'newStreamReader'.

'MemoryBuffer' is a similar class, but with a different purpose.  It provides
a full interface like Handle (it implements 'HVIOReader', 'HVIOWriter',
and 'HVIOSeeker').  However, it maintains an in-memory buffer with the
contents of the file, rather than an actual on-disk file.  You can access
the entire contents of this buffer at any time.  This can be quite useful
for testing I\/O code, or for cases where existing APIs use I\/O, but you
prefer a String representation.  You can create a 'MemoryBuffer' with a call
to 'newMemoryBuffer'.

Finally, there are pipes.  These pipes are analogous to the Unix
pipes that are available from System.Posix, but don't require Unix and work
only in Haskell.  When you create a pipe, you actually get two HVIO objects:
a 'PipeReader' and a 'PipeWriter'.  You must use the 'PipeWriter' in one
thread and the 'PipeReader' in another thread.  Data that's written to the
'PipeWriter' will then be available for reading with the 'PipeReader'.  The
pipes are implemented completely with existing Haskell threading primitives,
and require no special operating system support.  Unlike Unix pipes, these
pipes cannot be used across a fork().  Also unlike Unix pipes, these pipes
are portable and interact well with Haskell threads.  A new pipe can be created
with a call to 'newHVIOPipe'.

Together with &quot;System.IO.HVFS&quot;, this module is part of a complete
virtual filesystem solution.
-}</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">HVIO</span><span class="hs-special">(</span><span class="hs-comment">-- * Implementation Classes</span><span>
</span><a name="line-105"></a><span>                     </span><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier hs-type">HVIO</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-106"></a><span>                     </span><span class="hs-comment">-- * Standard HVIO Implementations</span><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span>                     </span><span class="hs-comment">-- ** Handle</span><span>
</span><a name="line-109"></a><span>                     </span><span class="hs-comment">-- | Handle is a member of 'HVIO'.</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span>                     </span><span class="hs-comment">-- ** Stream Reader</span><span>
</span><a name="line-112"></a><span>                     </span><a href="System.IO.HVIO.html#StreamReader"><span class="hs-identifier hs-type">StreamReader</span></a><span class="hs-special">,</span><span> </span><a href="System.IO.HVIO.html#newStreamReader"><span class="hs-identifier hs-var">newStreamReader</span></a><span class="hs-special">,</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span>                     </span><span class="hs-comment">-- ** Memory Buffer</span><span>
</span><a name="line-115"></a><span>                     </span><a href="System.IO.HVIO.html#MemoryBuffer"><span class="hs-identifier hs-type">MemoryBuffer</span></a><span class="hs-special">,</span><span> </span><a href="System.IO.HVIO.html#newMemoryBuffer"><span class="hs-identifier hs-var">newMemoryBuffer</span></a><span class="hs-special">,</span><span>
</span><a name="line-116"></a><span>                     </span><a href="System.IO.HVIO.html#mbDefaultCloseFunc"><span class="hs-identifier hs-var">mbDefaultCloseFunc</span></a><span class="hs-special">,</span><span> </span><a href="System.IO.HVIO.html#getMemoryBuffer"><span class="hs-identifier hs-var">getMemoryBuffer</span></a><span class="hs-special">,</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span>                     </span><span class="hs-comment">-- ** Haskell Pipe</span><span>
</span><a name="line-119"></a><span>                     </span><a href="System.IO.HVIO.html#PipeReader"><span class="hs-identifier hs-type">PipeReader</span></a><span class="hs-special">,</span><span> </span><a href="System.IO.HVIO.html#PipeWriter"><span class="hs-identifier hs-type">PipeWriter</span></a><span class="hs-special">,</span><span> </span><a href="System.IO.HVIO.html#newHVIOPipe"><span class="hs-identifier hs-var">newHVIOPipe</span></a><span>
</span><a name="line-120"></a><span>                    </span><span class="hs-special">)</span><span>
</span><a name="line-121"></a><span class="hs-keyword">where</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span>
</span><a name="line-124"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Error</span><span>
</span><a name="line-125"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Exception</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">catch</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IOException</span><span class="hs-special">)</span><span>
</span><a name="line-126"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Concurrent</span><span class="hs-operator">.</span><span class="hs-identifier">MVar</span><span>
</span><a name="line-127"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IORef</span><span>
</span><a name="line-128"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">Ptr</span><span>
</span><a name="line-129"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">C</span><span>
</span><a name="line-130"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">Storable</span><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span class="hs-comment">{- | This is the generic I\/O support class.  All objects that are to be used
in the HVIO system must provide an instance of 'HVIO'.

Functions in this class provide an interface with the same specification as
the similar functions in System.IO.  Please refer to that documentation
for a more complete specification than is provided here.

Instances of 'HVIO' must provide 'vClose', 'vIsEOF', and either
'vIsOpen' or 'vIsClosed'.

Implementators of readable objects must provide at least 'vGetChar'
and 'vIsReadable'.
An implementation of 'vGetContents' is also highly suggested, since
the default cannot implement proper partial closing semantics.

Implementators of writable objects must provide at least 'vPutChar' and
'vIsWritable'.

Implementators of seekable objects must provide at least
'vIsSeekable', 'vTell', and 'vSeek'.
-}</span><span>
</span><a name="line-153"></a><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="HVIO"><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier">HVIO</span></a></a><span> </span><a name="local-6989586621679049599"><a href="#local-6989586621679049599"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-154"></a><span>    </span><span class="hs-comment">-- | Close a file</span><span>
</span><a name="line-155"></a><span>    </span><span class="hs-identifier">vClose</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-156"></a><span>    </span><span class="hs-comment">-- | Test if a file is open</span><span>
</span><a name="line-157"></a><span>    </span><span class="hs-identifier">vIsOpen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-158"></a><span>    </span><span class="hs-comment">-- | Test if a file is closed</span><span>
</span><a name="line-159"></a><span>    </span><span class="hs-identifier">vIsClosed</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-160"></a><span>    </span><span class="hs-comment">-- | Raise an error if the file is not open.</span><span>
</span><a name="line-161"></a><span>    </span><span class="hs-comment">-- This is a new HVIO function and is implemented in terms of</span><span>
</span><a name="line-162"></a><span>    </span><span class="hs-comment">-- 'vIsOpen'.</span><span>
</span><a name="line-163"></a><span>    </span><span class="hs-identifier">vTestOpen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-164"></a><span>    </span><span class="hs-comment">-- | Whether or not we're at EOF.  This may raise on exception</span><span>
</span><a name="line-165"></a><span>    </span><span class="hs-comment">-- on some items, most notably write-only Handles such as stdout.</span><span>
</span><a name="line-166"></a><span>    </span><span class="hs-comment">-- In general, this is most reliable on items opened for reading.</span><span>
</span><a name="line-167"></a><span>    </span><span class="hs-comment">-- vIsEOF implementations must implicitly call vTestOpen.</span><span>
</span><a name="line-168"></a><span>    </span><span class="hs-identifier">vIsEOF</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-169"></a><span>    </span><span class="hs-comment">-- | Detailed show output.</span><span>
</span><a name="line-170"></a><span>    </span><span class="hs-identifier">vShow</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-171"></a><span>    </span><span class="hs-comment">-- | Make an IOError.</span><span>
</span><a name="line-172"></a><span>    </span><span class="hs-identifier">vMkIOError</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IOErrorType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IOError</span><span>
</span><a name="line-173"></a><span>    </span><span class="hs-comment">-- | Throw an IOError.</span><span>
</span><a name="line-174"></a><span>    </span><span class="hs-identifier">vThrow</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IOErrorType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679050289"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-175"></a><span>    </span><span class="hs-comment">-- | Get the filename\/object\/whatever that this corresponds to.</span><span>
</span><a name="line-176"></a><span>    </span><span class="hs-comment">-- May be Nothing.</span><span>
</span><a name="line-177"></a><span>    </span><span class="hs-identifier">vGetFP</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">)</span><span>
</span><a name="line-178"></a><span>    </span><span class="hs-comment">-- | Throw an isEOFError if we're at EOF; returns nothing otherwise.</span><span>
</span><a name="line-179"></a><span>    </span><span class="hs-comment">-- If an implementation overrides the default, make sure that it</span><span>
</span><a name="line-180"></a><span>    </span><span class="hs-comment">-- calls vTestOpen at some point.  The default implementation is</span><span>
</span><a name="line-181"></a><span>    </span><span class="hs-comment">-- a wrapper around a call to 'vIsEOF'.</span><span>
</span><a name="line-182"></a><span>    </span><span class="hs-identifier">vTestEOF</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span>    </span><span class="hs-comment">-- | Read one character</span><span>
</span><a name="line-185"></a><span>    </span><span class="hs-identifier">vGetChar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Char</span><span>
</span><a name="line-186"></a><span>    </span><span class="hs-comment">-- | Read one line</span><span>
</span><a name="line-187"></a><span>    </span><span class="hs-identifier">vGetLine</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-188"></a><span>    </span><span class="hs-comment">{- | Get the remaining contents.  Please note that as a user of this
       function, the same partial-closing semantics as are used in the
       standard 'hGetContents' are /encouraged/ from implementators,
       but are not /required/.  That means that, for instance,
       a 'vGetChar' after a 'vGetContents' may return some undefined
       result instead of the error you would normally get.  You should
       use caution to make sure your code doesn't fall into that trap,
       or make sure to test your code with Handle or one of the
       default instances defined in this module.  Also, some implementations
       may essentially provide a complete close after a call to 'vGetContents'.
       The bottom line: after a call to 'vGetContents', you should do nothing
       else with the object save closing it with 'vClose'.

       For implementators, you are highly encouraged to provide a correct
       implementation. -}</span><span>
</span><a name="line-203"></a><span>    </span><span class="hs-identifier">vGetContents</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-204"></a><span>    </span><span class="hs-comment">-- | Indicate whether at least one item is ready for reading.</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-comment">-- This will always be True for a great many implementations.</span><span>
</span><a name="line-206"></a><span>    </span><span class="hs-identifier">vReady</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-207"></a><span>    </span><span class="hs-comment">-- | Indicate whether a particular item is available for reading.</span><span>
</span><a name="line-208"></a><span>    </span><span class="hs-identifier">vIsReadable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-209"></a><span>
</span><a name="line-210"></a><span>    </span><span class="hs-comment">-- | Write one character</span><span>
</span><a name="line-211"></a><span>    </span><span class="hs-identifier">vPutChar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-212"></a><span>    </span><span class="hs-comment">-- | Write a string</span><span>
</span><a name="line-213"></a><span>    </span><span class="hs-identifier">vPutStr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span>    </span><span class="hs-comment">-- | Write a string with newline character after it</span><span>
</span><a name="line-215"></a><span>    </span><span class="hs-identifier">vPutStrLn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>    </span><span class="hs-comment">-- | Write a string representation of the argument, plus a newline.</span><span>
</span><a name="line-217"></a><span>    </span><span class="hs-identifier">vPrint</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679050290"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679050290"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-218"></a><span>    </span><span class="hs-comment">-- | Flush any output buffers.</span><span>
</span><a name="line-219"></a><span>    </span><span class="hs-comment">-- Note: implementations should assure that a vFlush is automatically</span><span>
</span><a name="line-220"></a><span>    </span><span class="hs-comment">-- performed</span><span>
</span><a name="line-221"></a><span>    </span><span class="hs-comment">-- on file close, if necessary to ensure all data sent is written.</span><span>
</span><a name="line-222"></a><span>    </span><span class="hs-identifier">vFlush</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-223"></a><span>    </span><span class="hs-comment">-- | Indicate whether or not this particular object supports writing.</span><span>
</span><a name="line-224"></a><span>    </span><span class="hs-identifier">vIsWritable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-225"></a><span>
</span><a name="line-226"></a><span>    </span><span class="hs-comment">-- | Seek to a specific location.</span><span>
</span><a name="line-227"></a><span>    </span><span class="hs-identifier">vSeek</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SeekMode</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-228"></a><span>
</span><a name="line-229"></a><span>    </span><span class="hs-comment">-- | Get the current position.</span><span>
</span><a name="line-230"></a><span>    </span><span class="hs-identifier">vTell</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span>    </span><span class="hs-comment">-- | Convenience function to reset the file pointer to the beginning</span><span>
</span><a name="line-233"></a><span>    </span><span class="hs-comment">-- of the file.  A call to @vRewind h@ is the</span><span>
</span><a name="line-234"></a><span>    </span><span class="hs-comment">-- same as @'vSeek' h AbsoluteSeek 0@.</span><span>
</span><a name="line-235"></a><span>    </span><span class="hs-identifier">vRewind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span>    </span><span class="hs-comment">-- | Indicate whether this instance supports seeking.</span><span>
</span><a name="line-238"></a><span>    </span><span class="hs-identifier">vIsSeekable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-239"></a><span>
</span><a name="line-240"></a><span>    </span><span class="hs-comment">-- | Set buffering; the default action is a no-op.</span><span>
</span><a name="line-241"></a><span>    </span><span class="hs-identifier">vSetBuffering</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">BufferMode</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-242"></a><span>
</span><a name="line-243"></a><span>    </span><span class="hs-comment">-- | Get buffering; the default action always returns NoBuffering.</span><span>
</span><a name="line-244"></a><span>    </span><span class="hs-identifier">vGetBuffering</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">BufferMode</span><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span>    </span><span class="hs-comment">-- | Binary output: write the specified number of octets from the specified</span><span>
</span><a name="line-247"></a><span>    </span><span class="hs-comment">-- buffer location.</span><span>
</span><a name="line-248"></a><span>    </span><span class="hs-identifier">vPutBuf</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><a href="#local-6989586621679050982"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span>    </span><span class="hs-comment">-- | Binary input: read the specified number of octets from the</span><span>
</span><a name="line-251"></a><span>    </span><span class="hs-comment">-- specified buffer location, continuing to read</span><span>
</span><a name="line-252"></a><span>    </span><span class="hs-comment">-- until it either consumes that much data or EOF is encountered.</span><span>
</span><a name="line-253"></a><span>    </span><span class="hs-comment">-- Returns the number of octets actually read.  EOF errors are never</span><span>
</span><a name="line-254"></a><span>    </span><span class="hs-comment">-- raised; fewer bytes than requested are returned on EOF.</span><span>
</span><a name="line-255"></a><span>    </span><span class="hs-identifier">vGetBuf</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679049599"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><a href="#local-6989586621679051093"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-256"></a><span>
</span><a name="line-257"></a><span>    </span><a name="local-8214565720323824406"><a href="System.IO.HVIO.html#vSetBuffering"><span class="hs-identifier">vSetBuffering</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-258"></a><span>    </span><a name="local-8214565720323824407"><a href="System.IO.HVIO.html#vGetBuffering"><span class="hs-identifier">vGetBuffering</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">NoBuffering</span><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span>    </span><a name="local-8214565720323824386"><a href="System.IO.HVIO.html#vShow"><span class="hs-identifier">vShow</span></a></a><span> </span><a name="local-6989586621679051094"><a href="#local-6989586621679051094"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679051094"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-261"></a><span>
</span><a name="line-262"></a><span>    </span><a name="local-8214565720323824387"><a href="System.IO.HVIO.html#vMkIOError"><span class="hs-identifier">vMkIOError</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679051095"><a href="#local-6989586621679051095"><span class="hs-identifier">et</span></a></a><span> </span><a name="local-6989586621679051096"><a href="#local-6989586621679051096"><span class="hs-identifier">desc</span></a></a><span> </span><a name="local-6989586621679051097"><a href="#local-6989586621679051097"><span class="hs-identifier">mfp</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-263"></a><span>        </span><span class="hs-identifier hs-var">mkIOError</span><span> </span><a href="#local-6989586621679051095"><span class="hs-identifier hs-var">et</span></a><span> </span><a href="#local-6989586621679051096"><span class="hs-identifier hs-var">desc</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-6989586621679051097"><span class="hs-identifier hs-var">mfp</span></a><span>
</span><a name="line-264"></a><span>
</span><a name="line-265"></a><span>    </span><a name="local-8214565720323824389"><a href="System.IO.HVIO.html#vGetFP"><span class="hs-identifier">vGetFP</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span>    </span><a name="local-8214565720323824388"><a href="System.IO.HVIO.html#vThrow"><span class="hs-identifier">vThrow</span></a></a><span> </span><a name="local-6989586621679051098"><a href="#local-6989586621679051098"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679051099"><a href="#local-6989586621679051099"><span class="hs-identifier">et</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-268"></a><span>                  </span><a name="local-6989586621679051100"><a href="#local-6989586621679051100"><span class="hs-identifier">fp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vGetFP"><span class="hs-identifier hs-var">vGetFP</span></a><span> </span><a href="#local-6989586621679051098"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-269"></a><span>                  </span><span class="hs-identifier hs-var">ioError</span><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#vMkIOError"><span class="hs-identifier hs-var">vMkIOError</span></a><span> </span><a href="#local-6989586621679051098"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679051099"><span class="hs-identifier hs-var">et</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><a href="#local-6989586621679051100"><span class="hs-identifier hs-var">fp</span></a><span class="hs-special">)</span><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span>    </span><a name="local-8214565720323824390"><a href="System.IO.HVIO.html#vTestEOF"><span class="hs-identifier">vTestEOF</span></a></a><span> </span><a name="local-6989586621679051101"><a href="#local-6989586621679051101"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051102"><a href="#local-6989586621679051102"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vIsEOF"><span class="hs-identifier hs-var">vIsEOF</span></a><span> </span><a href="#local-6989586621679051101"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-272"></a><span>                    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679051102"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="System.IO.HVIO.html#vThrow"><span class="hs-identifier hs-var">vThrow</span></a><span> </span><a href="#local-6989586621679051101"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-identifier hs-var">eofErrorType</span><span>
</span><a name="line-273"></a><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span>    </span><a name="local-8214565720323824382"><a href="System.IO.HVIO.html#vIsOpen"><span class="hs-identifier">vIsOpen</span></a></a><span> </span><a name="local-6989586621679051103"><a href="#local-6989586621679051103"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVIO.html#vIsClosed"><span class="hs-identifier hs-var">vIsClosed</span></a><span> </span><a href="#local-6989586621679051103"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">not</span><span>
</span><a name="line-276"></a><span>    </span><a name="local-8214565720323824383"><a href="System.IO.HVIO.html#vIsClosed"><span class="hs-identifier">vIsClosed</span></a></a><span> </span><a name="local-6989586621679051104"><a href="#local-6989586621679051104"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVIO.html#vIsOpen"><span class="hs-identifier hs-var">vIsOpen</span></a><span> </span><a href="#local-6989586621679051104"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">not</span><span>
</span><a name="line-277"></a><span>    </span><a name="local-8214565720323824384"><a href="System.IO.HVIO.html#vTestOpen"><span class="hs-identifier">vTestOpen</span></a></a><span> </span><a name="local-6989586621679051105"><a href="#local-6989586621679051105"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051106"><a href="#local-6989586621679051106"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vIsClosed"><span class="hs-identifier hs-var">vIsClosed</span></a><span> </span><a href="#local-6989586621679051105"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-278"></a><span>                     </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679051106"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="System.IO.HVIO.html#vThrow"><span class="hs-identifier hs-var">vThrow</span></a><span> </span><a href="#local-6989586621679051105"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-identifier hs-var">illegalOperationErrorType</span><span>
</span><a name="line-279"></a><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span>
</span><a name="line-282"></a><span>    </span><a name="local-8214565720323824395"><a href="System.IO.HVIO.html#vIsReadable"><span class="hs-identifier">vIsReadable</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-283"></a><span>
</span><a name="line-284"></a><span>    </span><a name="local-8214565720323824392"><a href="System.IO.HVIO.html#vGetLine"><span class="hs-identifier">vGetLine</span></a></a><span> </span><a name="local-6989586621679051107"><a href="#local-6989586621679051107"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-285"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679051108"><a href="#local-6989586621679051108"><span class="hs-identifier">loop</span></a></a><span> </span><a name="local-6989586621679051109"><a href="#local-6989586621679051109"><span class="hs-identifier">accum</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-286"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679051110"><a href="#local-6989586621679051110"><span class="hs-identifier">func</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051112"><a href="#local-6989586621679051112"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vGetChar"><span class="hs-identifier hs-var">vGetChar</span></a><span> </span><a href="#local-6989586621679051107"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-287"></a><span>                              </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679051112"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-288"></a><span>                                     </span><span class="hs-char">'\n'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679051109"><span class="hs-identifier hs-var">accum</span></a><span>
</span><a name="line-289"></a><span>                                     </span><a name="local-6989586621679051113"><a href="#local-6989586621679051113"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679051109"><span class="hs-identifier hs-var">accum</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679051108"><span class="hs-identifier hs-var">loop</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679051109"><span class="hs-identifier hs-var">accum</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679051113"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-290"></a><span>                    </span><a name="local-6989586621679051111"><a href="#local-6989586621679051111"><span class="hs-identifier">handler</span></a></a><span> </span><a name="local-6989586621679051114"><a href="#local-6989586621679051114"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">isEOFError</span><span> </span><a href="#local-6989586621679051114"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679051109"><span class="hs-identifier hs-var">accum</span></a><span>
</span><a name="line-291"></a><span>                                </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">ioError</span><span> </span><a href="#local-6989586621679051114"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-292"></a><span>                    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">Control</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Exception</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">catch</span><span> </span><a href="#local-6989586621679051110"><span class="hs-identifier hs-var">func</span></a><span> </span><a href="#local-6989586621679051111"><span class="hs-identifier hs-var">handler</span></a><span>
</span><a name="line-293"></a><span>            </span><span class="hs-keyword">in</span><span>
</span><a name="line-294"></a><span>            </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051440"><a href="#local-6989586621679051440"><span class="hs-identifier">firstchar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vGetChar"><span class="hs-identifier hs-var">vGetChar</span></a><span> </span><a href="#local-6989586621679051107"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-295"></a><span>               </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679051440"><span class="hs-identifier hs-var">firstchar</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-296"></a><span>                   </span><span class="hs-char">'\n'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-297"></a><span>                   </span><a name="local-6989586621679051441"><a href="#local-6989586621679051441"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679051108"><span class="hs-identifier hs-var">loop</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679051441"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span>
</span><a name="line-298"></a><span>
</span><a name="line-299"></a><span>    </span><a name="local-8214565720323824393"><a href="System.IO.HVIO.html#vGetContents"><span class="hs-identifier">vGetContents</span></a></a><span> </span><a name="local-6989586621679051442"><a href="#local-6989586621679051442"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-300"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679051443"><a href="#local-6989586621679051443"><span class="hs-identifier">loop</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-301"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679051444"><a href="#local-6989586621679051444"><span class="hs-identifier">func</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051446"><a href="#local-6989586621679051446"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vGetChar"><span class="hs-identifier hs-var">vGetChar</span></a><span> </span><a href="#local-6989586621679051442"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-302"></a><span>                              </span><a name="local-6989586621679051447"><a href="#local-6989586621679051447"><span class="hs-identifier">next</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679051443"><span class="hs-identifier hs-var">loop</span></a><span>
</span><a name="line-303"></a><span>                              </span><a href="#local-6989586621679051446"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679051446"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679051447"><span class="hs-identifier hs-var">next</span></a><span class="hs-special">)</span><span>
</span><a name="line-304"></a><span>                    </span><a name="local-6989586621679051445"><a href="#local-6989586621679051445"><span class="hs-identifier">handler</span></a></a><span> </span><a name="local-6989586621679051448"><a href="#local-6989586621679051448"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">isEOFError</span><span> </span><a href="#local-6989586621679051448"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-305"></a><span>                                </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">ioError</span><span> </span><a href="#local-6989586621679051448"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-306"></a><span>                    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">Control</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Exception</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">catch</span><span> </span><a href="#local-6989586621679051444"><span class="hs-identifier hs-var">func</span></a><span> </span><a href="#local-6989586621679051445"><span class="hs-identifier hs-var">handler</span></a><span>
</span><a name="line-307"></a><span>            </span><span class="hs-keyword">in</span><span>
</span><a name="line-308"></a><span>            </span><span class="hs-keyword">do</span><span> </span><a href="#local-6989586621679051443"><span class="hs-identifier hs-var">loop</span></a><span>
</span><a name="line-309"></a><span>
</span><a name="line-310"></a><span>    </span><a name="local-8214565720323824394"><a href="System.IO.HVIO.html#vReady"><span class="hs-identifier">vReady</span></a></a><span> </span><a name="local-6989586621679051449"><a href="#local-6989586621679051449"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="System.IO.HVIO.html#vTestEOF"><span class="hs-identifier hs-var">vTestEOF</span></a><span> </span><a href="#local-6989586621679051449"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-311"></a><span>                  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-312"></a><span>
</span><a name="line-313"></a><span>
</span><a name="line-314"></a><span>    </span><a name="local-8214565720323824401"><a href="System.IO.HVIO.html#vIsWritable"><span class="hs-identifier">vIsWritable</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-315"></a><span>
</span><a name="line-316"></a><span>    </span><a name="local-8214565720323824397"><a href="System.IO.HVIO.html#vPutStr"><span class="hs-identifier">vPutStr</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-317"></a><span>    </span><span class="hs-identifier">vPutStr</span><span> </span><a name="local-6989586621679051450"><a href="#local-6989586621679051450"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679051451"><a href="#local-6989586621679051451"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679051452"><a href="#local-6989586621679051452"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="System.IO.HVIO.html#vPutChar"><span class="hs-identifier hs-var">vPutChar</span></a><span> </span><a href="#local-6989586621679051450"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679051451"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-318"></a><span>                          </span><a href="System.IO.HVIO.html#vPutStr"><span class="hs-identifier hs-var">vPutStr</span></a><span> </span><a href="#local-6989586621679051450"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679051452"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span>    </span><a name="local-8214565720323824398"><a href="System.IO.HVIO.html#vPutStrLn"><span class="hs-identifier">vPutStrLn</span></a></a><span> </span><a name="local-6989586621679051453"><a href="#local-6989586621679051453"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679051454"><a href="#local-6989586621679051454"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVIO.html#vPutStr"><span class="hs-identifier hs-var">vPutStr</span></a><span> </span><a href="#local-6989586621679051453"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679051454"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-321"></a><span>
</span><a name="line-322"></a><span>    </span><a name="local-8214565720323824399"><a href="System.IO.HVIO.html#vPrint"><span class="hs-identifier">vPrint</span></a></a><span> </span><a name="local-6989586621679051455"><a href="#local-6989586621679051455"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679051456"><a href="#local-6989586621679051456"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVIO.html#vPutStrLn"><span class="hs-identifier hs-var">vPutStrLn</span></a><span> </span><a href="#local-6989586621679051455"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679051456"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-323"></a><span>
</span><a name="line-324"></a><span>    </span><a name="local-8214565720323824400"><a href="System.IO.HVIO.html#vFlush"><span class="hs-identifier">vFlush</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVIO.html#vTestOpen"><span class="hs-identifier hs-var">vTestOpen</span></a><span>
</span><a name="line-325"></a><span>
</span><a name="line-326"></a><span>
</span><a name="line-327"></a><span>    </span><a name="local-8214565720323824405"><a href="System.IO.HVIO.html#vIsSeekable"><span class="hs-identifier">vIsSeekable</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-328"></a><span>
</span><a name="line-329"></a><span>    </span><a name="local-8214565720323824404"><a href="System.IO.HVIO.html#vRewind"><span class="hs-identifier">vRewind</span></a></a><span> </span><a name="local-6989586621679051457"><a href="#local-6989586621679051457"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVIO.html#vSeek"><span class="hs-identifier hs-var">vSeek</span></a><span> </span><a href="#local-6989586621679051457"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-identifier hs-var">AbsoluteSeek</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-330"></a><span>
</span><a name="line-331"></a><span>    </span><a name="local-8214565720323824396"><a href="System.IO.HVIO.html#vPutChar"><span class="hs-identifier">vPutChar</span></a></a><span> </span><a name="local-6989586621679051458"><a href="#local-6989586621679051458"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVIO.html#vThrow"><span class="hs-identifier hs-var">vThrow</span></a><span> </span><a href="#local-6989586621679051458"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-identifier hs-var">illegalOperationErrorType</span><span>
</span><a name="line-332"></a><span>    </span><a name="local-8214565720323824402"><a href="System.IO.HVIO.html#vSeek"><span class="hs-identifier">vSeek</span></a></a><span> </span><a name="local-6989586621679051459"><a href="#local-6989586621679051459"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVIO.html#vThrow"><span class="hs-identifier hs-var">vThrow</span></a><span> </span><a href="#local-6989586621679051459"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-identifier hs-var">illegalOperationErrorType</span><span>
</span><a name="line-333"></a><span>    </span><a name="local-8214565720323824403"><a href="System.IO.HVIO.html#vTell"><span class="hs-identifier">vTell</span></a></a><span> </span><a name="local-6989586621679051460"><a href="#local-6989586621679051460"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVIO.html#vThrow"><span class="hs-identifier hs-var">vThrow</span></a><span> </span><a href="#local-6989586621679051460"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-identifier hs-var">illegalOperationErrorType</span><span>
</span><a name="line-334"></a><span>    </span><a name="local-8214565720323824391"><a href="System.IO.HVIO.html#vGetChar"><span class="hs-identifier">vGetChar</span></a></a><span> </span><a name="local-6989586621679051461"><a href="#local-6989586621679051461"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVIO.html#vThrow"><span class="hs-identifier hs-var">vThrow</span></a><span> </span><a href="#local-6989586621679051461"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-identifier hs-var">illegalOperationErrorType</span><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span>
</span><a name="line-337"></a><span>    </span><a name="local-8214565720323824408"><a href="System.IO.HVIO.html#vPutBuf"><span class="hs-identifier">vPutBuf</span></a></a><span> </span><a name="local-6989586621679051462"><a href="#local-6989586621679051462"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679051463"><a href="#local-6989586621679051463"><span class="hs-identifier">buf</span></a></a><span> </span><a name="local-6989586621679051464"><a href="#local-6989586621679051464"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-338"></a><span>        </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051563"><a href="#local-6989586621679051563"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peekCStringLen</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">castPtr</span><span> </span><a href="#local-6989586621679051463"><span class="hs-identifier hs-var">buf</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679051464"><span class="hs-identifier hs-var">len</span></a><span class="hs-special">)</span><span>
</span><a name="line-339"></a><span>           </span><a href="System.IO.HVIO.html#vPutStr"><span class="hs-identifier hs-var">vPutStr</span></a><span> </span><a href="#local-6989586621679051462"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679051563"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-340"></a><span>
</span><a name="line-341"></a><span>    </span><a name="local-8214565720323824409"><a href="System.IO.HVIO.html#vGetBuf"><span class="hs-identifier">vGetBuf</span></a></a><span> </span><a name="local-6989586621679051564"><a href="#local-6989586621679051564"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679051565"><a href="#local-6989586621679051565"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679051566"><a href="#local-6989586621679051566"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-342"></a><span>        </span><a href="#local-6989586621679051567"><span class="hs-identifier hs-var">worker</span></a><span> </span><a href="#local-6989586621679051565"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679051566"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-343"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679051567"><a href="#local-6989586621679051567"><span class="hs-identifier">worker</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-number">0</span><span> </span><a name="local-6989586621679051568"><a href="#local-6989586621679051568"><span class="hs-identifier">accum</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679051568"><span class="hs-identifier hs-var">accum</span></a><span>
</span><a name="line-344"></a><span>              </span><span class="hs-identifier">worker</span><span> </span><a name="local-6989586621679051569"><a href="#local-6989586621679051569"><span class="hs-identifier">buf</span></a></a><span> </span><a name="local-6989586621679051570"><a href="#local-6989586621679051570"><span class="hs-identifier">len</span></a></a><span> </span><a name="local-6989586621679051571"><a href="#local-6989586621679051571"><span class="hs-identifier">accum</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-345"></a><span>                  </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051572"><a href="#local-6989586621679051572"><span class="hs-identifier">iseof</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vIsEOF"><span class="hs-identifier hs-var">vIsEOF</span></a><span> </span><a href="#local-6989586621679051564"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-346"></a><span>                     </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679051572"><span class="hs-identifier hs-var">iseof</span></a><span>
</span><a name="line-347"></a><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679051571"><span class="hs-identifier hs-var">accum</span></a><span>
</span><a name="line-348"></a><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051573"><a href="#local-6989586621679051573"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vGetChar"><span class="hs-identifier hs-var">vGetChar</span></a><span> </span><a href="#local-6989586621679051564"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-349"></a><span>                                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679051574"><a href="#local-6989586621679051574"><span class="hs-identifier">cc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">castCharToCChar</span><span> </span><a href="#local-6989586621679051573"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-350"></a><span>                                </span><span class="hs-identifier hs-var">poke</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">castPtr</span><span> </span><a href="#local-6989586621679051569"><span class="hs-identifier hs-var">buf</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679051574"><span class="hs-identifier hs-var">cc</span></a><span>
</span><a name="line-351"></a><span>                                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679051575"><a href="#local-6989586621679051575"><span class="hs-identifier">newptr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">plusPtr</span><span> </span><a href="#local-6989586621679051569"><span class="hs-identifier hs-var">buf</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-352"></a><span>                                </span><a href="#local-6989586621679051567"><span class="hs-identifier hs-var">worker</span></a><span> </span><a href="#local-6989586621679051575"><span class="hs-identifier hs-var">newptr</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679051570"><span class="hs-identifier hs-var">len</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679051571"><span class="hs-identifier hs-var">accum</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span class="hs-comment">----------------------------------------------------------------------</span><span>
</span><a name="line-355"></a><span class="hs-comment">-- Handle instances</span><span>
</span><a name="line-356"></a><span class="hs-comment">----------------------------------------------------------------------</span><span>
</span><a name="line-357"></a><span class="hs-keyword">instance</span><span> </span><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier hs-type">HVIO</span></a><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-358"></a><span>    </span><a name="local-8214565720323824381"><a href="System.IO.HVIO.html#vClose"><span class="hs-identifier">vClose</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hClose</span><span>
</span><a name="line-359"></a><span>    </span><a name="local-8214565720323824385"><a href="System.IO.HVIO.html#vIsEOF"><span class="hs-identifier">vIsEOF</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hIsEOF</span><span>
</span><a name="line-360"></a><span class="hs-cpp">#ifdef __GLASGOW_HASKELL__</span><span>
</span><a name="line-361"></a><span>    </span><a name="local-8214565720323824386"><a href="System.IO.HVIO.html#vShow"><span class="hs-identifier">vShow</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hShow</span><span>
</span><a name="line-362"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-363"></a><span>    </span><a name="local-8214565720323824387"><a href="System.IO.HVIO.html#vMkIOError"><span class="hs-identifier">vMkIOError</span></a></a><span> </span><a name="local-6989586621679051874"><a href="#local-6989586621679051874"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679051875"><a href="#local-6989586621679051875"><span class="hs-identifier">et</span></a></a><span> </span><a name="local-6989586621679051876"><a href="#local-6989586621679051876"><span class="hs-identifier">desc</span></a></a><span> </span><a name="local-6989586621679051877"><a href="#local-6989586621679051877"><span class="hs-identifier">mfp</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-364"></a><span>        </span><span class="hs-identifier hs-var">mkIOError</span><span> </span><a href="#local-6989586621679051875"><span class="hs-identifier hs-var">et</span></a><span> </span><a href="#local-6989586621679051876"><span class="hs-identifier hs-var">desc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679051874"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679051877"><span class="hs-identifier hs-var">mfp</span></a><span>
</span><a name="line-365"></a><span>    </span><a name="local-8214565720323824391"><a href="System.IO.HVIO.html#vGetChar"><span class="hs-identifier">vGetChar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hGetChar</span><span>
</span><a name="line-366"></a><span>    </span><a name="local-8214565720323824392"><a href="System.IO.HVIO.html#vGetLine"><span class="hs-identifier">vGetLine</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hGetLine</span><span>
</span><a name="line-367"></a><span>    </span><a name="local-8214565720323824393"><a href="System.IO.HVIO.html#vGetContents"><span class="hs-identifier">vGetContents</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hGetContents</span><span>
</span><a name="line-368"></a><span>    </span><a name="local-8214565720323824394"><a href="System.IO.HVIO.html#vReady"><span class="hs-identifier">vReady</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hReady</span><span>
</span><a name="line-369"></a><span>    </span><a name="local-8214565720323824395"><a href="System.IO.HVIO.html#vIsReadable"><span class="hs-identifier">vIsReadable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hIsReadable</span><span>
</span><a name="line-370"></a><span>    </span><a name="local-8214565720323824396"><a href="System.IO.HVIO.html#vPutChar"><span class="hs-identifier">vPutChar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hPutChar</span><span>
</span><a name="line-371"></a><span>    </span><a name="local-8214565720323824397"><a href="System.IO.HVIO.html#vPutStr"><span class="hs-identifier">vPutStr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hPutStr</span><span>
</span><a name="line-372"></a><span>    </span><a name="local-8214565720323824398"><a href="System.IO.HVIO.html#vPutStrLn"><span class="hs-identifier">vPutStrLn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hPutStrLn</span><span>
</span><a name="line-373"></a><span>    </span><a name="local-8214565720323824399"><a href="System.IO.HVIO.html#vPrint"><span class="hs-identifier">vPrint</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hPrint</span><span>
</span><a name="line-374"></a><span>    </span><a name="local-8214565720323824400"><a href="System.IO.HVIO.html#vFlush"><span class="hs-identifier">vFlush</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hFlush</span><span>
</span><a name="line-375"></a><span>    </span><a name="local-8214565720323824401"><a href="System.IO.HVIO.html#vIsWritable"><span class="hs-identifier">vIsWritable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hIsWritable</span><span>
</span><a name="line-376"></a><span>    </span><a name="local-8214565720323824402"><a href="System.IO.HVIO.html#vSeek"><span class="hs-identifier">vSeek</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hSeek</span><span>
</span><a name="line-377"></a><span>    </span><a name="local-8214565720323824403"><a href="System.IO.HVIO.html#vTell"><span class="hs-identifier">vTell</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hTell</span><span>
</span><a name="line-378"></a><span>    </span><a name="local-8214565720323824405"><a href="System.IO.HVIO.html#vIsSeekable"><span class="hs-identifier">vIsSeekable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hIsSeekable</span><span>
</span><a name="line-379"></a><span>    </span><a name="local-8214565720323824406"><a href="System.IO.HVIO.html#vSetBuffering"><span class="hs-identifier">vSetBuffering</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hSetBuffering</span><span>
</span><a name="line-380"></a><span>    </span><a name="local-8214565720323824407"><a href="System.IO.HVIO.html#vGetBuffering"><span class="hs-identifier">vGetBuffering</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hGetBuffering</span><span>
</span><a name="line-381"></a><span>    </span><a name="local-8214565720323824409"><a href="System.IO.HVIO.html#vGetBuf"><span class="hs-identifier">vGetBuf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hGetBuf</span><span>
</span><a name="line-382"></a><span>    </span><a name="local-8214565720323824408"><a href="System.IO.HVIO.html#vPutBuf"><span class="hs-identifier">vPutBuf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hPutBuf</span><span>
</span><a name="line-383"></a><span>    </span><a name="local-8214565720323824382"><a href="System.IO.HVIO.html#vIsOpen"><span class="hs-identifier">vIsOpen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hIsOpen</span><span>
</span><a name="line-384"></a><span>    </span><a name="local-8214565720323824383"><a href="System.IO.HVIO.html#vIsClosed"><span class="hs-identifier">vIsClosed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hIsClosed</span><span>
</span><a name="line-385"></a><span>
</span><a name="line-386"></a><span class="hs-comment">----------------------------------------------------------------------</span><span>
</span><a name="line-387"></a><span class="hs-comment">-- VIO Support</span><span>
</span><a name="line-388"></a><span class="hs-comment">----------------------------------------------------------------------</span><span>
</span><a name="line-389"></a><span class="hs-keyword">type</span><span> </span><a name="VIOCloseSupport"><a href="System.IO.HVIO.html#VIOCloseSupport"><span class="hs-identifier">VIOCloseSupport</span></a></a><span> </span><a name="local-6989586621679049565"><a href="#local-6989586621679049565"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679049565"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-390"></a><span>
</span><a name="line-391"></a><span class="hs-identifier">vioc_isopen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.IO.HVIO.html#VIOCloseSupport"><span class="hs-identifier hs-type">VIOCloseSupport</span></a><span> </span><a href="#local-6989586621679051579"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-392"></a><a name="vioc_isopen"><a href="System.IO.HVIO.html#vioc_isopen"><span class="hs-identifier">vioc_isopen</span></a></a><span> </span><a name="local-6989586621679051580"><a href="#local-6989586621679051580"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">readIORef</span><span> </span><a href="#local-6989586621679051580"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span>
</span><a name="line-393"></a><span>
</span><a name="line-394"></a><span class="hs-identifier">vioc_get</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.IO.HVIO.html#VIOCloseSupport"><span class="hs-identifier hs-type">VIOCloseSupport</span></a><span> </span><a href="#local-6989586621679051578"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679051578"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-395"></a><a name="vioc_get"><a href="System.IO.HVIO.html#vioc_get"><span class="hs-identifier">vioc_get</span></a></a><span> </span><a name="local-6989586621679051581"><a href="#local-6989586621679051581"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">readIORef</span><span> </span><a href="#local-6989586621679051581"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span>
</span><a name="line-396"></a><span>
</span><a name="line-397"></a><span class="hs-identifier">vioc_close</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.IO.HVIO.html#VIOCloseSupport"><span class="hs-identifier hs-type">VIOCloseSupport</span></a><span> </span><a href="#local-6989586621679051577"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-398"></a><a name="vioc_close"><a href="System.IO.HVIO.html#vioc_close"><span class="hs-identifier">vioc_close</span></a></a><span> </span><a name="local-6989586621679051582"><a href="#local-6989586621679051582"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">modifyIORef</span><span> </span><a href="#local-6989586621679051582"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679051583"><a href="#local-6989586621679051583"><span class="hs-identifier">dat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679051583"><span class="hs-identifier hs-var">dat</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-399"></a><span>
</span><a name="line-400"></a><span class="hs-identifier">vioc_set</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.IO.HVIO.html#VIOCloseSupport"><span class="hs-identifier hs-type">VIOCloseSupport</span></a><span> </span><a href="#local-6989586621679051576"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679051576"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-401"></a><a name="vioc_set"><a href="System.IO.HVIO.html#vioc_set"><span class="hs-identifier">vioc_set</span></a></a><span> </span><a name="local-6989586621679051584"><a href="#local-6989586621679051584"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679051585"><a href="#local-6989586621679051585"><span class="hs-identifier">newdat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">modifyIORef</span><span> </span><a href="#local-6989586621679051584"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679051586"><a href="#local-6989586621679051586"><span class="hs-identifier">stat</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679051586"><span class="hs-identifier hs-var">stat</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679051585"><span class="hs-identifier hs-var">newdat</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-402"></a><span>
</span><a name="line-403"></a><span class="hs-comment">----------------------------------------------------------------------</span><span>
</span><a name="line-404"></a><span class="hs-comment">-- Stream Readers</span><span>
</span><a name="line-405"></a><span class="hs-comment">----------------------------------------------------------------------</span><span>
</span><a name="line-406"></a><span class="hs-comment">{- | Simulate I\/O based on a string buffer.

When a 'StreamReader' is created, it is initialized based on the contents of
a 'String'.  Its contents are read lazily whenever a request is made to read
something from the 'StreamReader'.    It
can be used, therefore, to implement filters (simply initialize it with the
result from, say, a map over hGetContents from another HVIO object), codecs,
and simple I\/O testing.  Because it is lazy, it need not hold the entire
string in memory.  You can create a 'StreamReader' with a call to
'newStreamReader'.
 -}</span><span>
</span><a name="line-417"></a><span class="hs-keyword">newtype</span><span> </span><a name="StreamReader"><a href="System.IO.HVIO.html#StreamReader"><span class="hs-identifier">StreamReader</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="StreamReader"><a href="System.IO.HVIO.html#StreamReader"><span class="hs-identifier">StreamReader</span></a></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#VIOCloseSupport"><span class="hs-identifier hs-type">VIOCloseSupport</span></a><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-418"></a><span>
</span><a name="line-419"></a><span class="hs-comment">{- | Create a new 'StreamReader' object. -}</span><span>
</span><a name="line-420"></a><span class="hs-identifier">newStreamReader</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>            </span><span class="hs-comment">-- ^ Initial contents of the 'StreamReader'</span><span>
</span><a name="line-421"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="System.IO.HVIO.html#StreamReader"><span class="hs-identifier hs-type">StreamReader</span></a><span>
</span><a name="line-422"></a><a name="newStreamReader"><a href="System.IO.HVIO.html#newStreamReader"><span class="hs-identifier">newStreamReader</span></a></a><span> </span><a name="local-6989586621679051587"><a href="#local-6989586621679051587"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051588"><a href="#local-6989586621679051588"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newIORef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679051587"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-423"></a><span>                       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#StreamReader"><span class="hs-identifier hs-var">StreamReader</span></a><span> </span><a href="#local-6989586621679051588"><span class="hs-identifier hs-var">ref</span></a><span class="hs-special">)</span><span>
</span><a name="line-424"></a><span>
</span><a name="line-425"></a><span class="hs-identifier">srv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.IO.HVIO.html#StreamReader"><span class="hs-identifier hs-type">StreamReader</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.IO.HVIO.html#VIOCloseSupport"><span class="hs-identifier hs-type">VIOCloseSupport</span></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-426"></a><a name="srv"><a href="System.IO.HVIO.html#srv"><span class="hs-identifier">srv</span></a></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#StreamReader"><span class="hs-identifier hs-var">StreamReader</span></a><span> </span><a name="local-6989586621679051589"><a href="#local-6989586621679051589"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679051589"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-427"></a><span>
</span><a name="line-428"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="System.IO.HVIO.html#StreamReader"><span class="hs-identifier hs-type">StreamReader</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-429"></a><span>    </span><a name="local-8214565720323784721"><span class="hs-identifier">show</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&lt;StreamReader&gt;&quot;</span><span>
</span><a name="line-430"></a><span>
</span><a name="line-431"></a><span class="hs-keyword">instance</span><span> </span><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier hs-type">HVIO</span></a><span> </span><a href="System.IO.HVIO.html#StreamReader"><span class="hs-identifier hs-type">StreamReader</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-432"></a><span>    </span><a name="local-8214565720323824381"><a href="System.IO.HVIO.html#vClose"><span class="hs-identifier">vClose</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVIO.html#vioc_close"><span class="hs-identifier hs-var">vioc_close</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="System.IO.HVIO.html#srv"><span class="hs-identifier hs-var">srv</span></a><span>
</span><a name="line-433"></a><span>    </span><a name="local-8214565720323824385"><a href="System.IO.HVIO.html#vIsEOF"><span class="hs-identifier">vIsEOF</span></a></a><span> </span><a name="local-6989586621679051657"><a href="#local-6989586621679051657"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="System.IO.HVIO.html#vTestOpen"><span class="hs-identifier hs-var">vTestOpen</span></a><span> </span><a href="#local-6989586621679051657"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-434"></a><span>                  </span><a name="local-6989586621679051658"><a href="#local-6989586621679051658"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vioc_get"><span class="hs-identifier hs-var">vioc_get</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#srv"><span class="hs-identifier hs-var">srv</span></a><span> </span><a href="#local-6989586621679051657"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-435"></a><span>                  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679051658"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-436"></a><span>                                  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-437"></a><span>                                  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-438"></a><span>    </span><a name="local-8214565720323824382"><a href="System.IO.HVIO.html#vIsOpen"><span class="hs-identifier">vIsOpen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVIO.html#vioc_isopen"><span class="hs-identifier hs-var">vioc_isopen</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="System.IO.HVIO.html#srv"><span class="hs-identifier hs-var">srv</span></a><span>
</span><a name="line-439"></a><span>    </span><a name="local-8214565720323824391"><a href="System.IO.HVIO.html#vGetChar"><span class="hs-identifier">vGetChar</span></a></a><span> </span><a name="local-6989586621679051659"><a href="#local-6989586621679051659"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="System.IO.HVIO.html#vTestEOF"><span class="hs-identifier hs-var">vTestEOF</span></a><span> </span><a href="#local-6989586621679051659"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-440"></a><span>                    </span><a name="local-6989586621679051660"><a href="#local-6989586621679051660"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vioc_get"><span class="hs-identifier hs-var">vioc_get</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#srv"><span class="hs-identifier hs-var">srv</span></a><span> </span><a href="#local-6989586621679051659"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-441"></a><span>                    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679051661"><a href="#local-6989586621679051661"><span class="hs-identifier">retval</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679051660"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-442"></a><span>                    </span><a href="System.IO.HVIO.html#vioc_set"><span class="hs-identifier hs-var">vioc_set</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#srv"><span class="hs-identifier hs-var">srv</span></a><span> </span><a href="#local-6989586621679051659"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621679051660"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-443"></a><span>                    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679051661"><span class="hs-identifier hs-var">retval</span></a><span>
</span><a name="line-444"></a><span>
</span><a name="line-445"></a><span>    </span><a name="local-8214565720323824393"><a href="System.IO.HVIO.html#vGetContents"><span class="hs-identifier">vGetContents</span></a></a><span> </span><a name="local-6989586621679051662"><a href="#local-6989586621679051662"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="System.IO.HVIO.html#vTestEOF"><span class="hs-identifier hs-var">vTestEOF</span></a><span> </span><a href="#local-6989586621679051662"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-446"></a><span>                        </span><a name="local-6989586621679051663"><a href="#local-6989586621679051663"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vioc_get"><span class="hs-identifier hs-var">vioc_get</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#srv"><span class="hs-identifier hs-var">srv</span></a><span> </span><a href="#local-6989586621679051662"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-447"></a><span>                        </span><a href="System.IO.HVIO.html#vClose"><span class="hs-identifier hs-var">vClose</span></a><span> </span><a href="#local-6989586621679051662"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-448"></a><span>                        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679051663"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-449"></a><span>    </span><a name="local-8214565720323824395"><a href="System.IO.HVIO.html#vIsReadable"><span class="hs-identifier">vIsReadable</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-450"></a><span>
</span><a name="line-451"></a><span class="hs-comment">----------------------------------------------------------------------</span><span>
</span><a name="line-452"></a><span class="hs-comment">-- Buffers</span><span>
</span><a name="line-453"></a><span class="hs-comment">----------------------------------------------------------------------</span><span>
</span><a name="line-454"></a><span class="hs-comment">{- | A 'MemoryBuffer' simulates true I\/O, but uses an in-memory buffer instead
of on-disk storage.

It provides
a full interface like Handle (it implements 'HVIOReader', 'HVIOWriter',
and 'HVIOSeeker').  However, it maintains an in-memory buffer with the
contents of the file, rather than an actual on-disk file.  You can access
the entire contents of this buffer at any time.  This can be quite useful
for testing I\/O code, or for cases where existing APIs use I\/O, but you
prefer a String representation.  You can create a 'MemoryBuffer' with a call
to 'newMemoryBuffer'.

The present 'MemoryBuffer' implementation is rather inefficient, particularly
when reading towards the end of large files.  It's best used for smallish
data storage.  This problem will be fixed eventually.
-}</span><span>
</span><a name="line-470"></a><span class="hs-keyword">data</span><span> </span><a name="MemoryBuffer"><a href="System.IO.HVIO.html#MemoryBuffer"><span class="hs-identifier">MemoryBuffer</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="MemoryBuffer"><a href="System.IO.HVIO.html#MemoryBuffer"><span class="hs-identifier">MemoryBuffer</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#VIOCloseSupport"><span class="hs-identifier hs-type">VIOCloseSupport</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-471"></a><span>
</span><a name="line-472"></a><span class="hs-comment">{- | Create a new 'MemoryBuffer' instance.  The buffer is initialized
to the value passed, and the pointer is placed at the beginning of the file.

You can put things in it by using the normal 'vPutStr' calls, and reset to
the beginning by using the normal 'vRewind' call.

The function is called when 'vClose' is called, and is passed the contents of
the buffer at close time.  You can use 'mbDefaultCloseFunc' if you don't want to
do anything.

To create an empty buffer, pass the initial value @\&quot;\&quot;@. -}</span><span>
</span><a name="line-483"></a><span class="hs-identifier">newMemoryBuffer</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>               </span><span class="hs-comment">-- ^ Initial Contents</span><span>
</span><a name="line-484"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- ^ close func</span><span>
</span><a name="line-485"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="System.IO.HVIO.html#MemoryBuffer"><span class="hs-identifier hs-type">MemoryBuffer</span></a><span>
</span><a name="line-486"></a><a name="newMemoryBuffer"><a href="System.IO.HVIO.html#newMemoryBuffer"><span class="hs-identifier">newMemoryBuffer</span></a></a><span> </span><a name="local-6989586621679051590"><a href="#local-6989586621679051590"><span class="hs-identifier">initval</span></a></a><span> </span><a name="local-6989586621679051591"><a href="#local-6989586621679051591"><span class="hs-identifier">closefunc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051592"><a href="#local-6989586621679051592"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newIORef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679051590"><span class="hs-identifier hs-var">initval</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-487"></a><span>                                       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#MemoryBuffer"><span class="hs-identifier hs-var">MemoryBuffer</span></a><span> </span><a href="#local-6989586621679051591"><span class="hs-identifier hs-var">closefunc</span></a><span> </span><a href="#local-6989586621679051592"><span class="hs-identifier hs-var">ref</span></a><span class="hs-special">)</span><span>
</span><a name="line-488"></a><span>
</span><a name="line-489"></a><span class="hs-comment">{- | Default (no-op) memory buf close function. -}</span><span>
</span><a name="line-490"></a><span class="hs-identifier">mbDefaultCloseFunc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-491"></a><a name="mbDefaultCloseFunc"><a href="System.IO.HVIO.html#mbDefaultCloseFunc"><span class="hs-identifier">mbDefaultCloseFunc</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-492"></a><span>
</span><a name="line-493"></a><span class="hs-identifier">vrv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.IO.HVIO.html#MemoryBuffer"><span class="hs-identifier hs-type">MemoryBuffer</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.IO.HVIO.html#VIOCloseSupport"><span class="hs-identifier hs-type">VIOCloseSupport</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-494"></a><a name="vrv"><a href="System.IO.HVIO.html#vrv"><span class="hs-identifier">vrv</span></a></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#MemoryBuffer"><span class="hs-identifier hs-var">MemoryBuffer</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679051593"><a href="#local-6989586621679051593"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679051593"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-495"></a><span>
</span><a name="line-496"></a><span class="hs-comment">{- | Grab the entire contents of the buffer as a string.
Unlike 'vGetContents', this has no effect on the open status of the
item, the EOF status, or the current position of the file pointer. -}</span><span>
</span><a name="line-499"></a><span class="hs-identifier">getMemoryBuffer</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.IO.HVIO.html#MemoryBuffer"><span class="hs-identifier hs-type">MemoryBuffer</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-500"></a><a name="getMemoryBuffer"><a href="System.IO.HVIO.html#getMemoryBuffer"><span class="hs-identifier">getMemoryBuffer</span></a></a><span> </span><a name="local-6989586621679051594"><a href="#local-6989586621679051594"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051595"><a href="#local-6989586621679051595"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vioc_get"><span class="hs-identifier hs-var">vioc_get</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#vrv"><span class="hs-identifier hs-var">vrv</span></a><span> </span><a href="#local-6989586621679051594"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-501"></a><span>                       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679051595"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-502"></a><span>
</span><a name="line-503"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="System.IO.HVIO.html#MemoryBuffer"><span class="hs-identifier hs-type">MemoryBuffer</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-504"></a><span>    </span><a name="local-8214565720323784721"><span class="hs-identifier">show</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&lt;MemoryBuffer&gt;&quot;</span><span>
</span><a name="line-505"></a><span>
</span><a name="line-506"></a><span class="hs-keyword">instance</span><span> </span><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier hs-type">HVIO</span></a><span> </span><a href="System.IO.HVIO.html#MemoryBuffer"><span class="hs-identifier hs-type">MemoryBuffer</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-507"></a><span>    </span><a name="local-8214565720323824381"><a href="System.IO.HVIO.html#vClose"><span class="hs-identifier">vClose</span></a></a><span> </span><a name="local-6989586621679051626"><a href="#local-6989586621679051626"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051627"><a href="#local-6989586621679051627"><span class="hs-identifier">wasopen</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vIsOpen"><span class="hs-identifier hs-var">vIsOpen</span></a><span> </span><a href="#local-6989586621679051626"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-508"></a><span>                  </span><a href="System.IO.HVIO.html#vioc_close"><span class="hs-identifier hs-var">vioc_close</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#vrv"><span class="hs-identifier hs-var">vrv</span></a><span> </span><a href="#local-6989586621679051626"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-509"></a><span>                  </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679051627"><span class="hs-identifier hs-var">wasopen</span></a><span>
</span><a name="line-510"></a><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051628"><a href="#local-6989586621679051628"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#getMemoryBuffer"><span class="hs-identifier hs-var">getMemoryBuffer</span></a><span> </span><a href="#local-6989586621679051626"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-511"></a><span>                             </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679051626"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-512"></a><span>                                 </span><a href="System.IO.HVIO.html#MemoryBuffer"><span class="hs-identifier hs-var">MemoryBuffer</span></a><span> </span><a name="local-6989586621679051629"><a href="#local-6989586621679051629"><span class="hs-identifier">cf</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679051629"><span class="hs-identifier hs-var">cf</span></a><span> </span><a href="#local-6989586621679051628"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-513"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-514"></a><span>    </span><a name="local-8214565720323824385"><a href="System.IO.HVIO.html#vIsEOF"><span class="hs-identifier">vIsEOF</span></a></a><span> </span><a name="local-6989586621679051630"><a href="#local-6989586621679051630"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="System.IO.HVIO.html#vTestOpen"><span class="hs-identifier hs-var">vTestOpen</span></a><span> </span><a href="#local-6989586621679051630"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-515"></a><span>                  </span><a name="local-6989586621679051631"><a href="#local-6989586621679051631"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vioc_get"><span class="hs-identifier hs-var">vioc_get</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#vrv"><span class="hs-identifier hs-var">vrv</span></a><span> </span><a href="#local-6989586621679051630"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-516"></a><span>                  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679051631"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679051631"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-517"></a><span>    </span><a name="local-8214565720323824382"><a href="System.IO.HVIO.html#vIsOpen"><span class="hs-identifier">vIsOpen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVIO.html#vioc_isopen"><span class="hs-identifier hs-var">vioc_isopen</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="System.IO.HVIO.html#vrv"><span class="hs-identifier hs-var">vrv</span></a><span>
</span><a name="line-518"></a><span>    </span><a name="local-8214565720323824391"><a href="System.IO.HVIO.html#vGetChar"><span class="hs-identifier">vGetChar</span></a></a><span> </span><a name="local-6989586621679051632"><a href="#local-6989586621679051632"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="System.IO.HVIO.html#vTestEOF"><span class="hs-identifier hs-var">vTestEOF</span></a><span> </span><a href="#local-6989586621679051632"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-519"></a><span>                    </span><a name="local-6989586621679051633"><a href="#local-6989586621679051633"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vioc_get"><span class="hs-identifier hs-var">vioc_get</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#vrv"><span class="hs-identifier hs-var">vrv</span></a><span> </span><a href="#local-6989586621679051632"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-520"></a><span>                    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679051634"><a href="#local-6989586621679051634"><span class="hs-identifier">retval</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679051633"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">!!</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679051633"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-521"></a><span>                    </span><a href="System.IO.HVIO.html#vioc_set"><span class="hs-identifier hs-var">vioc_set</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#vrv"><span class="hs-identifier hs-var">vrv</span></a><span> </span><a href="#local-6989586621679051632"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">succ</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679051633"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679051633"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-522"></a><span>                    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679051634"><span class="hs-identifier hs-var">retval</span></a><span>
</span><a name="line-523"></a><span>    </span><a name="local-8214565720323824393"><a href="System.IO.HVIO.html#vGetContents"><span class="hs-identifier">vGetContents</span></a></a><span> </span><a name="local-6989586621679051635"><a href="#local-6989586621679051635"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="System.IO.HVIO.html#vTestEOF"><span class="hs-identifier hs-var">vTestEOF</span></a><span> </span><a href="#local-6989586621679051635"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-524"></a><span>                        </span><a name="local-6989586621679051636"><a href="#local-6989586621679051636"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vioc_get"><span class="hs-identifier hs-var">vioc_get</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#vrv"><span class="hs-identifier hs-var">vrv</span></a><span> </span><a href="#local-6989586621679051635"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-525"></a><span>                        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679051637"><a href="#local-6989586621679051637"><span class="hs-identifier">retval</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679051636"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679051636"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-526"></a><span>                        </span><a href="System.IO.HVIO.html#vioc_set"><span class="hs-identifier hs-var">vioc_set</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#vrv"><span class="hs-identifier hs-var">vrv</span></a><span> </span><a href="#local-6989586621679051635"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-527"></a><span>                        </span><a href="System.IO.HVIO.html#vClose"><span class="hs-identifier hs-var">vClose</span></a><span> </span><a href="#local-6989586621679051635"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-528"></a><span>                        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679051637"><span class="hs-identifier hs-var">retval</span></a><span>
</span><a name="line-529"></a><span>    </span><a name="local-8214565720323824395"><a href="System.IO.HVIO.html#vIsReadable"><span class="hs-identifier">vIsReadable</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-530"></a><span>
</span><a name="line-531"></a><span>    </span><a name="local-8214565720323824397"><a href="System.IO.HVIO.html#vPutStr"><span class="hs-identifier">vPutStr</span></a></a><span> </span><a name="local-6989586621679051638"><a href="#local-6989586621679051638"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679051639"><a href="#local-6989586621679051639"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679051640"><a href="#local-6989586621679051640"><span class="hs-identifier">pos</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679051641"><a href="#local-6989586621679051641"><span class="hs-identifier">buf</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vioc_get"><span class="hs-identifier hs-var">vioc_get</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#vrv"><span class="hs-identifier hs-var">vrv</span></a><span> </span><a href="#local-6989586621679051638"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-532"></a><span>                     </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679051642"><a href="#local-6989586621679051642"><span class="hs-identifier">pre</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679051643"><a href="#local-6989586621679051643"><span class="hs-identifier">post</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">splitAt</span><span> </span><a href="#local-6989586621679051640"><span class="hs-identifier hs-var">pos</span></a><span> </span><a href="#local-6989586621679051641"><span class="hs-identifier hs-var">buf</span></a><span>
</span><a name="line-533"></a><span>                     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679051644"><a href="#local-6989586621679051644"><span class="hs-identifier">newbuf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679051642"><span class="hs-identifier hs-var">pre</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679051639"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679051639"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679051643"><span class="hs-identifier hs-var">post</span></a><span class="hs-special">)</span><span>
</span><a name="line-534"></a><span>                     </span><a href="System.IO.HVIO.html#vioc_set"><span class="hs-identifier hs-var">vioc_set</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#vrv"><span class="hs-identifier hs-var">vrv</span></a><span> </span><a href="#local-6989586621679051638"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679051640"><span class="hs-identifier hs-var">pos</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679051639"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679051644"><span class="hs-identifier hs-var">newbuf</span></a><span class="hs-special">)</span><span>
</span><a name="line-535"></a><span>    </span><a name="local-8214565720323824396"><a href="System.IO.HVIO.html#vPutChar"><span class="hs-identifier">vPutChar</span></a></a><span> </span><a name="local-6989586621679051645"><a href="#local-6989586621679051645"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679051646"><a href="#local-6989586621679051646"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVIO.html#vPutStr"><span class="hs-identifier hs-var">vPutStr</span></a><span> </span><a href="#local-6989586621679051645"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679051646"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span>
</span><a name="line-536"></a><span>    </span><a name="local-8214565720323824401"><a href="System.IO.HVIO.html#vIsWritable"><span class="hs-identifier">vIsWritable</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-537"></a><span>    </span><a name="local-8214565720323824403"><a href="System.IO.HVIO.html#vTell"><span class="hs-identifier">vTell</span></a></a><span> </span><a name="local-6989586621679051647"><a href="#local-6989586621679051647"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051648"><a href="#local-6989586621679051648"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vioc_get"><span class="hs-identifier hs-var">vioc_get</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#vrv"><span class="hs-identifier hs-var">vrv</span></a><span> </span><a href="#local-6989586621679051647"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-538"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679051648"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-539"></a><span>    </span><a name="local-8214565720323824402"><a href="System.IO.HVIO.html#vSeek"><span class="hs-identifier">vSeek</span></a></a><span> </span><a name="local-6989586621679051649"><a href="#local-6989586621679051649"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679051650"><a href="#local-6989586621679051650"><span class="hs-identifier">seekmode</span></a></a><span> </span><a name="local-6989586621679051651"><a href="#local-6989586621679051651"><span class="hs-identifier">seekposp</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-540"></a><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679051652"><a href="#local-6989586621679051652"><span class="hs-identifier">pos</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679051653"><a href="#local-6989586621679051653"><span class="hs-identifier">buf</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vioc_get"><span class="hs-identifier hs-var">vioc_get</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#vrv"><span class="hs-identifier hs-var">vrv</span></a><span> </span><a href="#local-6989586621679051649"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-541"></a><span>           </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679051654"><a href="#local-6989586621679051654"><span class="hs-identifier">seekpos</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621679051651"><span class="hs-identifier hs-var">seekposp</span></a><span>
</span><a name="line-542"></a><span>           </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679051655"><a href="#local-6989586621679051655"><span class="hs-identifier">newpos</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679051650"><span class="hs-identifier hs-var">seekmode</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-543"></a><span>                             </span><span class="hs-identifier hs-var">AbsoluteSeek</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679051654"><span class="hs-identifier hs-var">seekpos</span></a><span>
</span><a name="line-544"></a><span>                             </span><span class="hs-identifier hs-var">RelativeSeek</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679051652"><span class="hs-identifier hs-var">pos</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679051654"><span class="hs-identifier hs-var">seekpos</span></a><span>
</span><a name="line-545"></a><span>                             </span><span class="hs-identifier hs-var">SeekFromEnd</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679051653"><span class="hs-identifier hs-var">buf</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679051654"><span class="hs-identifier hs-var">seekpos</span></a><span>
</span><a name="line-546"></a><span>           </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679051656"><a href="#local-6989586621679051656"><span class="hs-identifier">buf2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679051653"><span class="hs-identifier hs-var">buf</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679051655"><span class="hs-identifier hs-var">newpos</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679051653"><span class="hs-identifier hs-var">buf</span></a><span class="hs-special">)</span><span>
</span><a name="line-547"></a><span>                                </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679051655"><span class="hs-identifier hs-var">newpos</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679051653"><span class="hs-identifier hs-var">buf</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-char">'\0'</span><span>
</span><a name="line-548"></a><span>                                </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-549"></a><span>           </span><a href="System.IO.HVIO.html#vioc_set"><span class="hs-identifier hs-var">vioc_set</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#vrv"><span class="hs-identifier hs-var">vrv</span></a><span> </span><a href="#local-6989586621679051649"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679051655"><span class="hs-identifier hs-var">newpos</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679051656"><span class="hs-identifier hs-var">buf2</span></a><span class="hs-special">)</span><span>
</span><a name="line-550"></a><span>    </span><a name="local-8214565720323824405"><a href="System.IO.HVIO.html#vIsSeekable"><span class="hs-identifier">vIsSeekable</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-551"></a><span>
</span><a name="line-552"></a><span class="hs-comment">----------------------------------------------------------------------</span><span>
</span><a name="line-553"></a><span class="hs-comment">-- Pipes</span><span>
</span><a name="line-554"></a><span class="hs-comment">----------------------------------------------------------------------</span><span>
</span><a name="line-555"></a><span class="hs-comment">{- | Create a Haskell pipe.

These pipes are analogous to the Unix
pipes that are available from System.Posix, but don't require Unix and work
only in Haskell.  When you create a pipe, you actually get two HVIO objects:
a 'PipeReader' and a 'PipeWriter'.  You must use the 'PipeWriter' in one
thread and the 'PipeReader' in another thread.  Data that's written to the
'PipeWriter' will then be available for reading with the 'PipeReader'.  The
pipes are implemented completely with existing Haskell threading primitives,
and require no special operating system support.  Unlike Unix pipes, these
pipes cannot be used across a fork().  Also unlike Unix pipes, these pipes
are portable and interact well with Haskell threads. -}</span><span>
</span><a name="line-567"></a><span class="hs-identifier">newHVIOPipe</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#PipeReader"><span class="hs-identifier hs-type">PipeReader</span></a><span class="hs-special">,</span><span> </span><a href="System.IO.HVIO.html#PipeWriter"><span class="hs-identifier hs-type">PipeWriter</span></a><span class="hs-special">)</span><span>
</span><a name="line-568"></a><a name="newHVIOPipe"><a href="System.IO.HVIO.html#newHVIOPipe"><span class="hs-identifier">newHVIOPipe</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051596"><a href="#local-6989586621679051596"><span class="hs-identifier">mv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newEmptyMVar</span><span>
</span><a name="line-569"></a><span>                 </span><a name="local-6989586621679051597"><a href="#local-6989586621679051597"><span class="hs-identifier">readerref</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newIORef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679051596"><span class="hs-identifier hs-var">mv</span></a><span class="hs-special">)</span><span>
</span><a name="line-570"></a><span>                 </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679051598"><a href="#local-6989586621679051598"><span class="hs-identifier">reader</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVIO.html#PipeReader"><span class="hs-identifier hs-var">PipeReader</span></a><span> </span><a href="#local-6989586621679051597"><span class="hs-identifier hs-var">readerref</span></a><span>
</span><a name="line-571"></a><span>                 </span><a name="local-6989586621679051599"><a href="#local-6989586621679051599"><span class="hs-identifier">writerref</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newIORef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679051598"><span class="hs-identifier hs-var">reader</span></a><span class="hs-special">)</span><span>
</span><a name="line-572"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679051598"><span class="hs-identifier hs-var">reader</span></a><span class="hs-special">,</span><span> </span><a href="System.IO.HVIO.html#PipeWriter"><span class="hs-identifier hs-var">PipeWriter</span></a><span> </span><a href="#local-6989586621679051599"><span class="hs-identifier hs-var">writerref</span></a><span class="hs-special">)</span><span>
</span><a name="line-573"></a><span>
</span><a name="line-574"></a><span class="hs-keyword">data</span><span> </span><a name="PipeBit"><a href="System.IO.HVIO.html#PipeBit"><span class="hs-identifier">PipeBit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PipeBit"><a href="System.IO.HVIO.html#PipeBit"><span class="hs-identifier">PipeBit</span></a></a><span> </span><span class="hs-identifier hs-type">Char</span><span>
</span><a name="line-575"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a name="PipeEOF"><a href="System.IO.HVIO.html#PipeEOF"><span class="hs-identifier">PipeEOF</span></a></a><span>
</span><a name="line-576"></a><span>               </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-577"></a><span>
</span><a name="line-578"></a><span class="hs-comment">{- | The reading side of a Haskell pipe.  Please see 'newHVIOPipe' for more
details. -}</span><span>
</span><a name="line-580"></a><span class="hs-keyword">newtype</span><span> </span><a name="PipeReader"><a href="System.IO.HVIO.html#PipeReader"><span class="hs-identifier">PipeReader</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PipeReader"><a href="System.IO.HVIO.html#PipeReader"><span class="hs-identifier">PipeReader</span></a></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#VIOCloseSupport"><span class="hs-identifier hs-type">VIOCloseSupport</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MVar</span><span> </span><a href="System.IO.HVIO.html#PipeBit"><span class="hs-identifier hs-type">PipeBit</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-581"></a><span>
</span><a name="line-582"></a><span class="hs-comment">{- | The writing side of a Haskell pipe.  Please see 'newHVIOPipe' for more
details. -}</span><span>
</span><a name="line-584"></a><span class="hs-keyword">newtype</span><span> </span><a name="PipeWriter"><a href="System.IO.HVIO.html#PipeWriter"><span class="hs-identifier">PipeWriter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PipeWriter"><a href="System.IO.HVIO.html#PipeWriter"><span class="hs-identifier">PipeWriter</span></a></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#VIOCloseSupport"><span class="hs-identifier hs-type">VIOCloseSupport</span></a><span> </span><a href="System.IO.HVIO.html#PipeReader"><span class="hs-identifier hs-type">PipeReader</span></a><span class="hs-special">)</span><span>
</span><a name="line-585"></a><span>
</span><a name="line-586"></a><span class="hs-comment">------------------------------</span><span>
</span><a name="line-587"></a><span class="hs-comment">-- Pipe Reader</span><span>
</span><a name="line-588"></a><span class="hs-comment">------------------------------</span><span>
</span><a name="line-589"></a><span class="hs-identifier">prv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.IO.HVIO.html#PipeReader"><span class="hs-identifier hs-type">PipeReader</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.IO.HVIO.html#VIOCloseSupport"><span class="hs-identifier hs-type">VIOCloseSupport</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MVar</span><span> </span><a href="System.IO.HVIO.html#PipeBit"><span class="hs-identifier hs-type">PipeBit</span></a><span class="hs-special">)</span><span>
</span><a name="line-590"></a><a name="prv"><a href="System.IO.HVIO.html#prv"><span class="hs-identifier">prv</span></a></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#PipeReader"><span class="hs-identifier hs-var">PipeReader</span></a><span> </span><a name="local-6989586621679051600"><a href="#local-6989586621679051600"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679051600"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-591"></a><span>
</span><a name="line-592"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="System.IO.HVIO.html#PipeReader"><span class="hs-identifier hs-type">PipeReader</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-593"></a><span>    </span><a name="local-8214565720323784721"><span class="hs-identifier">show</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&lt;PipeReader&gt;&quot;</span><span>
</span><a name="line-594"></a><span>
</span><a name="line-595"></a><span class="hs-identifier">pr_getc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.IO.HVIO.html#PipeReader"><span class="hs-identifier hs-type">PipeReader</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="System.IO.HVIO.html#PipeBit"><span class="hs-identifier hs-type">PipeBit</span></a><span>
</span><a name="line-596"></a><a name="pr_getc"><a href="System.IO.HVIO.html#pr_getc"><span class="hs-identifier">pr_getc</span></a></a><span> </span><a name="local-6989586621679051601"><a href="#local-6989586621679051601"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051602"><a href="#local-6989586621679051602"><span class="hs-identifier">mv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vioc_get"><span class="hs-identifier hs-var">vioc_get</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#prv"><span class="hs-identifier hs-var">prv</span></a><span> </span><a href="#local-6989586621679051601"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-597"></a><span>               </span><span class="hs-identifier hs-var">takeMVar</span><span> </span><a href="#local-6989586621679051602"><span class="hs-identifier hs-var">mv</span></a><span>
</span><a name="line-598"></a><span>
</span><a name="line-599"></a><span class="hs-keyword">instance</span><span> </span><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier hs-type">HVIO</span></a><span> </span><a href="System.IO.HVIO.html#PipeReader"><span class="hs-identifier hs-type">PipeReader</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-600"></a><span>    </span><a name="local-8214565720323824381"><a href="System.IO.HVIO.html#vClose"><span class="hs-identifier">vClose</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVIO.html#vioc_close"><span class="hs-identifier hs-var">vioc_close</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="System.IO.HVIO.html#prv"><span class="hs-identifier hs-var">prv</span></a><span>
</span><a name="line-601"></a><span>    </span><a name="local-8214565720323824382"><a href="System.IO.HVIO.html#vIsOpen"><span class="hs-identifier">vIsOpen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVIO.html#vioc_isopen"><span class="hs-identifier hs-var">vioc_isopen</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="System.IO.HVIO.html#prv"><span class="hs-identifier hs-var">prv</span></a><span>
</span><a name="line-602"></a><span>    </span><a name="local-8214565720323824385"><a href="System.IO.HVIO.html#vIsEOF"><span class="hs-identifier">vIsEOF</span></a></a><span> </span><a name="local-6989586621679051615"><a href="#local-6989586621679051615"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="System.IO.HVIO.html#vTestOpen"><span class="hs-identifier hs-var">vTestOpen</span></a><span> </span><a href="#local-6989586621679051615"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-603"></a><span>                  </span><a name="local-6989586621679051616"><a href="#local-6989586621679051616"><span class="hs-identifier">mv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vioc_get"><span class="hs-identifier hs-var">vioc_get</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#prv"><span class="hs-identifier hs-var">prv</span></a><span> </span><a href="#local-6989586621679051615"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-604"></a><span>                  </span><a name="local-6989586621679051617"><a href="#local-6989586621679051617"><span class="hs-identifier">dat</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readMVar</span><span> </span><a href="#local-6989586621679051616"><span class="hs-identifier hs-var">mv</span></a><span>
</span><a name="line-605"></a><span>                  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679051617"><span class="hs-identifier hs-var">dat</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="System.IO.HVIO.html#PipeEOF"><span class="hs-identifier hs-var">PipeEOF</span></a><span class="hs-special">)</span><span>
</span><a name="line-606"></a><span>
</span><a name="line-607"></a><span>    </span><a name="local-8214565720323824391"><a href="System.IO.HVIO.html#vGetChar"><span class="hs-identifier">vGetChar</span></a></a><span> </span><a name="local-6989586621679051618"><a href="#local-6989586621679051618"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="System.IO.HVIO.html#vTestEOF"><span class="hs-identifier hs-var">vTestEOF</span></a><span> </span><a href="#local-6989586621679051618"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-608"></a><span>                    </span><a name="local-6989586621679051619"><a href="#local-6989586621679051619"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#pr_getc"><span class="hs-identifier hs-var">pr_getc</span></a><span> </span><a href="#local-6989586621679051618"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-609"></a><span>                    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679051619"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-610"></a><span>                        </span><a href="System.IO.HVIO.html#PipeBit"><span class="hs-identifier hs-var">PipeBit</span></a><span> </span><a name="local-6989586621679051620"><a href="#local-6989586621679051620"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679051620"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-611"></a><span>                        </span><span class="hs-comment">-- vTestEOF should eliminate this case</span><span>
</span><a name="line-612"></a><span>                        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-string">&quot;Internal error in HVIOReader vGetChar&quot;</span><span>
</span><a name="line-613"></a><span>    </span><a name="local-8214565720323824393"><a href="System.IO.HVIO.html#vGetContents"><span class="hs-identifier">vGetContents</span></a></a><span> </span><a name="local-6989586621679051621"><a href="#local-6989586621679051621"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-614"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679051622"><a href="#local-6989586621679051622"><span class="hs-identifier">loop</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051623"><a href="#local-6989586621679051623"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#pr_getc"><span class="hs-identifier hs-var">pr_getc</span></a><span> </span><a href="#local-6989586621679051621"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-615"></a><span>                      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679051623"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-616"></a><span>                          </span><a href="System.IO.HVIO.html#PipeEOF"><span class="hs-identifier hs-var">PipeEOF</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-617"></a><span>                          </span><a href="System.IO.HVIO.html#PipeBit"><span class="hs-identifier hs-var">PipeBit</span></a><span> </span><a name="local-6989586621679051624"><a href="#local-6989586621679051624"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051625"><a href="#local-6989586621679051625"><span class="hs-identifier">next</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679051622"><span class="hs-identifier hs-var">loop</span></a><span>
</span><a name="line-618"></a><span>                                          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679051624"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679051625"><span class="hs-identifier hs-var">next</span></a><span class="hs-special">)</span><span>
</span><a name="line-619"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="System.IO.HVIO.html#vTestEOF"><span class="hs-identifier hs-var">vTestEOF</span></a><span> </span><a href="#local-6989586621679051621"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-620"></a><span>              </span><a href="#local-6989586621679051622"><span class="hs-identifier hs-var">loop</span></a><span>
</span><a name="line-621"></a><span>    </span><a name="local-8214565720323824395"><a href="System.IO.HVIO.html#vIsReadable"><span class="hs-identifier">vIsReadable</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-622"></a><span>
</span><a name="line-623"></a><span class="hs-comment">------------------------------</span><span>
</span><a name="line-624"></a><span class="hs-comment">-- Pipe Writer</span><span>
</span><a name="line-625"></a><span class="hs-comment">------------------------------</span><span>
</span><a name="line-626"></a><span class="hs-identifier">pwv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.IO.HVIO.html#PipeWriter"><span class="hs-identifier hs-type">PipeWriter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.IO.HVIO.html#VIOCloseSupport"><span class="hs-identifier hs-type">VIOCloseSupport</span></a><span> </span><a href="System.IO.HVIO.html#PipeReader"><span class="hs-identifier hs-type">PipeReader</span></a><span>
</span><a name="line-627"></a><a name="pwv"><a href="System.IO.HVIO.html#pwv"><span class="hs-identifier">pwv</span></a></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#PipeWriter"><span class="hs-identifier hs-var">PipeWriter</span></a><span> </span><a name="local-6989586621679051603"><a href="#local-6989586621679051603"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679051603"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-628"></a><span>
</span><a name="line-629"></a><span class="hs-identifier">pwmv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.IO.HVIO.html#PipeWriter"><span class="hs-identifier hs-type">PipeWriter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MVar</span><span> </span><a href="System.IO.HVIO.html#PipeBit"><span class="hs-identifier hs-type">PipeBit</span></a><span class="hs-special">)</span><span>
</span><a name="line-630"></a><a name="pwmv"><a href="System.IO.HVIO.html#pwmv"><span class="hs-identifier">pwmv</span></a></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#PipeWriter"><span class="hs-identifier hs-var">PipeWriter</span></a><span> </span><a name="local-6989586621679051604"><a href="#local-6989586621679051604"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051605"><a href="#local-6989586621679051605"><span class="hs-identifier">mv1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vioc_get"><span class="hs-identifier hs-var">vioc_get</span></a><span> </span><a href="#local-6989586621679051604"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-631"></a><span>                         </span><a href="System.IO.HVIO.html#vioc_get"><span class="hs-identifier hs-var">vioc_get</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#prv"><span class="hs-identifier hs-var">prv</span></a><span> </span><a href="#local-6989586621679051605"><span class="hs-identifier hs-var">mv1</span></a><span class="hs-special">)</span><span>
</span><a name="line-632"></a><span>
</span><a name="line-633"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="System.IO.HVIO.html#PipeWriter"><span class="hs-identifier hs-type">PipeWriter</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-634"></a><span>    </span><a name="local-8214565720323784721"><span class="hs-identifier">show</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&lt;PipeWriter&gt;&quot;</span><span>
</span><a name="line-635"></a><span>
</span><a name="line-636"></a><span class="hs-keyword">instance</span><span> </span><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier hs-type">HVIO</span></a><span> </span><a href="System.IO.HVIO.html#PipeWriter"><span class="hs-identifier hs-type">PipeWriter</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-637"></a><span>    </span><a name="local-8214565720323824381"><a href="System.IO.HVIO.html#vClose"><span class="hs-identifier">vClose</span></a></a><span> </span><a name="local-6989586621679051606"><a href="#local-6989586621679051606"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051607"><a href="#local-6989586621679051607"><span class="hs-identifier">o</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vIsOpen"><span class="hs-identifier hs-var">vIsOpen</span></a><span> </span><a href="#local-6989586621679051606"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-638"></a><span>                  </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679051607"><span class="hs-identifier hs-var">o</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-639"></a><span>                            </span><a name="local-6989586621679051608"><a href="#local-6989586621679051608"><span class="hs-identifier">mv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#pwmv"><span class="hs-identifier hs-var">pwmv</span></a><span> </span><a href="#local-6989586621679051606"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-640"></a><span>                            </span><span class="hs-identifier hs-var">putMVar</span><span> </span><a href="#local-6989586621679051608"><span class="hs-identifier hs-var">mv</span></a><span> </span><a href="System.IO.HVIO.html#PipeEOF"><span class="hs-identifier hs-var">PipeEOF</span></a><span>
</span><a name="line-641"></a><span>                            </span><a href="System.IO.HVIO.html#vioc_close"><span class="hs-identifier hs-var">vioc_close</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#pwv"><span class="hs-identifier hs-var">pwv</span></a><span> </span><a href="#local-6989586621679051606"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-642"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-643"></a><span>    </span><a name="local-8214565720323824382"><a href="System.IO.HVIO.html#vIsOpen"><span class="hs-identifier">vIsOpen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVIO.html#vioc_isopen"><span class="hs-identifier hs-var">vioc_isopen</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="System.IO.HVIO.html#pwv"><span class="hs-identifier hs-var">pwv</span></a><span>
</span><a name="line-644"></a><span>    </span><a name="local-8214565720323824385"><a href="System.IO.HVIO.html#vIsEOF"><span class="hs-identifier">vIsEOF</span></a></a><span> </span><a name="local-6989586621679051609"><a href="#local-6989586621679051609"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="System.IO.HVIO.html#vTestOpen"><span class="hs-identifier hs-var">vTestOpen</span></a><span> </span><a href="#local-6989586621679051609"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-645"></a><span>                  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-646"></a><span>
</span><a name="line-647"></a><span>    </span><span class="hs-comment">-- FIXME: race condition below (could be closed after testing)</span><span>
</span><a name="line-648"></a><span>    </span><a name="local-8214565720323824396"><a href="System.IO.HVIO.html#vPutChar"><span class="hs-identifier">vPutChar</span></a></a><span> </span><a name="local-6989586621679051610"><a href="#local-6989586621679051610"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679051611"><a href="#local-6989586621679051611"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="System.IO.HVIO.html#vTestOpen"><span class="hs-identifier hs-var">vTestOpen</span></a><span> </span><a href="#local-6989586621679051610"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-649"></a><span>                      </span><a name="local-6989586621679051612"><a href="#local-6989586621679051612"><span class="hs-identifier">child</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vioc_get"><span class="hs-identifier hs-var">vioc_get</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#pwv"><span class="hs-identifier hs-var">pwv</span></a><span> </span><a href="#local-6989586621679051610"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-650"></a><span>                      </span><a name="local-6989586621679051613"><a href="#local-6989586621679051613"><span class="hs-identifier">copen</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vIsOpen"><span class="hs-identifier hs-var">vIsOpen</span></a><span> </span><a href="#local-6989586621679051612"><span class="hs-identifier hs-var">child</span></a><span>
</span><a name="line-651"></a><span>                      </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679051613"><span class="hs-identifier hs-var">copen</span></a><span>
</span><a name="line-652"></a><span>                         </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679051614"><a href="#local-6989586621679051614"><span class="hs-identifier">mv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#pwmv"><span class="hs-identifier hs-var">pwmv</span></a><span> </span><a href="#local-6989586621679051610"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-653"></a><span>                                 </span><span class="hs-identifier hs-var">putMVar</span><span> </span><a href="#local-6989586621679051614"><span class="hs-identifier hs-var">mv</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#PipeBit"><span class="hs-identifier hs-var">PipeBit</span></a><span> </span><a href="#local-6989586621679051611"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-654"></a><span>                         </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-string">&quot;PipeWriter: Couldn't write to pipe because child end is closed&quot;</span><span>
</span><a name="line-655"></a><span>    </span><a name="local-8214565720323824401"><a href="System.IO.HVIO.html#vIsWritable"><span class="hs-identifier">vIsWritable</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-656"></a></pre></body></html>