<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
Copyright (c) 2004-2011 John Goerzen &lt;jgoerzen@complete.org&gt;

All rights reserved.

For license and copyright information, see the file LICENSE
-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-comment">{- |
   Module     : System.IO.Utils
   Copyright  : Copyright (C) 2004-2011 John Goerzen
   License    : BSD3

   Maintainer : John Goerzen &lt;jgoerzen@complete.org&gt;
   Stability  : provisional
   Portability: portable
-}</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span><span class="hs-special">(</span><span class="hs-comment">-- * Entire File Handle Utilities</span><span>
</span><a name="line-20"></a><span>                       </span><span class="hs-comment">-- ** Opened Handle Data Copying</span><span>
</span><a name="line-21"></a><span>                       </span><a href="System.IO.Utils.html#hCopy"><span class="hs-identifier hs-var">hCopy</span></a><span class="hs-special">,</span><span> </span><a href="System.IO.Utils.html#hCopyProgress"><span class="hs-identifier hs-var">hCopyProgress</span></a><span class="hs-special">,</span><span> </span><a href="System.IO.Utils.html#hLineCopy"><span class="hs-identifier hs-var">hLineCopy</span></a><span class="hs-special">,</span><span> </span><a href="System.IO.Utils.html#lineCopy"><span class="hs-identifier hs-var">lineCopy</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>                       </span><span class="hs-comment">-- ** Disk File Data Copying</span><span>
</span><a name="line-23"></a><span>                       </span><a href="System.IO.Utils.html#copyFileLinesToFile"><span class="hs-identifier hs-var">copyFileLinesToFile</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>                       </span><span class="hs-comment">-- * Line Processing Utilities</span><span>
</span><a name="line-25"></a><span>                       </span><a href="System.IO.Utils.html#hPutStrLns"><span class="hs-identifier hs-var">hPutStrLns</span></a><span class="hs-special">,</span><span> </span><a href="System.IO.Utils.html#hGetLines"><span class="hs-identifier hs-var">hGetLines</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>                       </span><span class="hs-comment">-- * Lazy Interaction</span><span>
</span><a name="line-27"></a><span>                       </span><span class="hs-comment">-- ** Character-based</span><span>
</span><a name="line-28"></a><span>                       </span><a href="System.IO.Utils.html#hInteract"><span class="hs-identifier hs-var">hInteract</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>                       </span><span class="hs-comment">-- ** Line-based</span><span>
</span><a name="line-30"></a><span>                       </span><a href="System.IO.Utils.html#hLineInteract"><span class="hs-identifier hs-var">hLineInteract</span></a><span class="hs-special">,</span><span> </span><a href="System.IO.Utils.html#lineInteract"><span class="hs-identifier hs-var">lineInteract</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>                       </span><span class="hs-comment">-- ** Misc. Lazy</span><span>
</span><a name="line-32"></a><span>                       </span><a href="System.IO.Utils.html#lazyMapM"><span class="hs-identifier hs-var">lazyMapM</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>                       </span><span class="hs-comment">-- * Optimizations</span><span>
</span><a name="line-34"></a><span>                       </span><a href="System.IO.Utils.html#optimizeForBatch"><span class="hs-identifier hs-var">optimizeForBatch</span></a><span class="hs-special">,</span><span> </span><a href="System.IO.Utils.html#optimizeForInteraction"><span class="hs-identifier hs-var">optimizeForInteraction</span></a><span>
</span><a name="line-35"></a><span>                        </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Unsafe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unsafeInterleaveIO</span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">List</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">genericLength</span><span class="hs-special">)</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="System.IO.HVIO.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">HVIO</span></a><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-comment">{- | Given a list of strings, output a line containing each item, adding
newlines as appropriate.  The list is not expected to have newlines already.
-}</span><span>
</span><a name="line-45"></a><span class="hs-identifier">hPutStrLns</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier hs-type">HVIO</span></a><span> </span><a href="#local-6989586621679056422"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679056422"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><a name="hPutStrLns"><a href="System.IO.Utils.html#hPutStrLns"><span class="hs-identifier">hPutStrLns</span></a></a><span> </span><a name="local-6989586621679056423"><a href="#local-6989586621679056423"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.IO.HVIO.html#vPutStrLn"><span class="hs-identifier hs-var">vPutStrLn</span></a><span> </span><a href="#local-6989586621679056423"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-comment">{- | Given a handle, returns a list of all the lines in that handle.
Thanks to lazy evaluation, this list does not have to be read all at once.

Combined with 'hPutStrLns', this can make a powerful way to develop
filters.  See the 'lineInteract' function for more on that concept.

Example:

&gt; main = do
&gt;        l &lt;- hGetLines stdin
&gt;        hPutStrLns stdout $ filter (startswith &quot;1&quot;) l

-}</span><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span class="hs-comment">-- FIXME: does hGetContents h &gt;&gt;= return . lines not work?</span><span>
</span><a name="line-63"></a><span class="hs-identifier">hGetLines</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier hs-type">HVIO</span></a><span> </span><a href="#local-6989586621679056421"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679056421"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-64"></a><a name="hGetLines"><a href="System.IO.Utils.html#hGetLines"><span class="hs-identifier">hGetLines</span></a></a><span> </span><a name="local-6989586621679056424"><a href="#local-6989586621679056424"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafeInterleaveIO</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><a name="line-65"></a><span>                                  </span><a name="local-6989586621679056438"><a href="#local-6989586621679056438"><span class="hs-identifier">ieof</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vIsEOF"><span class="hs-identifier hs-var">vIsEOF</span></a><span> </span><a href="#local-6989586621679056424"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-66"></a><span>                                  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679056438"><span class="hs-identifier hs-var">ieof</span></a><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>                                     </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-68"></a><span>                                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-69"></a><span>                                          </span><a name="local-6989586621679056439"><a href="#local-6989586621679056439"><span class="hs-identifier">line</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vGetLine"><span class="hs-identifier hs-var">vGetLine</span></a><span> </span><a href="#local-6989586621679056424"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-70"></a><span>                                          </span><a name="local-6989586621679056440"><a href="#local-6989586621679056440"><span class="hs-identifier">remainder</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.Utils.html#hGetLines"><span class="hs-identifier hs-var">hGetLines</span></a><span> </span><a href="#local-6989586621679056424"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-71"></a><span>                                          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679056439"><span class="hs-identifier hs-var">line</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679056440"><span class="hs-identifier hs-var">remainder</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span class="hs-comment">{- | This is similar to the built-in 'System.IO.interact', but works
on any handle, not just stdin and stdout.

In other words:

&gt; interact = hInteract stdin stdout
-}</span><span>
</span><a name="line-81"></a><span class="hs-identifier">hInteract</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier hs-type">HVIO</span></a><span> </span><a href="#local-6989586621679056419"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier hs-type">HVIO</span></a><span> </span><a href="#local-6989586621679056420"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679056419"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679056420"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-82"></a><a name="hInteract"><a href="System.IO.Utils.html#hInteract"><span class="hs-identifier">hInteract</span></a></a><span> </span><a name="local-6989586621679056441"><a href="#local-6989586621679056441"><span class="hs-identifier">finput</span></a></a><span> </span><a name="local-6989586621679056442"><a href="#local-6989586621679056442"><span class="hs-identifier">foutput</span></a></a><span> </span><a name="local-6989586621679056443"><a href="#local-6989586621679056443"><span class="hs-identifier">func</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-83"></a><span>                                </span><a name="local-6989586621679056444"><a href="#local-6989586621679056444"><span class="hs-identifier">content</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vGetContents"><span class="hs-identifier hs-var">vGetContents</span></a><span> </span><a href="#local-6989586621679056441"><span class="hs-identifier hs-var">finput</span></a><span>
</span><a name="line-84"></a><span>                                </span><a href="System.IO.HVIO.html#vPutStr"><span class="hs-identifier hs-var">vPutStr</span></a><span> </span><a href="#local-6989586621679056442"><span class="hs-identifier hs-var">foutput</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679056443"><span class="hs-identifier hs-var">func</span></a><span> </span><a href="#local-6989586621679056444"><span class="hs-identifier hs-var">content</span></a><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-comment">{- | Line-based interaction.  This is similar to wrapping your
interact functions with 'lines' and 'unlines'.  This equality holds:

&gt; lineInteract = hLineInteract stdin stdout

Here's an example:

&gt; main = lineInteract (filter (startswith &quot;1&quot;))

This will act as a simple version of grep -- all lines that start with 1
will be displayed; all others will be ignored.
-}</span><span>
</span><a name="line-98"></a><span class="hs-identifier">lineInteract</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-99"></a><a name="lineInteract"><a href="System.IO.Utils.html#lineInteract"><span class="hs-identifier">lineInteract</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.Utils.html#hLineInteract"><span class="hs-identifier hs-var">hLineInteract</span></a><span> </span><span class="hs-identifier hs-var">stdin</span><span> </span><span class="hs-identifier hs-var">stdout</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span class="hs-comment">{- | Line-based interaction over arbitrary handles.  This is similar
to wrapping hInteract with 'lines' and 'unlines'.

One could view this function like this:

&gt; hLineInteract finput foutput func =
&gt;     let newf = unlines . func . lines in
&gt;         hInteract finput foutput newf

Though the actual implementation is this for efficiency:

&gt; hLineInteract finput foutput func =
&gt;     do
&gt;     lines &lt;- hGetLines finput
&gt;     hPutStrLns foutput (func lines)
-}</span><span>
</span><a name="line-117"></a><span class="hs-identifier">hLineInteract</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier hs-type">HVIO</span></a><span> </span><a href="#local-6989586621679056417"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier hs-type">HVIO</span></a><span> </span><a href="#local-6989586621679056418"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679056417"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679056418"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-118"></a><a name="hLineInteract"><a href="System.IO.Utils.html#hLineInteract"><span class="hs-identifier">hLineInteract</span></a></a><span> </span><a name="local-6989586621679056510"><a href="#local-6989586621679056510"><span class="hs-identifier">finput</span></a></a><span> </span><a name="local-6989586621679056511"><a href="#local-6989586621679056511"><span class="hs-identifier">foutput</span></a></a><span> </span><a name="local-6989586621679056512"><a href="#local-6989586621679056512"><span class="hs-identifier">func</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-119"></a><span>    </span><span class="hs-keyword">do</span><span>
</span><a name="line-120"></a><span>    </span><a name="local-6989586621679056513"><a href="#local-6989586621679056513"><span class="hs-identifier">lines</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.Utils.html#hGetLines"><span class="hs-identifier hs-var">hGetLines</span></a><span> </span><a href="#local-6989586621679056510"><span class="hs-identifier hs-var">finput</span></a><span>
</span><a name="line-121"></a><span>    </span><a href="System.IO.Utils.html#hPutStrLns"><span class="hs-identifier hs-var">hPutStrLns</span></a><span> </span><a href="#local-6989586621679056511"><span class="hs-identifier hs-var">foutput</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679056512"><span class="hs-identifier hs-var">func</span></a><span> </span><a href="#local-6989586621679056513"><span class="hs-identifier hs-var">lines</span></a><span class="hs-special">)</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span class="hs-comment">{- | Copies from one handle to another in raw mode (using
hGetContents).
-}</span><span>
</span><a name="line-126"></a><span class="hs-identifier">hCopy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier hs-type">HVIO</span></a><span> </span><a href="#local-6989586621679056415"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier hs-type">HVIO</span></a><span> </span><a href="#local-6989586621679056416"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679056415"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679056416"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-127"></a><a name="hCopy"><a href="System.IO.Utils.html#hCopy"><span class="hs-identifier">hCopy</span></a></a><span> </span><a name="local-6989586621679056514"><a href="#local-6989586621679056514"><span class="hs-identifier">hin</span></a></a><span> </span><a name="local-6989586621679056515"><a href="#local-6989586621679056515"><span class="hs-identifier">hout</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-128"></a><span>                 </span><a name="local-6989586621679056516"><a href="#local-6989586621679056516"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vGetContents"><span class="hs-identifier hs-var">vGetContents</span></a><span> </span><a href="#local-6989586621679056514"><span class="hs-identifier hs-var">hin</span></a><span>
</span><a name="line-129"></a><span>                 </span><a href="System.IO.HVIO.html#vPutStr"><span class="hs-identifier hs-var">vPutStr</span></a><span> </span><a href="#local-6989586621679056515"><span class="hs-identifier hs-var">hout</span></a><span> </span><a href="#local-6989586621679056516"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-comment">{- | Copies from one handle to another in raw mode (using hGetContents).
Takes a function to provide progress updates to the user.
-}</span><span>
</span><a name="line-134"></a><span class="hs-identifier">hCopyProgress</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier hs-type">HVIO</span></a><span> </span><a href="#local-6989586621679056412"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier hs-type">HVIO</span></a><span> </span><a href="#local-6989586621679056413"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Integral</span><span> </span><a href="#local-6989586621679056414"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-135"></a><span>                    </span><a href="#local-6989586621679056412"><span class="hs-identifier hs-type">b</span></a><span>        </span><span class="hs-comment">-- ^ Input handle</span><span>
</span><a name="line-136"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679056413"><span class="hs-identifier hs-type">c</span></a><span>              </span><span class="hs-comment">-- ^ Output handle</span><span>
</span><a name="line-137"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679056414"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Progress function -- the bool is always False unless this is the final call</span><span>
</span><a name="line-138"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>                 </span><span class="hs-comment">-- Block size</span><span>
</span><a name="line-139"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679056414"><span class="hs-identifier hs-type">a</span></a><span>             </span><span class="hs-comment">-- Estimated file size (passed to func)</span><span>
</span><a name="line-140"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>                </span><span class="hs-comment">-- Number of bytes copied</span><span>
</span><a name="line-141"></a><a name="hCopyProgress"><a href="System.IO.Utils.html#hCopyProgress"><span class="hs-identifier">hCopyProgress</span></a></a><span> </span><a name="local-6989586621679056517"><a href="#local-6989586621679056517"><span class="hs-identifier">hin</span></a></a><span> </span><a name="local-6989586621679056518"><a href="#local-6989586621679056518"><span class="hs-identifier">hout</span></a></a><span> </span><a name="local-6989586621679056519"><a href="#local-6989586621679056519"><span class="hs-identifier">func</span></a></a><span> </span><a name="local-6989586621679056520"><a href="#local-6989586621679056520"><span class="hs-identifier">bsize</span></a></a><span> </span><a name="local-6989586621679056521"><a href="#local-6989586621679056521"><span class="hs-identifier">estsize</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-142"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">copyFunc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-143"></a><span>        </span><a name="local-6989586621679056522"><a href="#local-6989586621679056522"><span class="hs-identifier">copyFunc</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679056523"><a href="#local-6989586621679056523"><span class="hs-identifier">count</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679056523"><span class="hs-identifier hs-var">count</span></a><span>
</span><a name="line-144"></a><span>        </span><span class="hs-identifier">copyFunc</span><span> </span><a name="local-6989586621679056524"><a href="#local-6989586621679056524"><span class="hs-identifier">indata</span></a></a><span> </span><a name="local-6989586621679056525"><a href="#local-6989586621679056525"><span class="hs-identifier">count</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-145"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679056526"><a href="#local-6989586621679056526"><span class="hs-identifier">block</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621679056520"><span class="hs-identifier hs-var">bsize</span></a><span> </span><a href="#local-6989586621679056524"><span class="hs-identifier hs-var">indata</span></a><span>
</span><a name="line-146"></a><span>                </span><a name="local-6989586621679056527"><a href="#local-6989586621679056527"><span class="hs-identifier">remainder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">drop</span><span> </span><a href="#local-6989586621679056520"><span class="hs-identifier hs-var">bsize</span></a><span> </span><a href="#local-6989586621679056524"><span class="hs-identifier hs-var">indata</span></a><span>
</span><a name="line-147"></a><span>                </span><a name="local-6989586621679056528"><a href="#local-6989586621679056528"><span class="hs-identifier">newcount</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679056525"><span class="hs-identifier hs-var">count</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">genericLength</span><span> </span><a href="#local-6989586621679056526"><span class="hs-identifier hs-var">block</span></a><span class="hs-special">)</span><span>
</span><a name="line-148"></a><span>                </span><span class="hs-keyword">in</span><span>
</span><a name="line-149"></a><span>                </span><span class="hs-keyword">do</span><span>
</span><a name="line-150"></a><span>                </span><a href="System.IO.HVIO.html#vPutStr"><span class="hs-identifier hs-var">vPutStr</span></a><span> </span><a href="#local-6989586621679056518"><span class="hs-identifier hs-var">hout</span></a><span> </span><a href="#local-6989586621679056526"><span class="hs-identifier hs-var">block</span></a><span>
</span><a name="line-151"></a><span>                </span><a href="#local-6989586621679056519"><span class="hs-identifier hs-var">func</span></a><span> </span><a href="#local-6989586621679056521"><span class="hs-identifier hs-var">estsize</span></a><span> </span><a href="#local-6989586621679056525"><span class="hs-identifier hs-var">count</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-152"></a><span>                </span><a href="#local-6989586621679056522"><span class="hs-identifier hs-var">copyFunc</span></a><span> </span><a href="#local-6989586621679056527"><span class="hs-identifier hs-var">remainder</span></a><span> </span><a href="#local-6989586621679056528"><span class="hs-identifier hs-var">newcount</span></a><span>
</span><a name="line-153"></a><span>        </span><span class="hs-keyword">in</span><span>
</span><a name="line-154"></a><span>        </span><span class="hs-keyword">do</span><span>
</span><a name="line-155"></a><span>        </span><a name="local-6989586621679056529"><a href="#local-6989586621679056529"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVIO.html#vGetContents"><span class="hs-identifier hs-var">vGetContents</span></a><span> </span><a href="#local-6989586621679056517"><span class="hs-identifier hs-var">hin</span></a><span>
</span><a name="line-156"></a><span>        </span><a name="local-6989586621679056530"><a href="#local-6989586621679056530"><span class="hs-identifier">bytes</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679056522"><span class="hs-identifier hs-var">copyFunc</span></a><span> </span><a href="#local-6989586621679056529"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-157"></a><span>        </span><a href="#local-6989586621679056519"><span class="hs-identifier hs-var">func</span></a><span> </span><a href="#local-6989586621679056521"><span class="hs-identifier hs-var">estsize</span></a><span> </span><a href="#local-6989586621679056530"><span class="hs-identifier hs-var">bytes</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-158"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679056530"><span class="hs-identifier hs-var">bytes</span></a><span>
</span><a name="line-159"></a><span>
</span><a name="line-160"></a><span class="hs-comment">{- | Copies from one handle to another in text mode (with lines).
Like 'hBlockCopy', this implementation is nice:

&gt; hLineCopy hin hout = hLineInteract hin hout id
-}</span><span>
</span><a name="line-165"></a><span class="hs-identifier">hLineCopy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier hs-type">HVIO</span></a><span> </span><a href="#local-6989586621679056410"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="System.IO.HVIO.html#HVIO"><span class="hs-identifier hs-type">HVIO</span></a><span> </span><a href="#local-6989586621679056411"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679056410"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679056411"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-166"></a><a name="hLineCopy"><a href="System.IO.Utils.html#hLineCopy"><span class="hs-identifier">hLineCopy</span></a></a><span> </span><a name="local-6989586621679056531"><a href="#local-6989586621679056531"><span class="hs-identifier">hin</span></a></a><span> </span><a name="local-6989586621679056532"><a href="#local-6989586621679056532"><span class="hs-identifier">hout</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.Utils.html#hLineInteract"><span class="hs-identifier hs-var">hLineInteract</span></a><span> </span><a href="#local-6989586621679056531"><span class="hs-identifier hs-var">hin</span></a><span> </span><a href="#local-6989586621679056532"><span class="hs-identifier hs-var">hout</span></a><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-comment">{- | Copies from 'stdin' to 'stdout' using lines.  An alias for 'hLineCopy'
over 'stdin' and 'stdout'. -}</span><span>
</span><a name="line-170"></a><span class="hs-identifier">lineCopy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-171"></a><a name="lineCopy"><a href="System.IO.Utils.html#lineCopy"><span class="hs-identifier">lineCopy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.Utils.html#hLineCopy"><span class="hs-identifier hs-var">hLineCopy</span></a><span> </span><span class="hs-identifier hs-var">stdin</span><span> </span><span class="hs-identifier hs-var">stdout</span><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-comment">{- | Copies one filename to another in text mode.

Please note that the Unix permission bits are set at a default; you may
need to adjust them after the copy yourself.

This function is implemented using 'hLineCopy' internally. -}</span><span>
</span><a name="line-179"></a><span class="hs-identifier">copyFileLinesToFile</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-180"></a><a name="copyFileLinesToFile"><a href="System.IO.Utils.html#copyFileLinesToFile"><span class="hs-identifier">copyFileLinesToFile</span></a></a><span> </span><a name="local-6989586621679056533"><a href="#local-6989586621679056533"><span class="hs-identifier">infn</span></a></a><span> </span><a name="local-6989586621679056534"><a href="#local-6989586621679056534"><span class="hs-identifier">outfn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-181"></a><span>                                 </span><a name="local-6989586621679056733"><a href="#local-6989586621679056733"><span class="hs-identifier">hin</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">openFile</span><span> </span><a href="#local-6989586621679056533"><span class="hs-identifier hs-var">infn</span></a><span> </span><span class="hs-identifier hs-var">ReadMode</span><span>
</span><a name="line-182"></a><span>                                 </span><a name="local-6989586621679056734"><a href="#local-6989586621679056734"><span class="hs-identifier">hout</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">openFile</span><span> </span><a href="#local-6989586621679056534"><span class="hs-identifier hs-var">outfn</span></a><span> </span><span class="hs-identifier hs-var">WriteMode</span><span>
</span><a name="line-183"></a><span>                                 </span><a href="System.IO.Utils.html#hLineCopy"><span class="hs-identifier hs-var">hLineCopy</span></a><span> </span><a href="#local-6989586621679056733"><span class="hs-identifier hs-var">hin</span></a><span> </span><a href="#local-6989586621679056734"><span class="hs-identifier hs-var">hout</span></a><span>
</span><a name="line-184"></a><span>                                 </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679056733"><span class="hs-identifier hs-var">hin</span></a><span>
</span><a name="line-185"></a><span>                                 </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679056734"><span class="hs-identifier hs-var">hout</span></a><span>
</span><a name="line-186"></a><span>                                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span class="hs-comment">{- | Sets stdin and stdout to be block-buffered.  This can save a huge amount
of system resources since far fewer syscalls are made, and can make programs
run much faster. -}</span><span>
</span><a name="line-191"></a><span class="hs-identifier">optimizeForBatch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-192"></a><a name="optimizeForBatch"><a href="System.IO.Utils.html#optimizeForBatch"><span class="hs-identifier">optimizeForBatch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-193"></a><span>                   </span><span class="hs-identifier hs-var">hSetBuffering</span><span> </span><span class="hs-identifier hs-var">stdin</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BlockBuffering</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-number">4096</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-194"></a><span>                   </span><span class="hs-identifier hs-var">hSetBuffering</span><span> </span><span class="hs-identifier hs-var">stdout</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BlockBuffering</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-number">4096</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>
</span><a name="line-196"></a><span class="hs-comment">{- | Sets stdin and stdout to be line-buffered.  This saves resources
on stdout, but not many on stdin, since it it still looking for newlines. -}</span><span>
</span><a name="line-198"></a><span class="hs-identifier">optimizeForInteraction</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-199"></a><a name="optimizeForInteraction"><a href="System.IO.Utils.html#optimizeForInteraction"><span class="hs-identifier">optimizeForInteraction</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-200"></a><span>                         </span><span class="hs-identifier hs-var">hSetBuffering</span><span> </span><span class="hs-identifier hs-var">stdin</span><span> </span><span class="hs-identifier hs-var">LineBuffering</span><span>
</span><a name="line-201"></a><span>                         </span><span class="hs-identifier hs-var">hSetBuffering</span><span> </span><span class="hs-identifier hs-var">stdout</span><span> </span><span class="hs-identifier hs-var">LineBuffering</span><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span class="hs-comment">{- | Applies a given function to every item in a list, and returns
the new list.  Unlike the system\'s mapM, items are evaluated lazily. -}</span><span>
</span><a name="line-205"></a><span class="hs-identifier">lazyMapM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679056408"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679056409"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679056408"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679056409"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-206"></a><a name="lazyMapM"><a href="System.IO.Utils.html#lazyMapM"><span class="hs-identifier">lazyMapM</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-207"></a><span class="hs-identifier">lazyMapM</span><span> </span><a name="local-6989586621679056735"><a href="#local-6989586621679056735"><span class="hs-identifier">conv</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679056736"><a href="#local-6989586621679056736"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679056737"><a href="#local-6989586621679056737"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-208"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679056738"><a href="#local-6989586621679056738"><span class="hs-identifier">this</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679056735"><span class="hs-identifier hs-var">conv</span></a><span> </span><a href="#local-6989586621679056736"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-209"></a><span>       </span><a name="local-6989586621679056739"><a href="#local-6989586621679056739"><span class="hs-identifier">next</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">unsafeInterleaveIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.IO.Utils.html#lazyMapM"><span class="hs-identifier hs-var">lazyMapM</span></a><span> </span><a href="#local-6989586621679056735"><span class="hs-identifier hs-var">conv</span></a><span> </span><a href="#local-6989586621679056737"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-210"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679056738"><span class="hs-identifier hs-var">this</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679056739"><span class="hs-identifier hs-var">next</span></a><span class="hs-special">)</span><span>
</span><a name="line-211"></a></pre></body></html>