<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- arch-tag: Command utilities main file</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-3"></a><span class="hs-comment">{-
Copyright (c) 2004-2011 John Goerzen &lt;jgoerzen@complete.org&gt;

All rights reserved.

For license and copyright information, see the file LICENSE
-}</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-comment">{- |
   Module     : System.Cmd.Utils
   Copyright  : Copyright (C) 2004-2011 John Goerzen
   License    : BSD3

   Maintainer : John Goerzen &lt;jgoerzen@complete.org&gt;
   Stability  : provisional
   Portability: portable to platforms with POSIX process\/signal tools

Command invocation utilities.

Written by John Goerzen, jgoerzen\@complete.org

Please note: Most of this module is not compatible with Hugs.

Command lines executed will be logged using &quot;System.Log.Logger&quot; at the
DEBUG level.  Failure messages will be logged at the WARNING level in addition
to being raised as an exception.  Both are logged under
\&quot;System.Cmd.Utils.funcname\&quot; -- for instance,
\&quot;System.Cmd.Utils.safeSystem\&quot;.  If you wish to suppress these messages
globally, you can simply run:

&gt; updateGlobalLogger &quot;System.Cmd.Utils.safeSystem&quot;
&gt;                     (setLevel CRITICAL)

See also: 'System.Log.Logger.updateGlobalLogger',
&quot;System.Log.Logger&quot;.

It is possible to set up pipelines with these utilities.  Example:

&gt; (pid1, x1) &lt;- pipeFrom &quot;ls&quot; [&quot;/etc&quot;]
&gt; (pid2, x2) &lt;- pipeBoth &quot;grep&quot; [&quot;x&quot;] x1
&gt; putStr x2
&gt; ... the grep output is displayed ...
&gt; forceSuccess pid2
&gt; forceSuccess pid1

Remember, when you use the functions that return a String, you must not call
'forceSuccess' until after all data from the String has been consumed.  Failure
to wait will cause your program to appear to hang.

Here is an example of the wrong way to do it:

&gt; (pid, x) &lt;- pipeFrom &quot;ls&quot; [&quot;/etc&quot;]
&gt; forceSuccess pid         -- Hangs; the called program hasn't terminated yet
&gt; processTheData x

You must instead process the data before calling 'forceSuccess'.

When using the hPipe family of functions, this is probably more obvious.

Most of this module will be incompatible with Windows.
-}</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Cmd</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span><span class="hs-special">(</span><span class="hs-comment">-- * High-Level Tools</span><span>
</span><a name="line-67"></a><span>                    </span><a href="System.Cmd.Utils.html#PipeHandle"><span class="hs-identifier hs-type">PipeHandle</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-68"></a><span>                    </span><a href="System.Cmd.Utils.html#safeSystem"><span class="hs-identifier hs-var">safeSystem</span></a><span class="hs-special">,</span><span>
</span><a name="line-69"></a><span class="hs-cpp">#if !(defined(mingw32_HOST_OS) || defined(mingw32_TARGET_OS) || defined(__MINGW32__))</span><span>
</span><a name="line-70"></a><span>                    </span><a href="System.Cmd.Utils.html#forceSuccess"><span class="hs-identifier hs-var">forceSuccess</span></a><span class="hs-special">,</span><span>
</span><a name="line-71"></a><span class="hs-cpp">#ifndef __HUGS__</span><span>
</span><a name="line-72"></a><span>                    </span><a href="System.Cmd.Utils.html#posixRawSystem"><span class="hs-identifier hs-var">posixRawSystem</span></a><span class="hs-special">,</span><span>
</span><a name="line-73"></a><span>                    </span><a href="System.Cmd.Utils.html#forkRawSystem"><span class="hs-identifier hs-var">forkRawSystem</span></a><span class="hs-special">,</span><span>
</span><a name="line-74"></a><span>                    </span><span class="hs-comment">-- ** Piping with lazy strings</span><span>
</span><a name="line-75"></a><span>                    </span><a href="System.Cmd.Utils.html#pipeFrom"><span class="hs-identifier hs-var">pipeFrom</span></a><span class="hs-special">,</span><span>
</span><a name="line-76"></a><span>                    </span><a href="System.Cmd.Utils.html#pipeLinesFrom"><span class="hs-identifier hs-var">pipeLinesFrom</span></a><span class="hs-special">,</span><span>
</span><a name="line-77"></a><span>                    </span><a href="System.Cmd.Utils.html#pipeTo"><span class="hs-identifier hs-var">pipeTo</span></a><span class="hs-special">,</span><span>
</span><a name="line-78"></a><span>                    </span><a href="System.Cmd.Utils.html#pipeBoth"><span class="hs-identifier hs-var">pipeBoth</span></a><span class="hs-special">,</span><span>
</span><a name="line-79"></a><span>                    </span><span class="hs-comment">-- ** Piping with handles</span><span>
</span><a name="line-80"></a><span>                    </span><a href="System.Cmd.Utils.html#hPipeFrom"><span class="hs-identifier hs-var">hPipeFrom</span></a><span class="hs-special">,</span><span>
</span><a name="line-81"></a><span>                    </span><a href="System.Cmd.Utils.html#hPipeTo"><span class="hs-identifier hs-var">hPipeTo</span></a><span class="hs-special">,</span><span>
</span><a name="line-82"></a><span>                    </span><a href="System.Cmd.Utils.html#hPipeBoth"><span class="hs-identifier hs-var">hPipeBoth</span></a><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-84"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-85"></a><span>                    </span><span class="hs-comment">-- * Low-Level Tools</span><span>
</span><a name="line-86"></a><span>                    </span><a href="System.Cmd.Utils.html#PipeMode"><span class="hs-identifier hs-type">PipeMode</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-87"></a><span class="hs-cpp">#if !(defined(mingw32_HOST_OS) || defined(mingw32_TARGET_OS) || defined(__MINGW32__))</span><span>
</span><a name="line-88"></a><span class="hs-cpp">#ifndef __HUGS__</span><span>
</span><a name="line-89"></a><span>                    </span><a href="System.Cmd.Utils.html#pOpen"><span class="hs-identifier hs-var">pOpen</span></a><span class="hs-special">,</span><span> </span><a href="System.Cmd.Utils.html#pOpen3"><span class="hs-identifier hs-var">pOpen3</span></a><span class="hs-special">,</span><span> </span><a href="System.Cmd.Utils.html#pOpen3Raw"><span class="hs-identifier hs-var">pOpen3Raw</span></a><span>
</span><a name="line-90"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-91"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-92"></a><span>                   </span><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span class="hs-keyword">where</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- FIXME - largely obsoleted by 6.4 - convert to wrappers.</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Exit</span><span>
</span><a name="line-98"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Process</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">rawSystem</span><span class="hs-special">)</span><span>
</span><a name="line-99"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Log</span><span class="hs-operator">.</span><span class="hs-identifier">Logger</span><span>
</span><a name="line-100"></a><span class="hs-cpp">#if !(defined(mingw32_HOST_OS) || defined(mingw32_TARGET_OS) || defined(__MINGW32__))</span><span>
</span><a name="line-101"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Posix</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span>
</span><a name="line-102"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Posix</span><span class="hs-operator">.</span><span class="hs-identifier">Process</span><span>
</span><a name="line-103"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Posix</span><span class="hs-operator">.</span><span class="hs-identifier">Signals</span><span>
</span><a name="line-104"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Posix</span><span class="hs-operator">.</span><span class="hs-identifier">Signals</span><span>
</span><a name="line-105"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-106"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Posix</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span>
</span><a name="line-107"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span>
</span><a name="line-108"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Error</span><span>
</span><a name="line-109"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Concurrent</span><span class="hs-special">(</span><span class="hs-identifier hs-var">forkIO</span><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Exception</span><span class="hs-special">(</span><span class="hs-identifier hs-var">finally</span><span class="hs-special">)</span><span>
</span><a name="line-111"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Exception</span><span class="hs-special">(</span><span class="hs-identifier hs-var">try</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IOException</span><span class="hs-special">)</span><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span class="hs-keyword">data</span><span> </span><a name="PipeMode"><a href="System.Cmd.Utils.html#PipeMode"><span class="hs-identifier">PipeMode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ReadFromPipe"><a href="System.Cmd.Utils.html#ReadFromPipe"><span class="hs-identifier">ReadFromPipe</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="WriteToPipe"><a href="System.Cmd.Utils.html#WriteToPipe"><span class="hs-identifier">WriteToPipe</span></a></a><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-identifier">logbase</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-116"></a><a name="logbase"><a href="System.Cmd.Utils.html#logbase"><span class="hs-identifier">logbase</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;System.Cmd.Utils&quot;</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span class="hs-comment">{- | Return value from 'pipeFrom', 'pipeLinesFrom', 'pipeTo', or
'pipeBoth'.  Contains both a ProcessID and the original command that was
executed.  If you prefer not to use 'forceSuccess' on the result of one
of these pipe calls, you can use (processID ph), assuming ph is your 'PipeHandle',
as a parameter to 'System.Posix.Process.getProcessStatus'. -}</span><span>
</span><a name="line-123"></a><span class="hs-keyword">data</span><span> </span><a name="PipeHandle"><a href="System.Cmd.Utils.html#PipeHandle"><span class="hs-identifier">PipeHandle</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-124"></a><span>    </span><a name="PipeHandle"><a href="System.Cmd.Utils.html#PipeHandle"><span class="hs-identifier">PipeHandle</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="processID"><a href="System.Cmd.Utils.html#processID"><span class="hs-identifier">processID</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ProcessID</span><span class="hs-special">,</span><span>
</span><a name="line-125"></a><span>                 </span><a name="phCommand"><a href="System.Cmd.Utils.html#phCommand"><span class="hs-identifier">phCommand</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span>
</span><a name="line-126"></a><span>                 </span><a name="phArgs"><a href="System.Cmd.Utils.html#phArgs"><span class="hs-identifier">phArgs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-127"></a><span>                 </span><a name="phCreator"><a href="System.Cmd.Utils.html#phCreator"><span class="hs-identifier">phCreator</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^ Function that created it</span><span>
</span><a name="line-128"></a><span>               </span><span class="hs-special">}</span><span>
</span><a name="line-129"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-cpp">#if !(defined(mingw32_HOST_OS) || defined(mingw32_TARGET_OS) || defined(__MINGW32__))</span><span>
</span><a name="line-132"></a><span class="hs-cpp">#ifndef __HUGS__</span><span>
</span><a name="line-133"></a><span class="hs-comment">{- | Like 'pipeFrom', but returns data in lines instead of just a String.
Shortcut for calling lines on the result from 'pipeFrom'.

Note: this function logs as pipeFrom.

Not available on Windows. -}</span><span>
</span><a name="line-139"></a><span class="hs-identifier">pipeLinesFrom</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#PipeHandle"><span class="hs-identifier hs-type">PipeHandle</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-140"></a><a name="pipeLinesFrom"><a href="System.Cmd.Utils.html#pipeLinesFrom"><span class="hs-identifier">pipeLinesFrom</span></a></a><span> </span><a name="local-6989586621679067518"><a href="#local-6989586621679067518"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679067519"><a href="#local-6989586621679067519"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-141"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679067520"><a href="#local-6989586621679067520"><span class="hs-identifier">pid</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679067521"><a href="#local-6989586621679067521"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Cmd.Utils.html#pipeFrom"><span class="hs-identifier hs-var">pipeFrom</span></a><span> </span><a href="#local-6989586621679067518"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679067519"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-142"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679067520"><span class="hs-identifier hs-var">pid</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">lines</span><span> </span><a href="#local-6989586621679067521"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-143"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-144"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-identifier">logRunning</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-147"></a><a name="logRunning"><a href="System.Cmd.Utils.html#logRunning"><span class="hs-identifier">logRunning</span></a></a><span> </span><a name="local-6989586621679067522"><a href="#local-6989586621679067522"><span class="hs-identifier">func</span></a></a><span> </span><a name="local-6989586621679067523"><a href="#local-6989586621679067523"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679067524"><a href="#local-6989586621679067524"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">debugM</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#logbase"><span class="hs-identifier hs-var">logbase</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679067522"><span class="hs-identifier hs-var">func</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#showCmd"><span class="hs-identifier hs-var">showCmd</span></a><span> </span><a href="#local-6989586621679067523"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679067524"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span class="hs-identifier">warnFail</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Char</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Char</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679067517"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-150"></a><a name="warnFail"><a href="System.Cmd.Utils.html#warnFail"><span class="hs-identifier">warnFail</span></a></a><span> </span><a name="local-6989586621679067525"><a href="#local-6989586621679067525"><span class="hs-identifier">funcname</span></a></a><span> </span><a name="local-6989586621679067526"><a href="#local-6989586621679067526"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679067527"><a href="#local-6989586621679067527"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679067528"><a href="#local-6989586621679067528"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-151"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067529"><a href="#local-6989586621679067529"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Cmd.Utils.html#showCmd"><span class="hs-identifier hs-var">showCmd</span></a><span> </span><a href="#local-6989586621679067526"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679067527"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679067528"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-152"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">warningM</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#logbase"><span class="hs-identifier hs-var">logbase</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679067525"><span class="hs-identifier hs-var">funcname</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679067529"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-153"></a><span>              </span><span class="hs-identifier hs-var">fail</span><span> </span><a href="#local-6989586621679067529"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span class="hs-cpp">#if !(defined(mingw32_HOST_OS) || defined(mingw32_TARGET_OS) || defined(__MINGW32__))</span><span>
</span><a name="line-156"></a><span class="hs-cpp">#ifndef __HUGS__</span><span>
</span><a name="line-157"></a><span class="hs-comment">{- | Read data from a pipe.  Returns a Handle and a 'PipeHandle'.

When done, you must hClose the handle, and then use either 'forceSuccess' or
getProcessStatus on the 'PipeHandle'.  Zombies will result otherwise.

This function logs as pipeFrom.

Not available on Windows or with Hugs.
-}</span><span>
</span><a name="line-166"></a><span class="hs-identifier">hPipeFrom</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#PipeHandle"><span class="hs-identifier hs-type">PipeHandle</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">)</span><span>
</span><a name="line-167"></a><a name="hPipeFrom"><a href="System.Cmd.Utils.html#hPipeFrom"><span class="hs-identifier">hPipeFrom</span></a></a><span> </span><a name="local-6989586621679067530"><a href="#local-6989586621679067530"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679067531"><a href="#local-6989586621679067531"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-168"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679067532"><a href="#local-6989586621679067532"><span class="hs-identifier">pipepair</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">createPipe</span><span>
</span><a name="line-169"></a><span>       </span><a href="System.Cmd.Utils.html#logRunning"><span class="hs-identifier hs-var">logRunning</span></a><span> </span><span class="hs-string">&quot;pipeFrom&quot;</span><span> </span><a href="#local-6989586621679067530"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679067531"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-170"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067533"><a href="#local-6989586621679067533"><span class="hs-identifier">childstuff</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">dupTo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679067532"><span class="hs-identifier hs-var">pipepair</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">stdOutput</span><span>
</span><a name="line-171"></a><span>                           </span><span class="hs-identifier hs-var">closeFd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679067532"><span class="hs-identifier hs-var">pipepair</span></a><span class="hs-special">)</span><span>
</span><a name="line-172"></a><span>                           </span><span class="hs-identifier hs-var">executeFile</span><span> </span><a href="#local-6989586621679067530"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679067531"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-173"></a><span>       </span><a name="local-6989586621679067534"><a href="#local-6989586621679067534"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Control</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Exception</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">try</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">forkProcess</span><span> </span><a href="#local-6989586621679067533"><span class="hs-identifier hs-var">childstuff</span></a><span class="hs-special">)</span><span>
</span><a name="line-174"></a><span>       </span><span class="hs-comment">-- parent</span><span>
</span><a name="line-175"></a><span>       </span><a name="local-6989586621679067653"><a href="#local-6989586621679067653"><span class="hs-identifier">pid</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679067534"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-176"></a><span>                  </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679067651"><a href="#local-6989586621679067651"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679067651"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-177"></a><span>                  </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679067652"><a href="#local-6989586621679067652"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Control</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Exception</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">IOException</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Cmd.Utils.html#warnFail"><span class="hs-identifier hs-var">warnFail</span></a><span> </span><span class="hs-string">&quot;pipeFrom&quot;</span><span> </span><a href="#local-6989586621679067530"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679067531"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-178"></a><span>                            </span><span class="hs-string">&quot;Error in fork: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679067652"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-179"></a><span>       </span><span class="hs-identifier hs-var">closeFd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679067532"><span class="hs-identifier hs-var">pipepair</span></a><span class="hs-special">)</span><span>
</span><a name="line-180"></a><span>       </span><a name="local-6989586621679067654"><a href="#local-6989586621679067654"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fdToHandle</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679067532"><span class="hs-identifier hs-var">pipepair</span></a><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#PipeHandle"><span class="hs-identifier hs-var">PipeHandle</span></a><span> </span><a href="#local-6989586621679067653"><span class="hs-identifier hs-var">pid</span></a><span> </span><a href="#local-6989586621679067530"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679067531"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-string">&quot;pipeFrom&quot;</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679067654"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-182"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-183"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span class="hs-cpp">#if !(defined(mingw32_HOST_OS) || defined(mingw32_TARGET_OS) || defined(__MINGW32__))</span><span>
</span><a name="line-186"></a><span class="hs-cpp">#ifndef __HUGS__</span><span>
</span><a name="line-187"></a><span class="hs-comment">{- | Read data from a pipe.  Returns a lazy string and a 'PipeHandle'.

ONLY AFTER the string has been read completely, You must call either
'System.Posix.Process.getProcessStatus' or 'forceSuccess' on the 'PipeHandle'.
Zombies will result otherwise.

Not available on Windows.
-}</span><span>
</span><a name="line-195"></a><span class="hs-identifier">pipeFrom</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#PipeHandle"><span class="hs-identifier hs-type">PipeHandle</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-196"></a><a name="pipeFrom"><a href="System.Cmd.Utils.html#pipeFrom"><span class="hs-identifier">pipeFrom</span></a></a><span> </span><a name="local-6989586621679067655"><a href="#local-6989586621679067655"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679067656"><a href="#local-6989586621679067656"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-197"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679067657"><a href="#local-6989586621679067657"><span class="hs-identifier">pid</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679067658"><a href="#local-6989586621679067658"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Cmd.Utils.html#hPipeFrom"><span class="hs-identifier hs-var">hPipeFrom</span></a><span> </span><a href="#local-6989586621679067655"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679067656"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-198"></a><span>       </span><a name="local-6989586621679067659"><a href="#local-6989586621679067659"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">hGetContents</span><span> </span><a href="#local-6989586621679067658"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-199"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679067657"><span class="hs-identifier hs-var">pid</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679067659"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-200"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-201"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span class="hs-cpp">#if !(defined(mingw32_HOST_OS) || defined(mingw32_TARGET_OS) || defined(__MINGW32__))</span><span>
</span><a name="line-204"></a><span class="hs-cpp">#ifndef __HUGS__</span><span>
</span><a name="line-205"></a><span class="hs-comment">{- | Write data to a pipe.  Returns a 'PipeHandle' and a new Handle to write
to.

When done, you must hClose the handle, and then use either 'forceSuccess' or
getProcessStatus on the 'PipeHandle'.  Zombies will result otherwise.

This function logs as pipeTo.

Not available on Windows.
-}</span><span>
</span><a name="line-215"></a><span class="hs-identifier">hPipeTo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#PipeHandle"><span class="hs-identifier hs-type">PipeHandle</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">)</span><span>
</span><a name="line-216"></a><a name="hPipeTo"><a href="System.Cmd.Utils.html#hPipeTo"><span class="hs-identifier">hPipeTo</span></a></a><span> </span><a name="local-6989586621679067660"><a href="#local-6989586621679067660"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679067661"><a href="#local-6989586621679067661"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-217"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679067662"><a href="#local-6989586621679067662"><span class="hs-identifier">pipepair</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">createPipe</span><span>
</span><a name="line-218"></a><span>       </span><a href="System.Cmd.Utils.html#logRunning"><span class="hs-identifier hs-var">logRunning</span></a><span> </span><span class="hs-string">&quot;pipeTo&quot;</span><span> </span><a href="#local-6989586621679067660"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679067661"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-219"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067663"><a href="#local-6989586621679067663"><span class="hs-identifier">childstuff</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">dupTo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679067662"><span class="hs-identifier hs-var">pipepair</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">stdInput</span><span>
</span><a name="line-220"></a><span>                           </span><span class="hs-identifier hs-var">closeFd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679067662"><span class="hs-identifier hs-var">pipepair</span></a><span class="hs-special">)</span><span>
</span><a name="line-221"></a><span>                           </span><span class="hs-identifier hs-var">executeFile</span><span> </span><a href="#local-6989586621679067660"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679067661"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-222"></a><span>       </span><a name="local-6989586621679067664"><a href="#local-6989586621679067664"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Control</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Exception</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">try</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">forkProcess</span><span> </span><a href="#local-6989586621679067663"><span class="hs-identifier hs-var">childstuff</span></a><span class="hs-special">)</span><span>
</span><a name="line-223"></a><span>       </span><span class="hs-comment">-- parent</span><span>
</span><a name="line-224"></a><span>       </span><a name="local-6989586621679067667"><a href="#local-6989586621679067667"><span class="hs-identifier">pid</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679067664"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-225"></a><span>                   </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679067665"><a href="#local-6989586621679067665"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679067665"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-226"></a><span>                   </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679067666"><a href="#local-6989586621679067666"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Control</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Exception</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">IOException</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Cmd.Utils.html#warnFail"><span class="hs-identifier hs-var">warnFail</span></a><span> </span><span class="hs-string">&quot;pipeTo&quot;</span><span> </span><a href="#local-6989586621679067660"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679067661"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-227"></a><span>                             </span><span class="hs-string">&quot;Error in fork: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679067666"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-228"></a><span>       </span><span class="hs-identifier hs-var">closeFd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679067662"><span class="hs-identifier hs-var">pipepair</span></a><span class="hs-special">)</span><span>
</span><a name="line-229"></a><span>       </span><a name="local-6989586621679067668"><a href="#local-6989586621679067668"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fdToHandle</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679067662"><span class="hs-identifier hs-var">pipepair</span></a><span class="hs-special">)</span><span>
</span><a name="line-230"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#PipeHandle"><span class="hs-identifier hs-var">PipeHandle</span></a><span> </span><a href="#local-6989586621679067667"><span class="hs-identifier hs-var">pid</span></a><span> </span><a href="#local-6989586621679067660"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679067661"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-string">&quot;pipeTo&quot;</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679067668"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-231"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-232"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span class="hs-cpp">#if !(defined(mingw32_HOST_OS) || defined(mingw32_TARGET_OS) || defined(__MINGW32__))</span><span>
</span><a name="line-235"></a><span class="hs-cpp">#ifndef __HUGS__</span><span>
</span><a name="line-236"></a><span class="hs-comment">{- | Write data to a pipe.  Returns a ProcessID.

You must call either
'System.Posix.Process.getProcessStatus' or 'forceSuccess' on the ProcessID.
Zombies will result otherwise.

Not available on Windows.
-}</span><span>
</span><a name="line-244"></a><span class="hs-identifier">pipeTo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="System.Cmd.Utils.html#PipeHandle"><span class="hs-identifier hs-type">PipeHandle</span></a><span>
</span><a name="line-245"></a><a name="pipeTo"><a href="System.Cmd.Utils.html#pipeTo"><span class="hs-identifier">pipeTo</span></a></a><span> </span><a name="local-6989586621679067669"><a href="#local-6989586621679067669"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679067670"><a href="#local-6989586621679067670"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679067671"><a href="#local-6989586621679067671"><span class="hs-identifier">message</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-246"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679067672"><a href="#local-6989586621679067672"><span class="hs-identifier">pid</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679067673"><a href="#local-6989586621679067673"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Cmd.Utils.html#hPipeTo"><span class="hs-identifier hs-var">hPipeTo</span></a><span> </span><a href="#local-6989586621679067669"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679067670"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-247"></a><span>       </span><span class="hs-identifier hs-var">finally</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hPutStr</span><span> </span><a href="#local-6989586621679067673"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679067671"><span class="hs-identifier hs-var">message</span></a><span class="hs-special">)</span><span>
</span><a name="line-248"></a><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679067673"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-249"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679067672"><span class="hs-identifier hs-var">pid</span></a><span>
</span><a name="line-250"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-251"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-252"></a><span>
</span><a name="line-253"></a><span class="hs-cpp">#if !(defined(mingw32_HOST_OS) || defined(mingw32_TARGET_OS) || defined(__MINGW32__))</span><span>
</span><a name="line-254"></a><span class="hs-cpp">#ifndef __HUGS__</span><span>
</span><a name="line-255"></a><span class="hs-comment">{- | Like a combination of 'hPipeTo' and 'hPipeFrom'; returns
a 3-tuple of ('PipeHandle', Data From Pipe, Data To Pipe).

When done, you must hClose both handles, and then use either 'forceSuccess' or
getProcessStatus on the 'PipeHandle'.  Zombies will result otherwise.

Hint: you will usually need to ForkIO a thread to handle one of the Handles;
otherwise, deadlock can result.

This function logs as pipeBoth.

Not available on Windows.
-}</span><span>
</span><a name="line-268"></a><span class="hs-identifier">hPipeBoth</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#PipeHandle"><span class="hs-identifier hs-type">PipeHandle</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">)</span><span>
</span><a name="line-269"></a><a name="hPipeBoth"><a href="System.Cmd.Utils.html#hPipeBoth"><span class="hs-identifier">hPipeBoth</span></a></a><span> </span><a name="local-6989586621679067674"><a href="#local-6989586621679067674"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679067675"><a href="#local-6989586621679067675"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-270"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679067676"><a href="#local-6989586621679067676"><span class="hs-identifier">frompair</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">createPipe</span><span>
</span><a name="line-271"></a><span>       </span><a name="local-6989586621679067677"><a href="#local-6989586621679067677"><span class="hs-identifier">topair</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">createPipe</span><span>
</span><a name="line-272"></a><span>       </span><a href="System.Cmd.Utils.html#logRunning"><span class="hs-identifier hs-var">logRunning</span></a><span> </span><span class="hs-string">&quot;pipeBoth&quot;</span><span> </span><a href="#local-6989586621679067674"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679067675"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-273"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679067678"><a href="#local-6989586621679067678"><span class="hs-identifier">childstuff</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">dupTo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679067676"><span class="hs-identifier hs-var">frompair</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">stdOutput</span><span>
</span><a name="line-274"></a><span>                           </span><span class="hs-identifier hs-var">closeFd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679067676"><span class="hs-identifier hs-var">frompair</span></a><span class="hs-special">)</span><span>
</span><a name="line-275"></a><span>                           </span><span class="hs-identifier hs-var">dupTo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679067677"><span class="hs-identifier hs-var">topair</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">stdInput</span><span>
</span><a name="line-276"></a><span>                           </span><span class="hs-identifier hs-var">closeFd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679067677"><span class="hs-identifier hs-var">topair</span></a><span class="hs-special">)</span><span>
</span><a name="line-277"></a><span>                           </span><span class="hs-identifier hs-var">executeFile</span><span> </span><a href="#local-6989586621679067674"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679067675"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-278"></a><span>       </span><a name="local-6989586621679067679"><a href="#local-6989586621679067679"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Control</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Exception</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">try</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">forkProcess</span><span> </span><a href="#local-6989586621679067678"><span class="hs-identifier hs-var">childstuff</span></a><span class="hs-special">)</span><span>
</span><a name="line-279"></a><span>       </span><span class="hs-comment">-- parent</span><span>
</span><a name="line-280"></a><span>       </span><a name="local-6989586621679067682"><a href="#local-6989586621679067682"><span class="hs-identifier">pid</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679067679"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-281"></a><span>                   </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679067680"><a href="#local-6989586621679067680"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679067680"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-282"></a><span>                   </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679067681"><a href="#local-6989586621679067681"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Control</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Exception</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">IOException</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Cmd.Utils.html#warnFail"><span class="hs-identifier hs-var">warnFail</span></a><span> </span><span class="hs-string">&quot;pipeBoth&quot;</span><span> </span><a href="#local-6989586621679067674"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679067675"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-283"></a><span>                             </span><span class="hs-string">&quot;Error in fork: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679067681"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-284"></a><span>       </span><span class="hs-identifier hs-var">closeFd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679067676"><span class="hs-identifier hs-var">frompair</span></a><span class="hs-special">)</span><span>
</span><a name="line-285"></a><span>       </span><span class="hs-identifier hs-var">closeFd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679067677"><span class="hs-identifier hs-var">topair</span></a><span class="hs-special">)</span><span>
</span><a name="line-286"></a><span>       </span><a name="local-6989586621679067683"><a href="#local-6989586621679067683"><span class="hs-identifier">fromh</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fdToHandle</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679067676"><span class="hs-identifier hs-var">frompair</span></a><span class="hs-special">)</span><span>
</span><a name="line-287"></a><span>       </span><a name="local-6989586621679067684"><a href="#local-6989586621679067684"><span class="hs-identifier">toh</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fdToHandle</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679067677"><span class="hs-identifier hs-var">topair</span></a><span class="hs-special">)</span><span>
</span><a name="line-288"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#PipeHandle"><span class="hs-identifier hs-var">PipeHandle</span></a><span> </span><a href="#local-6989586621679067682"><span class="hs-identifier hs-var">pid</span></a><span> </span><a href="#local-6989586621679067674"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679067675"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-string">&quot;pipeBoth&quot;</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679067683"><span class="hs-identifier hs-var">fromh</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679067684"><span class="hs-identifier hs-var">toh</span></a><span class="hs-special">)</span><span>
</span><a name="line-289"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-290"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><span class="hs-cpp">#if !(defined(mingw32_HOST_OS) || defined(mingw32_TARGET_OS) || defined(__MINGW32__))</span><span>
</span><a name="line-293"></a><span class="hs-cpp">#ifndef __HUGS__</span><span>
</span><a name="line-294"></a><span class="hs-comment">{- | Like a combination of 'pipeTo' and 'pipeFrom'; forks an IO thread
to send data to the piped program, and simultaneously returns its output
stream.

The same note about checking the return status applies here as with 'pipeFrom'.

Not available on Windows. -}</span><span>
</span><a name="line-301"></a><span class="hs-identifier">pipeBoth</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#PipeHandle"><span class="hs-identifier hs-type">PipeHandle</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-302"></a><a name="pipeBoth"><a href="System.Cmd.Utils.html#pipeBoth"><span class="hs-identifier">pipeBoth</span></a></a><span> </span><a name="local-6989586621679067685"><a href="#local-6989586621679067685"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679067686"><a href="#local-6989586621679067686"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679067687"><a href="#local-6989586621679067687"><span class="hs-identifier">message</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-303"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679067688"><a href="#local-6989586621679067688"><span class="hs-identifier">pid</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679067689"><a href="#local-6989586621679067689"><span class="hs-identifier">fromh</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679067690"><a href="#local-6989586621679067690"><span class="hs-identifier">toh</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Cmd.Utils.html#hPipeBoth"><span class="hs-identifier hs-var">hPipeBoth</span></a><span> </span><a href="#local-6989586621679067685"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679067686"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-304"></a><span>       </span><span class="hs-identifier hs-var">forkIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">finally</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hPutStr</span><span> </span><a href="#local-6989586621679067690"><span class="hs-identifier hs-var">toh</span></a><span> </span><a href="#local-6989586621679067687"><span class="hs-identifier hs-var">message</span></a><span class="hs-special">)</span><span>
</span><a name="line-305"></a><span>                        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679067690"><span class="hs-identifier hs-var">toh</span></a><span class="hs-special">)</span><span>
</span><a name="line-306"></a><span>       </span><a name="local-6989586621679068111"><a href="#local-6989586621679068111"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">hGetContents</span><span> </span><a href="#local-6989586621679067689"><span class="hs-identifier hs-var">fromh</span></a><span>
</span><a name="line-307"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679067688"><span class="hs-identifier hs-var">pid</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679068111"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-308"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-309"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-310"></a><span>
</span><a name="line-311"></a><span class="hs-cpp">#if !(defined(mingw32_HOST_OS) || defined(mingw32_TARGET_OS) || defined(__MINGW32__))</span><span>
</span><a name="line-312"></a><span class="hs-comment">{- | Uses 'System.Posix.Process.getProcessStatus' to obtain the exit status
of the given process ID.  If the process terminated normally, does nothing.
Otherwise, raises an exception with an appropriate error message.

This call will block waiting for the given pid to terminate.

Not available on Windows. -}</span><span>
</span><a name="line-319"></a><span class="hs-identifier">forceSuccess</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Cmd.Utils.html#PipeHandle"><span class="hs-identifier hs-type">PipeHandle</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-320"></a><a name="forceSuccess"><a href="System.Cmd.Utils.html#forceSuccess"><span class="hs-identifier">forceSuccess</span></a></a><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#PipeHandle"><span class="hs-identifier hs-var">PipeHandle</span></a><span> </span><a name="local-6989586621679068112"><a href="#local-6989586621679068112"><span class="hs-identifier">pid</span></a></a><span> </span><a name="local-6989586621679068113"><a href="#local-6989586621679068113"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679068114"><a href="#local-6989586621679068114"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679068115"><a href="#local-6989586621679068115"><span class="hs-identifier">funcname</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-321"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679068116"><a href="#local-6989586621679068116"><span class="hs-identifier">warnfail</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Cmd.Utils.html#warnFail"><span class="hs-identifier hs-var">warnFail</span></a><span> </span><a href="#local-6989586621679068115"><span class="hs-identifier hs-var">funcname</span></a><span>
</span><a name="line-322"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679068117"><a href="#local-6989586621679068117"><span class="hs-identifier">status</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getProcessStatus</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621679068112"><span class="hs-identifier hs-var">pid</span></a><span>
</span><a name="line-323"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679068117"><span class="hs-identifier hs-var">status</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-324"></a><span>                </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679068116"><span class="hs-identifier hs-var">warnfail</span></a><span> </span><a href="#local-6989586621679068113"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679068114"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Got no process status&quot;</span><span>
</span><a name="line-325"></a><span>                </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Exited</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ExitSuccess</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-326"></a><span>                </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Exited</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ExitFailure</span><span> </span><a name="local-6989586621679068118"><a href="#local-6989586621679068118"><span class="hs-identifier">fc</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-327"></a><span>                    </span><a href="System.Cmd.Utils.html#cmdfailed"><span class="hs-identifier hs-var">cmdfailed</span></a><span> </span><a href="#local-6989586621679068115"><span class="hs-identifier hs-var">funcname</span></a><span> </span><a href="#local-6989586621679068113"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679068114"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621679068118"><span class="hs-identifier hs-var">fc</span></a><span>
</span><a name="line-328"></a><span class="hs-cpp">#if MIN_VERSION_unix(2,7,0)</span><span>
</span><a name="line-329"></a><span>                </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Terminated</span><span> </span><a name="local-6989586621679068119"><a href="#local-6989586621679068119"><span class="hs-identifier">sig</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-330"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-331"></a><span>                </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Terminated</span><span> </span><span class="hs-identifier">sig</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-332"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-333"></a><span>                    </span><a href="#local-6989586621679068116"><span class="hs-identifier hs-var">warnfail</span></a><span> </span><a href="#local-6989586621679068113"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679068114"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Terminated by signal &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679068119"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-334"></a><span>                </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Stopped</span><span> </span><a name="local-6989586621679068120"><a href="#local-6989586621679068120"><span class="hs-identifier">sig</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-335"></a><span>                    </span><a href="#local-6989586621679068116"><span class="hs-identifier hs-var">warnfail</span></a><span> </span><a href="#local-6989586621679068113"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679068114"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Stopped by signal &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679068120"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-336"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span class="hs-comment">{- | Invokes the specified command in a subprocess, waiting for the result.
If the command terminated successfully, return normally.  Otherwise,
raises a userError with the problem.

Implemented in terms of 'posixRawSystem' where supported, and System.Posix.rawSystem otherwise.
-}</span><span>
</span><a name="line-344"></a><span class="hs-identifier">safeSystem</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-345"></a><a name="safeSystem"><a href="System.Cmd.Utils.html#safeSystem"><span class="hs-identifier">safeSystem</span></a></a><span> </span><a name="local-6989586621679068121"><a href="#local-6989586621679068121"><span class="hs-identifier">command</span></a></a><span> </span><a name="local-6989586621679068122"><a href="#local-6989586621679068122"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-346"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">debugM</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#logbase"><span class="hs-identifier hs-var">logbase</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.safeSystem&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-347"></a><span>               </span><span class="hs-special">(</span><span class="hs-string">&quot;Running: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679068121"><span class="hs-identifier hs-var">command</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679068122"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-348"></a><span class="hs-cpp">#if defined(__HUGS__) || defined(mingw32_HOST_OS) || defined(mingw32_TARGET_OS) || defined(__MINGW32__)</span><span>
</span><a name="line-349"></a><span>       </span><span class="hs-identifier">ec</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">rawSystem</span><span> </span><span class="hs-identifier">command</span><span> </span><span class="hs-identifier">args</span><span>
</span><a name="line-350"></a><span>       </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">ec</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-351"></a><span>            </span><span class="hs-identifier">ExitSuccess</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-352"></a><span>            </span><span class="hs-identifier">ExitFailure</span><span> </span><span class="hs-identifier">fc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">cmdfailed</span><span> </span><span class="hs-string">&quot;safeSystem&quot;</span><span> </span><span class="hs-identifier">command</span><span> </span><span class="hs-identifier">args</span><span> </span><span class="hs-identifier">fc</span><span>
</span><a name="line-353"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-354"></a><span>       </span><a name="local-6989586621679068123"><a href="#local-6989586621679068123"><span class="hs-identifier">ec</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Cmd.Utils.html#posixRawSystem"><span class="hs-identifier hs-var">posixRawSystem</span></a><span> </span><a href="#local-6989586621679068121"><span class="hs-identifier hs-var">command</span></a><span> </span><a href="#local-6989586621679068122"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-355"></a><span>       </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679068123"><span class="hs-identifier hs-var">ec</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-356"></a><span>            </span><span class="hs-identifier hs-var">Exited</span><span> </span><span class="hs-identifier hs-var">ExitSuccess</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-357"></a><span>            </span><span class="hs-identifier hs-var">Exited</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ExitFailure</span><span> </span><a name="local-6989586621679068124"><a href="#local-6989586621679068124"><span class="hs-identifier">fc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Cmd.Utils.html#cmdfailed"><span class="hs-identifier hs-var">cmdfailed</span></a><span> </span><span class="hs-string">&quot;safeSystem&quot;</span><span> </span><a href="#local-6989586621679068121"><span class="hs-identifier hs-var">command</span></a><span> </span><a href="#local-6989586621679068122"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621679068124"><span class="hs-identifier hs-var">fc</span></a><span>
</span><a name="line-358"></a><span class="hs-cpp">#if MIN_VERSION_unix(2,7,0)</span><span>
</span><a name="line-359"></a><span>            </span><span class="hs-identifier hs-var">Terminated</span><span> </span><a name="local-6989586621679068125"><a href="#local-6989586621679068125"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Cmd.Utils.html#cmdsignalled"><span class="hs-identifier hs-var">cmdsignalled</span></a><span> </span><span class="hs-string">&quot;safeSystem&quot;</span><span> </span><a href="#local-6989586621679068121"><span class="hs-identifier hs-var">command</span></a><span> </span><a href="#local-6989586621679068122"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621679068125"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-360"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-361"></a><span>            </span><span class="hs-identifier">Terminated</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">cmdsignalled</span><span> </span><span class="hs-string">&quot;safeSystem&quot;</span><span> </span><span class="hs-identifier">command</span><span> </span><span class="hs-identifier">args</span><span> </span><span class="hs-identifier">s</span><span>
</span><a name="line-362"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-363"></a><span>            </span><span class="hs-identifier hs-var">Stopped</span><span> </span><a name="local-6989586621679068126"><a href="#local-6989586621679068126"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Cmd.Utils.html#cmdsignalled"><span class="hs-identifier hs-var">cmdsignalled</span></a><span> </span><span class="hs-string">&quot;safeSystem&quot;</span><span> </span><a href="#local-6989586621679068121"><span class="hs-identifier hs-var">command</span></a><span> </span><a href="#local-6989586621679068122"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621679068126"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-364"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-365"></a><span>
</span><a name="line-366"></a><span class="hs-cpp">#if !(defined(mingw32_HOST_OS) || defined(mingw32_TARGET_OS) || defined(__MINGW32__))</span><span>
</span><a name="line-367"></a><span class="hs-cpp">#ifndef __HUGS__</span><span>
</span><a name="line-368"></a><span class="hs-comment">{- | Invokes the specified command in a subprocess, waiting for the result.
Return the result status.  Never raises an exception.  Only available
on POSIX platforms.

Like system(3), this command ignores SIGINT and SIGQUIT and blocks SIGCHLD
during its execution.

Logs as System.Cmd.Utils.posixRawSystem -}</span><span>
</span><a name="line-376"></a><span class="hs-identifier">posixRawSystem</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">ProcessStatus</span><span>
</span><a name="line-377"></a><a name="posixRawSystem"><a href="System.Cmd.Utils.html#posixRawSystem"><span class="hs-identifier">posixRawSystem</span></a></a><span> </span><a name="local-6989586621679068127"><a href="#local-6989586621679068127"><span class="hs-identifier">program</span></a></a><span> </span><a name="local-6989586621679068128"><a href="#local-6989586621679068128"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-378"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">debugM</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#logbase"><span class="hs-identifier hs-var">logbase</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.posixRawSystem&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-379"></a><span>               </span><span class="hs-special">(</span><span class="hs-string">&quot;Running: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679068127"><span class="hs-identifier hs-var">program</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679068128"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-380"></a><span>       </span><a name="local-6989586621679068137"><a href="#local-6989586621679068137"><span class="hs-identifier">oldint</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">installHandler</span><span> </span><span class="hs-identifier hs-var">sigINT</span><span> </span><span class="hs-identifier hs-var">Ignore</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-381"></a><span>       </span><a name="local-6989586621679068138"><a href="#local-6989586621679068138"><span class="hs-identifier">oldquit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">installHandler</span><span> </span><span class="hs-identifier hs-var">sigQUIT</span><span> </span><span class="hs-identifier hs-var">Ignore</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-382"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679068139"><a href="#local-6989586621679068139"><span class="hs-identifier">sigset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">addSignal</span><span> </span><span class="hs-identifier hs-var">sigCHLD</span><span> </span><span class="hs-identifier hs-var">emptySignalSet</span><span>
</span><a name="line-383"></a><span>       </span><a name="local-6989586621679068140"><a href="#local-6989586621679068140"><span class="hs-identifier">oldset</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getSignalMask</span><span>
</span><a name="line-384"></a><span>       </span><span class="hs-identifier hs-var">blockSignals</span><span> </span><a href="#local-6989586621679068139"><span class="hs-identifier hs-var">sigset</span></a><span>
</span><a name="line-385"></a><span>       </span><a name="local-6989586621679068141"><a href="#local-6989586621679068141"><span class="hs-identifier">childpid</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">forkProcess</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679068129"><span class="hs-identifier hs-var">childaction</span></a><span> </span><a href="#local-6989586621679068137"><span class="hs-identifier hs-var">oldint</span></a><span> </span><a href="#local-6989586621679068138"><span class="hs-identifier hs-var">oldquit</span></a><span> </span><a href="#local-6989586621679068140"><span class="hs-identifier hs-var">oldset</span></a><span class="hs-special">)</span><span>
</span><a name="line-386"></a><span>
</span><a name="line-387"></a><span>       </span><a name="local-6989586621679068142"><a href="#local-6989586621679068142"><span class="hs-identifier">mps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getProcessStatus</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621679068141"><span class="hs-identifier hs-var">childpid</span></a><span>
</span><a name="line-388"></a><span>       </span><a href="#local-6989586621679068130"><span class="hs-identifier hs-var">restoresignals</span></a><span> </span><a href="#local-6989586621679068137"><span class="hs-identifier hs-var">oldint</span></a><span> </span><a href="#local-6989586621679068138"><span class="hs-identifier hs-var">oldquit</span></a><span> </span><a href="#local-6989586621679068140"><span class="hs-identifier hs-var">oldset</span></a><span>
</span><a name="line-389"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679068143"><a href="#local-6989586621679068143"><span class="hs-identifier">retval</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679068142"><span class="hs-identifier hs-var">mps</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-390"></a><span>                      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679068144"><a href="#local-6989586621679068144"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679068144"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-391"></a><span>                      </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Nothing returned from getProcessStatus&quot;</span><span>
</span><a name="line-392"></a><span>
</span><a name="line-393"></a><span>       </span><span class="hs-identifier hs-var">debugM</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#logbase"><span class="hs-identifier hs-var">logbase</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.posixRawSystem&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-394"></a><span>              </span><span class="hs-special">(</span><a href="#local-6989586621679068127"><span class="hs-identifier hs-var">program</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;: exited with &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679068143"><span class="hs-identifier hs-var">retval</span></a><span class="hs-special">)</span><span>
</span><a name="line-395"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679068143"><span class="hs-identifier hs-var">retval</span></a><span>
</span><a name="line-396"></a><span>
</span><a name="line-397"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679068129"><a href="#local-6989586621679068129"><span class="hs-identifier">childaction</span></a></a><span> </span><a name="local-6989586621679068131"><a href="#local-6989586621679068131"><span class="hs-identifier">oldint</span></a></a><span> </span><a name="local-6989586621679068132"><a href="#local-6989586621679068132"><span class="hs-identifier">oldquit</span></a></a><span> </span><a name="local-6989586621679068133"><a href="#local-6989586621679068133"><span class="hs-identifier">oldset</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-398"></a><span>              </span><span class="hs-keyword">do</span><span> </span><a href="#local-6989586621679068130"><span class="hs-identifier hs-var">restoresignals</span></a><span> </span><a href="#local-6989586621679068131"><span class="hs-identifier hs-var">oldint</span></a><span> </span><a href="#local-6989586621679068132"><span class="hs-identifier hs-var">oldquit</span></a><span> </span><a href="#local-6989586621679068133"><span class="hs-identifier hs-var">oldset</span></a><span>
</span><a name="line-399"></a><span>                 </span><span class="hs-identifier hs-var">executeFile</span><span> </span><a href="#local-6989586621679068127"><span class="hs-identifier hs-var">program</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679068128"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-400"></a><span>          </span><a name="local-6989586621679068130"><a href="#local-6989586621679068130"><span class="hs-identifier">restoresignals</span></a></a><span> </span><a name="local-6989586621679068134"><a href="#local-6989586621679068134"><span class="hs-identifier">oldint</span></a></a><span> </span><a name="local-6989586621679068135"><a href="#local-6989586621679068135"><span class="hs-identifier">oldquit</span></a></a><span> </span><a name="local-6989586621679068136"><a href="#local-6989586621679068136"><span class="hs-identifier">oldset</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-401"></a><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">installHandler</span><span> </span><span class="hs-identifier hs-var">sigINT</span><span> </span><a href="#local-6989586621679068134"><span class="hs-identifier hs-var">oldint</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-402"></a><span>                 </span><span class="hs-identifier hs-var">installHandler</span><span> </span><span class="hs-identifier hs-var">sigQUIT</span><span> </span><a href="#local-6989586621679068135"><span class="hs-identifier hs-var">oldquit</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-403"></a><span>                 </span><span class="hs-identifier hs-var">setSignalMask</span><span> </span><a href="#local-6989586621679068136"><span class="hs-identifier hs-var">oldset</span></a><span>
</span><a name="line-404"></a><span>
</span><a name="line-405"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-406"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-407"></a><span>
</span><a name="line-408"></a><span class="hs-cpp">#if !(defined(mingw32_HOST_OS) || defined(mingw32_TARGET_OS) || defined(__MINGW32__))</span><span>
</span><a name="line-409"></a><span class="hs-cpp">#ifndef __HUGS__</span><span>
</span><a name="line-410"></a><span class="hs-comment">{- | Invokes the specified command in a subprocess, without waiting for
the result.  Returns the PID of the subprocess -- it is YOUR responsibility
to use getProcessStatus or getAnyProcessStatus on that at some point.  Failure
to do so will lead to resource leakage (zombie processes).

This function does nothing with signals.  That too is up to you.

Logs as System.Cmd.Utils.forkRawSystem -}</span><span>
</span><a name="line-418"></a><span class="hs-identifier">forkRawSystem</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">ProcessID</span><span>
</span><a name="line-419"></a><a name="forkRawSystem"><a href="System.Cmd.Utils.html#forkRawSystem"><span class="hs-identifier">forkRawSystem</span></a></a><span> </span><a name="local-6989586621679068174"><a href="#local-6989586621679068174"><span class="hs-identifier">program</span></a></a><span> </span><a name="local-6989586621679068175"><a href="#local-6989586621679068175"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-420"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">debugM</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#logbase"><span class="hs-identifier hs-var">logbase</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.forkRawSystem&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-421"></a><span>               </span><span class="hs-special">(</span><span class="hs-string">&quot;Running: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679068174"><span class="hs-identifier hs-var">program</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679068175"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-422"></a><span>       </span><span class="hs-identifier hs-var">forkProcess</span><span> </span><a href="#local-6989586621679068176"><span class="hs-identifier hs-var">childaction</span></a><span>
</span><a name="line-423"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-424"></a><span>      </span><a name="local-6989586621679068176"><a href="#local-6989586621679068176"><span class="hs-identifier">childaction</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">executeFile</span><span> </span><a href="#local-6989586621679068174"><span class="hs-identifier hs-var">program</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679068175"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-425"></a><span>
</span><a name="line-426"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-427"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-428"></a><span>
</span><a name="line-429"></a><span class="hs-identifier">cmdfailed</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679067434"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-430"></a><a name="cmdfailed"><a href="System.Cmd.Utils.html#cmdfailed"><span class="hs-identifier">cmdfailed</span></a></a><span> </span><a name="local-6989586621679068177"><a href="#local-6989586621679068177"><span class="hs-identifier">funcname</span></a></a><span> </span><a name="local-6989586621679068178"><a href="#local-6989586621679068178"><span class="hs-identifier">command</span></a></a><span> </span><a name="local-6989586621679068179"><a href="#local-6989586621679068179"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679068180"><a href="#local-6989586621679068180"><span class="hs-identifier">failcode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-431"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679068181"><a href="#local-6989586621679068181"><span class="hs-identifier">errormsg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Command &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679068178"><span class="hs-identifier hs-var">command</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679068179"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-432"></a><span>            </span><span class="hs-string">&quot; failed; exit code &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679068180"><span class="hs-identifier hs-var">failcode</span></a><span class="hs-special">)</span><span>
</span><a name="line-433"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679068182"><a href="#local-6989586621679068182"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">userError</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679068181"><span class="hs-identifier hs-var">errormsg</span></a><span class="hs-special">)</span><span>
</span><a name="line-434"></a><span>    </span><span class="hs-identifier hs-var">warningM</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#logbase"><span class="hs-identifier hs-var">logbase</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679068177"><span class="hs-identifier hs-var">funcname</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679068181"><span class="hs-identifier hs-var">errormsg</span></a><span>
</span><a name="line-435"></a><span>    </span><span class="hs-identifier hs-var">ioError</span><span> </span><a href="#local-6989586621679068182"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-436"></a><span>
</span><a name="line-437"></a><span class="hs-cpp">#if !(defined(mingw32_HOST_OS) || defined(mingw32_TARGET_OS) || defined(__MINGW32__))</span><span>
</span><a name="line-438"></a><span class="hs-cpp">#ifndef __HUGS__</span><span>
</span><a name="line-439"></a><span class="hs-identifier">cmdsignalled</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Signal</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679067433"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-440"></a><a name="cmdsignalled"><a href="System.Cmd.Utils.html#cmdsignalled"><span class="hs-identifier">cmdsignalled</span></a></a><span> </span><a name="local-6989586621679068183"><a href="#local-6989586621679068183"><span class="hs-identifier">funcname</span></a></a><span> </span><a name="local-6989586621679068184"><a href="#local-6989586621679068184"><span class="hs-identifier">command</span></a></a><span> </span><a name="local-6989586621679068185"><a href="#local-6989586621679068185"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679068186"><a href="#local-6989586621679068186"><span class="hs-identifier">failcode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-441"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679068187"><a href="#local-6989586621679068187"><span class="hs-identifier">errormsg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Command &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679068184"><span class="hs-identifier hs-var">command</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679068185"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-442"></a><span>            </span><span class="hs-string">&quot; failed due to signal &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679068186"><span class="hs-identifier hs-var">failcode</span></a><span class="hs-special">)</span><span>
</span><a name="line-443"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679068188"><a href="#local-6989586621679068188"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">userError</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679068187"><span class="hs-identifier hs-var">errormsg</span></a><span class="hs-special">)</span><span>
</span><a name="line-444"></a><span>    </span><span class="hs-identifier hs-var">warningM</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#logbase"><span class="hs-identifier hs-var">logbase</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679068183"><span class="hs-identifier hs-var">funcname</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679068187"><span class="hs-identifier hs-var">errormsg</span></a><span>
</span><a name="line-445"></a><span>    </span><span class="hs-identifier hs-var">ioError</span><span> </span><a href="#local-6989586621679068188"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-446"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-447"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-448"></a><span>
</span><a name="line-449"></a><span class="hs-cpp">#if !(defined(mingw32_HOST_OS) || defined(mingw32_TARGET_OS) || defined(__MINGW32__))</span><span>
</span><a name="line-450"></a><span class="hs-cpp">#ifndef __HUGS__</span><span>
</span><a name="line-451"></a><span class="hs-comment">{- | Open a pipe to the specified command.

Passes the handle on to the specified function.

The 'PipeMode' specifies what you will be doing.  That is, specifing 'ReadFromPipe'
sets up a pipe from stdin, and 'WriteToPipe' sets up a pipe from stdout.

Not available on Windows.
 -}</span><span>
</span><a name="line-460"></a><span class="hs-identifier">pOpen</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Cmd.Utils.html#PipeMode"><span class="hs-identifier hs-type">PipeMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-461"></a><span>         </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679067432"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679067432"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-462"></a><a name="pOpen"><a href="System.Cmd.Utils.html#pOpen"><span class="hs-identifier">pOpen</span></a></a><span> </span><a name="local-6989586621679068189"><a href="#local-6989586621679068189"><span class="hs-identifier">pm</span></a></a><span> </span><a name="local-6989586621679068190"><a href="#local-6989586621679068190"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679068191"><a href="#local-6989586621679068191"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679068192"><a href="#local-6989586621679068192"><span class="hs-identifier">func</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-463"></a><span>        </span><span class="hs-keyword">do</span><span>
</span><a name="line-464"></a><span>        </span><a name="local-6989586621679068193"><a href="#local-6989586621679068193"><span class="hs-identifier">pipepair</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">createPipe</span><span>
</span><a name="line-465"></a><span>        </span><span class="hs-identifier hs-var">debugM</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#logbase"><span class="hs-identifier hs-var">logbase</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.pOpen&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-466"></a><span>               </span><span class="hs-special">(</span><span class="hs-string">&quot;Running: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679068190"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679068191"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-467"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679068189"><span class="hs-identifier hs-var">pm</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-468"></a><span>         </span><a href="System.Cmd.Utils.html#ReadFromPipe"><span class="hs-identifier hs-var">ReadFromPipe</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-469"></a><span>                         </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679068194"><a href="#local-6989586621679068194"><span class="hs-identifier">callfunc</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-470"></a><span>                                        </span><span class="hs-identifier hs-var">closeFd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679068193"><span class="hs-identifier hs-var">pipepair</span></a><span class="hs-special">)</span><span>
</span><a name="line-471"></a><span>                                        </span><a name="local-6989586621679068195"><a href="#local-6989586621679068195"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fdToHandle</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679068193"><span class="hs-identifier hs-var">pipepair</span></a><span class="hs-special">)</span><span>
</span><a name="line-472"></a><span>                                        </span><a name="local-6989586621679068196"><a href="#local-6989586621679068196"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679068192"><span class="hs-identifier hs-var">func</span></a><span> </span><a href="#local-6989586621679068195"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-473"></a><span>                                        </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679068195"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-474"></a><span>                                        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><a href="#local-6989586621679068196"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-475"></a><span>                         </span><a href="System.Cmd.Utils.html#pOpen3"><span class="hs-identifier hs-var">pOpen3</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679068193"><span class="hs-identifier hs-var">pipepair</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-6989586621679068190"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679068191"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-476"></a><span>                                </span><a href="#local-6989586621679068194"><span class="hs-identifier hs-var">callfunc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">closeFd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679068193"><span class="hs-identifier hs-var">pipepair</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-477"></a><span>         </span><a href="System.Cmd.Utils.html#WriteToPipe"><span class="hs-identifier hs-var">WriteToPipe</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-478"></a><span>                        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679068197"><a href="#local-6989586621679068197"><span class="hs-identifier">callfunc</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-479"></a><span>                                       </span><span class="hs-identifier hs-var">closeFd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679068193"><span class="hs-identifier hs-var">pipepair</span></a><span class="hs-special">)</span><span>
</span><a name="line-480"></a><span>                                       </span><a name="local-6989586621679068198"><a href="#local-6989586621679068198"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fdToHandle</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679068193"><span class="hs-identifier hs-var">pipepair</span></a><span class="hs-special">)</span><span>
</span><a name="line-481"></a><span>                                       </span><a name="local-6989586621679068199"><a href="#local-6989586621679068199"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679068192"><span class="hs-identifier hs-var">func</span></a><span> </span><a href="#local-6989586621679068198"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-482"></a><span>                                       </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679068198"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-483"></a><span>                                       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><a href="#local-6989586621679068199"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-484"></a><span>                        </span><a href="System.Cmd.Utils.html#pOpen3"><span class="hs-identifier hs-var">pOpen3</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679068193"><span class="hs-identifier hs-var">pipepair</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-6989586621679068190"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679068191"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-485"></a><span>                               </span><a href="#local-6989586621679068197"><span class="hs-identifier hs-var">callfunc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">closeFd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679068193"><span class="hs-identifier hs-var">pipepair</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-486"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-487"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-488"></a><span>
</span><a name="line-489"></a><span class="hs-cpp">#if !(defined(mingw32_HOST_OS) || defined(mingw32_TARGET_OS) || defined(__MINGW32__))</span><span>
</span><a name="line-490"></a><span class="hs-cpp">#ifndef __HUGS__</span><span>
</span><a name="line-491"></a><span class="hs-comment">{- | Runs a command, redirecting things to pipes.

Not available on Windows.

Note that you may not use the same fd on more than one item.  If you
want to redirect stdout and stderr, dup it first.
-}</span><span>
</span><a name="line-498"></a><span class="hs-identifier">pOpen3</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Fd</span><span>                      </span><span class="hs-comment">-- ^ Send stdin to this fd</span><span>
</span><a name="line-499"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Fd</span><span>                      </span><span class="hs-comment">-- ^ Get stdout from this fd</span><span>
</span><a name="line-500"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Fd</span><span>                      </span><span class="hs-comment">-- ^ Get stderr from this fd</span><span>
</span><a name="line-501"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>                      </span><span class="hs-comment">-- ^ Command to run</span><span>
</span><a name="line-502"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>                      </span><span class="hs-comment">-- ^ Command args</span><span>
</span><a name="line-503"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ProcessID</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679067431"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- ^ Action to run in parent</span><span>
</span><a name="line-504"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>                         </span><span class="hs-comment">-- ^ Action to run in child before execing (if you don't need something, set this to @return ()@) -- IGNORED IN HUGS</span><span>
</span><a name="line-505"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679067431"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-506"></a><a name="pOpen3"><a href="System.Cmd.Utils.html#pOpen3"><span class="hs-identifier">pOpen3</span></a></a><span> </span><a name="local-6989586621679068200"><a href="#local-6989586621679068200"><span class="hs-identifier">pin</span></a></a><span> </span><a name="local-6989586621679068201"><a href="#local-6989586621679068201"><span class="hs-identifier">pout</span></a></a><span> </span><a name="local-6989586621679068202"><a href="#local-6989586621679068202"><span class="hs-identifier">perr</span></a></a><span> </span><a name="local-6989586621679068203"><a href="#local-6989586621679068203"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679068204"><a href="#local-6989586621679068204"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679068205"><a href="#local-6989586621679068205"><span class="hs-identifier">func</span></a></a><span> </span><a name="local-6989586621679068206"><a href="#local-6989586621679068206"><span class="hs-identifier">childfunc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-507"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679068207"><a href="#local-6989586621679068207"><span class="hs-identifier">pid</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Cmd.Utils.html#pOpen3Raw"><span class="hs-identifier hs-var">pOpen3Raw</span></a><span> </span><a href="#local-6989586621679068200"><span class="hs-identifier hs-var">pin</span></a><span> </span><a href="#local-6989586621679068201"><span class="hs-identifier hs-var">pout</span></a><span> </span><a href="#local-6989586621679068202"><span class="hs-identifier hs-var">perr</span></a><span> </span><a href="#local-6989586621679068203"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679068204"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621679068206"><span class="hs-identifier hs-var">childfunc</span></a><span>
</span><a name="line-508"></a><span>       </span><a name="local-6989586621679068208"><a href="#local-6989586621679068208"><span class="hs-identifier">retval</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679068205"><span class="hs-identifier hs-var">func</span></a><span> </span><span class="hs-operator hs-var">$!</span><span> </span><a href="#local-6989586621679068207"><span class="hs-identifier hs-var">pid</span></a><span>
</span><a name="line-509"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679068209"><a href="#local-6989586621679068209"><span class="hs-identifier">rv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">seq</span><span> </span><a href="#local-6989586621679068208"><span class="hs-identifier hs-var">retval</span></a><span> </span><a href="#local-6989586621679068208"><span class="hs-identifier hs-var">retval</span></a><span>
</span><a name="line-510"></a><span>       </span><a href="System.Cmd.Utils.html#forceSuccess"><span class="hs-identifier hs-var">forceSuccess</span></a><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#PipeHandle"><span class="hs-identifier hs-var">PipeHandle</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">seq</span><span> </span><a href="#local-6989586621679068208"><span class="hs-identifier hs-var">retval</span></a><span> </span><a href="#local-6989586621679068207"><span class="hs-identifier hs-var">pid</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679068203"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679068204"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-string">&quot;pOpen3&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-511"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679068209"><span class="hs-identifier hs-var">rv</span></a><span>
</span><a name="line-512"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-513"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-514"></a><span>
</span><a name="line-515"></a><span class="hs-cpp">#if !(defined(mingw32_HOST_OS) || defined(mingw32_TARGET_OS) || defined(__MINGW32__))</span><span>
</span><a name="line-516"></a><span class="hs-cpp">#ifndef __HUGS__</span><span>
</span><a name="line-517"></a><span class="hs-comment">{- | Runs a command, redirecting things to pipes.

Not available on Windows.

Returns immediately with the PID of the child.  Using 'waitProcess' on it
is YOUR responsibility!

Note that you may not use the same fd on more than one item.  If you
want to redirect stdout and stderr, dup it first.
-}</span><span>
</span><a name="line-527"></a><span class="hs-identifier">pOpen3Raw</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Fd</span><span>                      </span><span class="hs-comment">-- ^ Send stdin to this fd</span><span>
</span><a name="line-528"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Fd</span><span>                      </span><span class="hs-comment">-- ^ Get stdout from this fd</span><span>
</span><a name="line-529"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Fd</span><span>                      </span><span class="hs-comment">-- ^ Get stderr from this fd</span><span>
</span><a name="line-530"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>                      </span><span class="hs-comment">-- ^ Command to run</span><span>
</span><a name="line-531"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>                      </span><span class="hs-comment">-- ^ Command args</span><span>
</span><a name="line-532"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>                         </span><span class="hs-comment">-- ^ Action to run in child before execing (if you don't need something, set this to @return ()@) -- IGNORED IN HUGS</span><span>
</span><a name="line-533"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">ProcessID</span><span>
</span><a name="line-534"></a><a name="pOpen3Raw"><a href="System.Cmd.Utils.html#pOpen3Raw"><span class="hs-identifier">pOpen3Raw</span></a></a><span> </span><a name="local-6989586621679068210"><a href="#local-6989586621679068210"><span class="hs-identifier">pin</span></a></a><span> </span><a name="local-6989586621679068211"><a href="#local-6989586621679068211"><span class="hs-identifier">pout</span></a></a><span> </span><a name="local-6989586621679068212"><a href="#local-6989586621679068212"><span class="hs-identifier">perr</span></a></a><span> </span><a name="local-6989586621679068213"><a href="#local-6989586621679068213"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679068214"><a href="#local-6989586621679068214"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621679068215"><a href="#local-6989586621679068215"><span class="hs-identifier">childfunc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-535"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679068216"><a href="#local-6989586621679068216"><span class="hs-identifier">mayberedir</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-536"></a><span>        </span><span class="hs-identifier">mayberedir</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679068218"><a href="#local-6989586621679068218"><span class="hs-identifier">fromfd</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679068219"><a href="#local-6989586621679068219"><span class="hs-identifier">tofd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-537"></a><span>                                        </span><span class="hs-identifier hs-var">dupTo</span><span> </span><a href="#local-6989586621679068218"><span class="hs-identifier hs-var">fromfd</span></a><span> </span><a href="#local-6989586621679068219"><span class="hs-identifier hs-var">tofd</span></a><span>
</span><a name="line-538"></a><span>                                        </span><span class="hs-identifier hs-var">closeFd</span><span> </span><a href="#local-6989586621679068218"><span class="hs-identifier hs-var">fromfd</span></a><span>
</span><a name="line-539"></a><span>                                        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-540"></a><span>        </span><a name="local-6989586621679068217"><a href="#local-6989586621679068217"><span class="hs-identifier">childstuff</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-541"></a><span>                     </span><a href="#local-6989586621679068216"><span class="hs-identifier hs-var">mayberedir</span></a><span> </span><a href="#local-6989586621679068210"><span class="hs-identifier hs-var">pin</span></a><span> </span><span class="hs-identifier hs-var">stdInput</span><span>
</span><a name="line-542"></a><span>                     </span><a href="#local-6989586621679068216"><span class="hs-identifier hs-var">mayberedir</span></a><span> </span><a href="#local-6989586621679068211"><span class="hs-identifier hs-var">pout</span></a><span> </span><span class="hs-identifier hs-var">stdOutput</span><span>
</span><a name="line-543"></a><span>                     </span><a href="#local-6989586621679068216"><span class="hs-identifier hs-var">mayberedir</span></a><span> </span><a href="#local-6989586621679068212"><span class="hs-identifier hs-var">perr</span></a><span> </span><span class="hs-identifier hs-var">stdError</span><span>
</span><a name="line-544"></a><span>                     </span><a href="#local-6989586621679068215"><span class="hs-identifier hs-var">childfunc</span></a><span>
</span><a name="line-545"></a><span>                     </span><span class="hs-identifier hs-var">debugM</span><span> </span><span class="hs-special">(</span><a href="System.Cmd.Utils.html#logbase"><span class="hs-identifier hs-var">logbase</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;.pOpen3&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-546"></a><span>                            </span><span class="hs-special">(</span><span class="hs-string">&quot;Running: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679068213"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679068214"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-547"></a><span>                     </span><span class="hs-identifier hs-var">executeFile</span><span> </span><a href="#local-6989586621679068213"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679068214"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-548"></a><span class="hs-comment">{-
        realfunc p = do
                     System.Posix.Signals.installHandler
                           System.Posix.Signals.sigPIPE
                           System.Posix.Signals.Ignore
                           Nothing
                     func p
-}</span><span>
</span><a name="line-556"></a><span>        </span><span class="hs-keyword">in</span><span>
</span><a name="line-557"></a><span>        </span><span class="hs-keyword">do</span><span>
</span><a name="line-558"></a><span>        </span><a name="local-6989586621679068220"><a href="#local-6989586621679068220"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Control</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Exception</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">try</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">forkProcess</span><span> </span><a href="#local-6989586621679068217"><span class="hs-identifier hs-var">childstuff</span></a><span class="hs-special">)</span><span>
</span><a name="line-559"></a><span>        </span><a name="local-6989586621679068223"><a href="#local-6989586621679068223"><span class="hs-identifier">pid</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679068220"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-560"></a><span>                </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679068221"><a href="#local-6989586621679068221"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679068221"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-561"></a><span>                </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679068222"><a href="#local-6989586621679068222"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Control</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Exception</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">IOException</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Error in fork: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679068222"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-562"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679068223"><span class="hs-identifier hs-var">pid</span></a><span>
</span><a name="line-563"></a><span>
</span><a name="line-564"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-565"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-566"></a><span>
</span><a name="line-567"></a><span class="hs-identifier">showCmd</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-568"></a><a name="showCmd"><a href="System.Cmd.Utils.html#showCmd"><span class="hs-identifier">showCmd</span></a></a><span> </span><a name="local-6989586621679068224"><a href="#local-6989586621679068224"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-6989586621679068225"><a href="#local-6989586621679068225"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679068224"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679068225"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-569"></a></pre></body></html>