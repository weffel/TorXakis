<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span class="hs-comment">{- arch-tag: HVFS utilities main file
Copyright (c) 2004-2011 John Goerzen &lt;jgoerzen@complete.org&gt;

All rights reserved.

For license and copyright information, see the file LICENSE
-}</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-comment">{- |
   Module     : System.IO.HVFS.Utils
   Copyright  : Copyright (C) 2004-2011 John Goerzen
   License    : BSD3

   Maintainer : John Goerzen &lt;jgoerzen@complete.org&gt; 
   Stability  : provisional
   Portability: portable

This module provides various helpful utilities for dealing 
filesystems.

Written by John Goerzen, jgoerzen\@complete.org

To operate on your system's main filesystem, just pass SystemFS as the
first parameter to these functions.
-}</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">HVFS</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span><span> </span><span class="hs-special">(</span><a href="System.IO.HVFS.Utils.html#recurseDir"><span class="hs-identifier hs-var">recurseDir</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>                               </span><a href="System.IO.HVFS.Utils.html#recurseDirStat"><span class="hs-identifier hs-var">recurseDirStat</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>                               </span><a href="System.IO.HVFS.Utils.html#recursiveRemove"><span class="hs-identifier hs-var">recursiveRemove</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>                               </span><a href="System.IO.HVFS.Utils.html#lsl"><span class="hs-identifier hs-var">lsl</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>                               </span><a href="System.IO.HVFS.html#SystemFS"><span class="hs-identifier hs-type">SystemFS</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span>                              </span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span class="hs-keyword">where</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="System.IO.HVFS.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">HVFS</span></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="System.Time.Utils.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Time</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="System.IO.PlafCompat.html"><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">PlafCompat</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Printf</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Time</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Locale</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Unsafe</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">FilePath</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;/&gt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">pathSeparator</span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-comment">{- | Obtain a recursive listing of all files\/directories beneath 
the specified directory.  The traversal is depth-first
and the original
item is always present in the returned list.

If the passed value is not a directory, the return value
be only that value.

The \&quot;.\&quot; and \&quot;..\&quot; entries are removed from the data returned.
-}</span><span>
</span><a name="line-55"></a><span class="hs-identifier">recurseDir</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.IO.HVFS.html#HVFS"><span class="hs-identifier hs-type">HVFS</span></a><span> </span><a href="#local-6989586621679060056"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679060056"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span>
</span><a name="line-56"></a><a name="recurseDir"><a href="System.IO.HVFS.Utils.html#recurseDir"><span class="hs-identifier">recurseDir</span></a></a><span> </span><a name="local-6989586621679060057"><a href="#local-6989586621679060057"><span class="hs-identifier">fs</span></a></a><span> </span><a name="local-6989586621679060058"><a href="#local-6989586621679060058"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.IO.HVFS.Utils.html#recurseDirStat"><span class="hs-identifier hs-var">recurseDirStat</span></a><span> </span><a href="#local-6989586621679060057"><span class="hs-identifier hs-var">fs</span></a><span> </span><a href="#local-6989586621679060058"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-comment">{- | Like 'recurseDir', but return the stat() (System.Posix.Files.FileStatus)
information with them.  This is an optimization if you will be statting files
yourself later.

The items are returned lazily.

WARNING: do not change your current working directory until you have consumed
all the items.  Doing so could cause strange effects.

Alternatively, you may wish to pass an absolute path to this function.
-}</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-identifier">recurseDirStat</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.IO.HVFS.html#HVFS"><span class="hs-identifier hs-type">HVFS</span></a><span> </span><a href="#local-6989586621679060055"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679060055"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span> </span><a href="System.IO.HVFS.html#HVFSStatEncap"><span class="hs-identifier hs-type">HVFSStatEncap</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-71"></a><a name="recurseDirStat"><a href="System.IO.HVFS.Utils.html#recurseDirStat"><span class="hs-identifier">recurseDirStat</span></a></a><span> </span><a name="local-6989586621679060059"><a href="#local-6989586621679060059"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679060060"><a href="#local-6989586621679060060"><span class="hs-identifier">fn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-72"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679060061"><a href="#local-6989586621679060061"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVFS.html#vGetSymbolicLinkStatus"><span class="hs-identifier hs-var">vGetSymbolicLinkStatus</span></a><span> </span><a href="#local-6989586621679060059"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679060060"><span class="hs-identifier hs-var">fn</span></a><span>
</span><a name="line-73"></a><span>       </span><span class="hs-keyword">if</span><span> </span><a href="System.IO.HVFS.html#withStat"><span class="hs-identifier hs-var">withStat</span></a><span> </span><a href="#local-6989586621679060061"><span class="hs-identifier hs-var">fs</span></a><span> </span><a href="System.IO.HVFS.html#vIsDirectory"><span class="hs-identifier hs-var">vIsDirectory</span></a><span> </span><span>
</span><a name="line-74"></a><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-75"></a><span>               </span><a name="local-6989586621679060062"><a href="#local-6989586621679060062"><span class="hs-identifier">dirc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVFS.html#vGetDirectoryContents"><span class="hs-identifier hs-var">vGetDirectoryContents</span></a><span> </span><a href="#local-6989586621679060059"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679060060"><span class="hs-identifier hs-var">fn</span></a><span>
</span><a name="line-76"></a><span>               </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679060063"><a href="#local-6989586621679060063"><span class="hs-identifier">contents</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">++</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679060060"><span class="hs-identifier hs-var">fn</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">pathSeparator</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span>
</span><a name="line-77"></a><span>                              </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679060064"><a href="#local-6989586621679060064"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679060064"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-string">&quot;.&quot;</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679060064"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-string">&quot;..&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679060062"><span class="hs-identifier hs-var">dirc</span></a><span>
</span><a name="line-78"></a><span>               </span><a name="local-6989586621679060548"><a href="#local-6989586621679060548"><span class="hs-identifier">subdirs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">unsafeInterleaveIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="System.IO.HVFS.Utils.html#recurseDirStat"><span class="hs-identifier hs-var">recurseDirStat</span></a><span> </span><a href="#local-6989586621679060059"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679060063"><span class="hs-identifier hs-var">contents</span></a><span>
</span><a name="line-79"></a><span>               </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621679060548"><span class="hs-identifier hs-var">subdirs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679060060"><span class="hs-identifier hs-var">fn</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679060061"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-80"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679060060"><span class="hs-identifier hs-var">fn</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679060061"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-comment">{- | Removes a file or a directory.  If a directory, also removes all its
child files\/directories.
-}</span><span>
</span><a name="line-85"></a><span class="hs-identifier">recursiveRemove</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.IO.HVFS.html#HVFS"><span class="hs-identifier hs-type">HVFS</span></a><span> </span><a href="#local-6989586621679060054"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679060054"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-86"></a><a name="recursiveRemove"><a href="System.IO.HVFS.Utils.html#recursiveRemove"><span class="hs-identifier">recursiveRemove</span></a></a><span> </span><a name="local-6989586621679060549"><a href="#local-6989586621679060549"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679060550"><a href="#local-6989586621679060550"><span class="hs-identifier">fn</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-87"></a><span>    </span><a href="System.IO.HVFS.Utils.html#recurseDirStat"><span class="hs-identifier hs-var">recurseDirStat</span></a><span> </span><a href="#local-6989586621679060549"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679060550"><span class="hs-identifier hs-var">fn</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-88"></a><span>        </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679060551"><a href="#local-6989586621679060551"><span class="hs-identifier">fn</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679060552"><a href="#local-6989586621679060552"><span class="hs-identifier">fs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="System.IO.HVFS.html#withStat"><span class="hs-identifier hs-var">withStat</span></a><span> </span><a href="#local-6989586621679060552"><span class="hs-identifier hs-var">fs</span></a><span> </span><a href="System.IO.HVFS.html#vIsDirectory"><span class="hs-identifier hs-var">vIsDirectory</span></a><span> </span><span>
</span><a name="line-89"></a><span>                         </span><span class="hs-keyword">then</span><span> </span><a href="System.IO.HVFS.html#vRemoveDirectory"><span class="hs-identifier hs-var">vRemoveDirectory</span></a><span> </span><a href="#local-6989586621679060549"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679060551"><span class="hs-identifier hs-var">fn</span></a><span>
</span><a name="line-90"></a><span>                         </span><span class="hs-keyword">else</span><span> </span><a href="System.IO.HVFS.html#vRemoveFile"><span class="hs-identifier hs-var">vRemoveFile</span></a><span> </span><a href="#local-6989586621679060549"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679060551"><span class="hs-identifier hs-var">fn</span></a><span>
</span><a name="line-91"></a><span>                              </span><span class="hs-special">)</span><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span class="hs-comment">{- | Provide a result similar to the command ls -l over a directory.

Known bug: setuid bit semantics are inexact compared with standard ls.
-}</span><span>
</span><a name="line-97"></a><span class="hs-identifier">lsl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.IO.HVFS.html#HVFS"><span class="hs-identifier hs-type">HVFS</span></a><span> </span><a href="#local-6989586621679060053"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679060053"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-98"></a><a name="lsl"><a href="System.IO.HVFS.Utils.html#lsl"><span class="hs-identifier">lsl</span></a></a><span> </span><a name="local-6989586621679060553"><a href="#local-6989586621679060553"><span class="hs-identifier">fs</span></a></a><span> </span><a name="local-6989586621679060554"><a href="#local-6989586621679060554"><span class="hs-identifier">fp</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-99"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679060555"><a href="#local-6989586621679060555"><span class="hs-identifier">showmodes</span></a></a><span> </span><a name="local-6989586621679060557"><a href="#local-6989586621679060557"><span class="hs-identifier">mode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-100"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679060558"><a href="#local-6989586621679060558"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679060559"><a href="#local-6989586621679060559"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">intersectFileModes</span><span> </span><a href="#local-6989586621679060557"><span class="hs-identifier hs-var">mode</span></a><span> </span><a href="#local-6989586621679060559"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>                </span><span class="hs-keyword">in</span><span>
</span><a name="line-102"></a><span>                </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060558"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-identifier hs-var">ownerReadMode</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">'r'</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-char">'-'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span>
</span><a name="line-103"></a><span>                </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060558"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-identifier hs-var">ownerWriteMode</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">'w'</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-char">'-'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span>
</span><a name="line-104"></a><span>                </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060558"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-identifier hs-var">setUserIDMode</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">'s'</span><span> </span><span class="hs-keyword">else</span><span>
</span><a name="line-105"></a><span>                    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060558"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-identifier hs-var">ownerExecuteMode</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">'x'</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-char">'-'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span>
</span><a name="line-106"></a><span>                </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060558"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-identifier hs-var">groupReadMode</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">'r'</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-char">'-'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span>
</span><a name="line-107"></a><span>                </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060558"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-identifier hs-var">groupWriteMode</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">'w'</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-char">'-'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span>
</span><a name="line-108"></a><span>                </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060558"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-identifier hs-var">setGroupIDMode</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">'s'</span><span> </span><span class="hs-keyword">else</span><span>
</span><a name="line-109"></a><span>                    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060558"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-identifier hs-var">groupExecuteMode</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">'x'</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-char">'-'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span>
</span><a name="line-110"></a><span>                </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060558"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-identifier hs-var">otherReadMode</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">'r'</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-char">'-'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span>
</span><a name="line-111"></a><span>                </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060558"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-identifier hs-var">otherWriteMode</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">'w'</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-char">'-'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span>
</span><a name="line-112"></a><span>                </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060558"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-identifier hs-var">otherExecuteMode</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">'x'</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-char">'-'</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-113"></a><span>        </span><a name="local-6989586621679060556"><a href="#local-6989586621679060556"><span class="hs-identifier">showentry</span></a></a><span> </span><a name="local-6989586621679060560"><a href="#local-6989586621679060560"><span class="hs-identifier">origdir</span></a></a><span> </span><a name="local-6989586621679060561"><a href="#local-6989586621679060561"><span class="hs-identifier">fh</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679060562"><a href="#local-6989586621679060562"><span class="hs-identifier">state</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679060563"><a href="#local-6989586621679060563"><span class="hs-identifier">fp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-114"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679060562"><span class="hs-identifier hs-var">state</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-115"></a><span>              </span><a href="System.IO.HVFS.html#HVFSStatEncap"><span class="hs-identifier hs-var">HVFSStatEncap</span></a><span> </span><a name="local-6989586621679060564"><a href="#local-6989586621679060564"><span class="hs-identifier">se</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span>
</span><a name="line-116"></a><span>               </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679060565"><a href="#local-6989586621679060565"><span class="hs-identifier">typechar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-117"></a><span>                    </span><span class="hs-keyword">if</span><span> </span><a href="System.IO.HVFS.html#vIsDirectory"><span class="hs-identifier hs-var">vIsDirectory</span></a><span> </span><a href="#local-6989586621679060564"><span class="hs-identifier hs-var">se</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">'d'</span><span>
</span><a name="line-118"></a><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="System.IO.HVFS.html#vIsSymbolicLink"><span class="hs-identifier hs-var">vIsSymbolicLink</span></a><span> </span><a href="#local-6989586621679060564"><span class="hs-identifier hs-var">se</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">'l'</span><span>
</span><a name="line-119"></a><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="System.IO.HVFS.html#vIsBlockDevice"><span class="hs-identifier hs-var">vIsBlockDevice</span></a><span> </span><a href="#local-6989586621679060564"><span class="hs-identifier hs-var">se</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">'b'</span><span>
</span><a name="line-120"></a><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="System.IO.HVFS.html#vIsCharacterDevice"><span class="hs-identifier hs-var">vIsCharacterDevice</span></a><span> </span><a href="#local-6989586621679060564"><span class="hs-identifier hs-var">se</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">'c'</span><span>
</span><a name="line-121"></a><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="System.IO.HVFS.html#vIsSocket"><span class="hs-identifier hs-var">vIsSocket</span></a><span> </span><a href="#local-6989586621679060564"><span class="hs-identifier hs-var">se</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">'s'</span><span>
</span><a name="line-122"></a><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="System.IO.HVFS.html#vIsNamedPipe"><span class="hs-identifier hs-var">vIsNamedPipe</span></a><span> </span><a href="#local-6989586621679060564"><span class="hs-identifier hs-var">se</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">'s'</span><span>
</span><a name="line-123"></a><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-char">'-'</span><span>
</span><a name="line-124"></a><span>                   </span><a name="local-6989586621679060566"><a href="#local-6989586621679060566"><span class="hs-identifier">clocktime</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Time.Utils.html#epochToClockTime"><span class="hs-identifier hs-var">epochToClockTime</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVFS.html#vModificationTime"><span class="hs-identifier hs-var">vModificationTime</span></a><span> </span><a href="#local-6989586621679060564"><span class="hs-identifier hs-var">se</span></a><span class="hs-special">)</span><span>
</span><a name="line-125"></a><span>                   </span><a name="local-6989586621679060567"><a href="#local-6989586621679060567"><span class="hs-identifier">datestr</span></a></a><span> </span><a name="local-6989586621679060568"><a href="#local-6989586621679060568"><span class="hs-identifier">c</span></a></a><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">formatCalendarTime</span><span> </span><span class="hs-identifier hs-var">defaultTimeLocale</span><span> </span><span class="hs-string">&quot;%b %e  %Y&quot;</span><span> </span><span>
</span><a name="line-126"></a><span>                               </span><a href="#local-6989586621679060568"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-127"></a><span>                    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679060569"><a href="#local-6989586621679060569"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">toCalendarTime</span><span> </span><a href="#local-6989586621679060566"><span class="hs-identifier hs-var">clocktime</span></a><span>
</span><a name="line-128"></a><span>                          </span><a name="local-6989586621679060571"><a href="#local-6989586621679060571"><span class="hs-identifier">linkstr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="System.IO.HVFS.html#vIsSymbolicLink"><span class="hs-identifier hs-var">vIsSymbolicLink</span></a><span> </span><a href="#local-6989586621679060564"><span class="hs-identifier hs-var">se</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-129"></a><span>                                       </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-130"></a><span>                                       </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679060570"><a href="#local-6989586621679060570"><span class="hs-identifier">sl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVFS.html#vReadSymbolicLink"><span class="hs-identifier hs-var">vReadSymbolicLink</span></a><span> </span><a href="#local-6989586621679060561"><span class="hs-identifier hs-var">fh</span></a><span> </span><span>
</span><a name="line-131"></a><span>                                                           </span><span class="hs-special">(</span><a href="#local-6989586621679060560"><span class="hs-identifier hs-var">origdir</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679060563"><span class="hs-identifier hs-var">fp</span></a><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span>                                                  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot; -&gt; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679060570"><span class="hs-identifier hs-var">sl</span></a><span>
</span><a name="line-133"></a><span>                          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">printf</span><span> </span><span class="hs-string">&quot;%c%s  1 %-8d %-8d %-9d %s %s%s&quot;</span><span> </span><span>
</span><a name="line-134"></a><span>                                     </span><a href="#local-6989586621679060565"><span class="hs-identifier hs-var">typechar</span></a><span>
</span><a name="line-135"></a><span>                                     </span><span class="hs-special">(</span><a href="#local-6989586621679060555"><span class="hs-identifier hs-var">showmodes</span></a><span> </span><span class="hs-special">(</span><a href="System.IO.HVFS.html#vFileMode"><span class="hs-identifier hs-var">vFileMode</span></a><span> </span><a href="#local-6989586621679060564"><span class="hs-identifier hs-var">se</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-136"></a><span>                                     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toInteger</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.IO.HVFS.html#vFileOwner"><span class="hs-identifier hs-var">vFileOwner</span></a><span> </span><a href="#local-6989586621679060564"><span class="hs-identifier hs-var">se</span></a><span class="hs-special">)</span><span>
</span><a name="line-137"></a><span>                                     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toInteger</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.IO.HVFS.html#vFileGroup"><span class="hs-identifier hs-var">vFileGroup</span></a><span> </span><a href="#local-6989586621679060564"><span class="hs-identifier hs-var">se</span></a><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>                                     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toInteger</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.IO.HVFS.html#vFileSize"><span class="hs-identifier hs-var">vFileSize</span></a><span> </span><a href="#local-6989586621679060564"><span class="hs-identifier hs-var">se</span></a><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>                                     </span><span class="hs-special">(</span><a href="#local-6989586621679060567"><span class="hs-identifier hs-var">datestr</span></a><span> </span><a href="#local-6989586621679060569"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-140"></a><span>                                     </span><a href="#local-6989586621679060563"><span class="hs-identifier hs-var">fp</span></a><span>
</span><a name="line-141"></a><span>                                     </span><a href="#local-6989586621679060571"><span class="hs-identifier hs-var">linkstr</span></a><span>
</span><a name="line-142"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679060572"><a href="#local-6989586621679060572"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVFS.html#vGetDirectoryContents"><span class="hs-identifier hs-var">vGetDirectoryContents</span></a><span> </span><a href="#local-6989586621679060553"><span class="hs-identifier hs-var">fs</span></a><span> </span><a href="#local-6989586621679060554"><span class="hs-identifier hs-var">fp</span></a><span>
</span><a name="line-143"></a><span>              </span><a name="local-6989586621679060575"><a href="#local-6989586621679060575"><span class="hs-identifier">pairs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679060573"><a href="#local-6989586621679060573"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679060574"><a href="#local-6989586621679060574"><span class="hs-identifier">ss</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.IO.HVFS.html#vGetSymbolicLinkStatus"><span class="hs-identifier hs-var">vGetSymbolicLinkStatus</span></a><span> </span><a href="#local-6989586621679060553"><span class="hs-identifier hs-var">fs</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679060554"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621679060573"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-144"></a><span>                                      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679060574"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679060573"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span>
</span><a name="line-145"></a><span>                            </span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679060572"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-146"></a><span>              </span><a name="local-6989586621679060576"><a href="#local-6989586621679060576"><span class="hs-identifier">linedata</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679060556"><span class="hs-identifier hs-var">showentry</span></a><span> </span><a href="#local-6989586621679060554"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679060553"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679060575"><span class="hs-identifier hs-var">pairs</span></a><span>
</span><a name="line-147"></a><span>              </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unlines</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;total 1&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679060576"><span class="hs-identifier hs-var">linedata</span></a><span>
</span><a name="line-148"></a><span>                  </span><span>
</span><a name="line-149"></a><span>            </span><span>
</span><a name="line-150"></a></pre></body></html>